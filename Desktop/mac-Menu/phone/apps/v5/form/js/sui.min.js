!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&(define.amd||define.cmd))define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=e()}}(function(){function e(e){return function(){return U.apply(e,arguments)}}function t(e){return e===Object(e)}function i(e){return"[object StopIteration]"===ee(e)||e instanceof q}function a(e,t){if(P&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&e.stack.indexOf(te)===-1){for(var i=[],a=t;a;a=a.source)a.stack&&i.unshift(a.stack);i.unshift(e.stack);var r=i.join("\n"+te+"\n");e.stack=n(r)}}function n(e){for(var t=e.split("\n"),i=[],a=0;a<t.length;++a){var n=t[a];s(n)||r(n)||!n||i.push(n)}return i.join("\n")}function r(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function o(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var i=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(i)return[i[1],Number(i[2])];var a=/.*@(.+):(\d+)$/.exec(e);return a?[a[1],Number(a[2])]:void 0}function s(e){var t=o(e);if(!t)return!1;var i=t[0],a=t[1];return i===V&&a>=K&&a<=re}function l(){if(P)try{throw new Error}catch(a){var e=a.stack.split("\n"),t=e[0].indexOf("@")>0?e[1]:e[2],i=o(t);if(!i)return;return V=i[0],i[1]}}function c(e,t,i){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+i+" instead.",new Error("").stack),e.apply(e,arguments)}}function d(e){return e instanceof p?e:y(e)?L(e):D(e)}function u(){function e(e){t=e,r.source=e,$(i,function(t,i){d.nextTick(function(){e.promiseDispatch.apply(e,i)})},void 0),i=void 0,a=void 0}var t,i=[],a=[],n=Y(u.prototype),r=Y(p.prototype);if(r.promiseDispatch=function(e,n,r){var o=J(arguments);i?(i.push(o),"when"===n&&r[1]&&a.push(r[1])):d.nextTick(function(){t.promiseDispatch.apply(t,o)})},r.valueOf=function(){if(i)return r;var e=v(t);return g(e)&&(t=e),e},r.inspect=function(){return t?t.inspect():{state:"pending"}},d.longStackSupport&&P)try{throw new Error}catch(e){r.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return n.promise=r,n.resolve=function(i){t||e(d(i))},n.fulfill=function(i){t||e(D(i))},n.reject=function(i){t||e(E(i))},n.notify=function(e){t||$(a,function(t,i){d.nextTick(function(){i(e)})},void 0)},n}function f(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=u();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function m(e){return f(function(t,i){for(var a=0,n=e.length;a<n;a++)d(e[a]).then(t,i)})}function p(e,t,i){void 0===t&&(t=function(e){return E(new Error("Promise does not support operation: "+e))}),void 0===i&&(i=function(){return{state:"unknown"}});var a=Y(p.prototype);if(a.promiseDispatch=function(i,n,r){var o;try{o=e[n]?e[n].apply(a,r):t.call(a,n,r)}catch(e){o=E(e)}i&&i(o)},a.inspect=i,i){var n=i();"rejected"===n.state&&(a.exception=n.reason),a.valueOf=function(){var e=i();return"pending"===e.state||"rejected"===e.state?a:e.value}}return a}function h(e,t,i,a){return d(e).then(t,i,a)}function v(e){if(g(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function g(e){return e instanceof p}function y(e){return t(e)&&"function"==typeof e.then}function I(e){return g(e)&&"pending"===e.inspect().state}function b(e){return!g(e)||"fulfilled"===e.inspect().state}function w(e){return g(e)&&"rejected"===e.inspect().state}function S(){ie.length=0,ae.length=0,ne||(ne=!0)}function k(e,t){ne&&(ae.push(e),t&&"undefined"!=typeof t.stack?ie.push(t.stack):ie.push("(no stack) "+t))}function T(e){if(ne){var t=Z(ae,e);t!==-1&&(ae.splice(t,1),ie.splice(t,1))}}function E(e){var t=p({when:function(t){return t&&T(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return k(t,e),t}function D(e){return p({when:function(){return e},get:function(t){return e[t]},set:function(t,i){e[t]=i},delete:function(t){delete e[t]},post:function(t,i){return null===t||void 0===t?e.apply(void 0,i):e[t].apply(e,i)},apply:function(t,i){return e.apply(t,i)},keys:function(){return G(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function L(e){var t=u();return d.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}}),t.promise}function x(e){return p({isDef:function(){}},function(t,i){return H(e,t,i)},function(){return d(e).inspect()})}function M(e,t,i){return d(e).spread(t,i)}function A(e){return function(){function t(e,t){var o;if("undefined"==typeof StopIteration){try{o=a[e](t)}catch(e){return E(e)}return o.done?d(o.value):h(o.value,n,r)}try{o=a[e](t)}catch(e){return i(e)?d(e.value):E(e)}return h(o,n,r)}var a=e.apply(this,arguments),n=t.bind(t,"next"),r=t.bind(t,"throw");return n()}}function _(e){d.done(d.async(e)())}function F(e){throw new q(e)}function N(e){return function(){return M([this,O(arguments)],function(t,i){return e.apply(t,i)})}}function H(e,t,i){return d(e).dispatch(t,i)}function O(e){return h(e,function(e){var t=0,i=u();return $(e,function(a,n,r){var o;g(n)&&"fulfilled"===(o=n.inspect()).state?e[r]=o.value:(++t,h(n,function(a){e[r]=a,0===--t&&i.resolve(e)},i.reject,function(e){i.notify({index:r,value:e})}))},void 0),0===t&&i.resolve(e),i.promise})}function B(e){return h(e,function(e){return e=Q(e,d),h(O(Q(e,function(e){return h(e,W,W)})),function(){return e})})}function j(e){return d(e).allSettled()}function C(e,t){return d(e).then(void 0,void 0,t)}function R(e,t){return d(e).nodeify(t)}var P=!1;try{throw new Error}catch(e){P=!!e.stack}var V,q,K=l(),W=function(){},z=function(){function e(){for(;t.next;){t=t.next;var i=t.task;t.task=void 0;var n=t.domain;n&&(t.domain=void 0,n.enter());try{i()}catch(t){if(r)throw n&&n.exit(),setTimeout(e,0),n&&n.enter(),t;setTimeout(function(){throw t},0)}n&&n.exit()}a=!1}var t={task:void 0,next:null},i=t,a=!1,n=void 0,r=!1;if(z=function(e){i=i.next={task:e,domain:r&&process.domain,next:null},a||(a=!0,n())},"undefined"!=typeof process&&process.nextTick)r=!0,n=function(){process.nextTick(e)};else if("function"==typeof setImmediate)n="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var o=new MessageChannel;o.port1.onmessage=function(){n=s,o.port1.onmessage=e,e()};var s=function(){o.port2.postMessage(0)};n=function(){setTimeout(e,0),s()}}else n=function(){setTimeout(e,0)};return z}(),U=Function.call,J=e(Array.prototype.slice),$=e(Array.prototype.reduce||function(e,t){var i=0,a=this.length;if(1===arguments.length)for(;;){if(i in this){t=this[i++];break}if(++i>=a)throw new TypeError}for(;i<a;i++)i in this&&(t=e(t,this[i],i));return t}),Z=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Q=e(Array.prototype.map||function(e,t){var i=this,a=[];return $(i,function(n,r,o){a.push(e.call(t,r,o,i))},void 0),a}),Y=Object.create||function(e){function t(){}return t.prototype=e,new t},X=e(Object.prototype.hasOwnProperty),G=Object.keys||function(e){var t=[];for(var i in e)X(e,i)&&t.push(i);return t},ee=e(Object.prototype.toString);q="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var te="From previous event:";d.resolve=d,d.nextTick=z,d.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(d.longStackSupport=!0),d.defer=u,u.prototype.makeNodeResolver=function(){var e=this;return function(t,i){t?e.reject(t):arguments.length>2?e.resolve(J(arguments,1)):e.resolve(i)}},d.Promise=f,d.promise=f,f.race=m,f.all=O,f.reject=E,f.resolve=d,d.passByCopy=function(e){return e},p.prototype.passByCopy=function(){return this},d.join=function(e,t){return d(e).join(t)},p.prototype.join=function(e){return d([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},d.race=m,p.prototype.race=function(){return this.then(d.race)},d.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(e,t,i){function n(t){try{return"function"==typeof e?e(t):t}catch(e){return E(e)}}function r(e){if("function"==typeof t){a(e,s);try{return t(e)}catch(e){return E(e)}}return E(e)}function o(e){return"function"==typeof i?i(e):e}var s=this,l=u(),c=!1;return d.nextTick(function(){s.promiseDispatch(function(e){c||(c=!0,l.resolve(n(e)))},"when",[function(e){c||(c=!0,l.resolve(r(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,i=!1;try{t=o(e)}catch(e){if(i=!0,!d.onerror)throw e;d.onerror(e)}i||l.notify(t)}]),l.promise},d.tap=function(e,t){return d(e).tap(t)},p.prototype.tap=function(e){return e=d(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},d.when=h,p.prototype.thenResolve=function(e){return this.then(function(){return e})},d.thenResolve=function(e,t){return d(e).thenResolve(t)},p.prototype.thenReject=function(e){return this.then(function(){throw e})},d.thenReject=function(e,t){return d(e).thenReject(t)},d.nearer=v,d.isPromise=g,d.isPromiseAlike=y,d.isPending=I,p.prototype.isPending=function(){return"pending"===this.inspect().state},d.isFulfilled=b,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},d.isRejected=w,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ie=[],ae=[],ne=!0;d.resetUnhandledRejections=S,d.getUnhandledReasons=function(){return ie.slice()},d.stopUnhandledRejectionTracking=function(){S(),ne=!1},S(),d.reject=E,d.fulfill=D,d.master=x,d.spread=M,p.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},d.async=A,d.spawn=_,d.return=F,d.promised=N,d.dispatch=H,p.prototype.dispatch=function(e,t){var i=this,a=u();return d.nextTick(function(){i.promiseDispatch(a.resolve,e,t)}),a.promise},d.get=function(e,t){return d(e).dispatch("get",[t])},p.prototype.get=function(e){return this.dispatch("get",[e])},d.set=function(e,t,i){return d(e).dispatch("set",[t,i])},p.prototype.set=function(e,t){return this.dispatch("set",[e,t])},d.del=d.delete=function(e,t){return d(e).dispatch("delete",[t])},p.prototype.del=p.prototype.delete=function(e){return this.dispatch("delete",[e])},d.mapply=d.post=function(e,t,i){return d(e).dispatch("post",[t,i])},p.prototype.mapply=p.prototype.post=function(e,t){return this.dispatch("post",[e,t])},d.send=d.mcall=d.invoke=function(e,t){return d(e).dispatch("post",[t,J(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(e){return this.dispatch("post",[e,J(arguments,1)])},d.fapply=function(e,t){return d(e).dispatch("apply",[void 0,t])},p.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},d.try=d.fcall=function(e){return d(e).dispatch("apply",[void 0,J(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,J(arguments)])},d.fbind=function(e){var t=d(e),i=J(arguments,1);return function(){return t.dispatch("apply",[this,i.concat(J(arguments))])}},p.prototype.fbind=function(){var e=this,t=J(arguments);return function(){return e.dispatch("apply",[this,t.concat(J(arguments))])}},d.keys=function(e){return d(e).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},d.all=O,p.prototype.all=function(){return O(this)},d.allResolved=c(B,"allResolved","allSettled"),p.prototype.allResolved=function(){return B(this)},d.allSettled=j,p.prototype.allSettled=function(){return this.then(function(e){return O(Q(e,function(e){function t(){return e.inspect()}return e=d(e),e.then(t,t)}))})},d.fail=d.catch=function(e,t){return d(e).then(void 0,t)},p.prototype.fail=p.prototype.catch=function(e){return this.then(void 0,e)},d.progress=C,p.prototype.progress=function(e){return this.then(void 0,void 0,e)},d.fin=d.finally=function(e,t){return d(e).finally(t)},p.prototype.fin=p.prototype.finally=function(e){return e=d(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},d.done=function(e,t,i,a){return d(e).done(t,i,a)},p.prototype.done=function(e,t,i){var n=function(e){d.nextTick(function(){if(a(e,r),!d.onerror)throw e;d.onerror(e)})},r=e||t||i?this.then(e,t,i):this;"object"==typeof process&&process&&process.domain&&(n=process.domain.bind(n)),r.then(void 0,n)},d.timeout=function(e,t,i){return d(e).timeout(t,i)},p.prototype.timeout=function(e,t){var i=u(),a=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),i.reject(t)},e);return this.then(function(e){clearTimeout(a),i.resolve(e)},function(e){clearTimeout(a),i.reject(e)},i.notify),i.promise},d.delay=function(e,t){return void 0===t&&(t=e,e=void 0),d(e).delay(t)},p.prototype.delay=function(e){return this.then(function(t){var i=u();return setTimeout(function(){i.resolve(t)},e),i.promise})},d.nfapply=function(e,t){return d(e).nfapply(t)},p.prototype.nfapply=function(e){var t=u(),i=J(e);return i.push(t.makeNodeResolver()),this.fapply(i).fail(t.reject),t.promise},d.nfcall=function(e){var t=J(arguments,1);return d(e).nfapply(t)},p.prototype.nfcall=function(){var e=J(arguments),t=u();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},d.nfbind=d.denodeify=function(e){var t=J(arguments,1);return function(){var i=t.concat(J(arguments)),a=u();return i.push(a.makeNodeResolver()),d(e).fapply(i).fail(a.reject),a.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var e=J(arguments);return e.unshift(this),d.denodeify.apply(void 0,e)},d.nbind=function(e,t){var i=J(arguments,2);return function(){function a(){return e.apply(t,arguments)}var n=i.concat(J(arguments)),r=u();return n.push(r.makeNodeResolver()),d(a).fapply(n).fail(r.reject),r.promise}},p.prototype.nbind=function(){var e=J(arguments,0);return e.unshift(this),d.nbind.apply(void 0,e)},d.nmapply=d.npost=function(e,t,i){return d(e).npost(t,i)},p.prototype.nmapply=p.prototype.npost=function(e,t){var i=J(t||[]),a=u();return i.push(a.makeNodeResolver()),this.dispatch("post",[e,i]).fail(a.reject),a.promise},d.nsend=d.nmcall=d.ninvoke=function(e,t){var i=J(arguments,2),a=u();return i.push(a.makeNodeResolver()),d(e).dispatch("post",[t,i]).fail(a.reject),a.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(e){var t=J(arguments,1),i=u();return t.push(i.makeNodeResolver()),this.dispatch("post",[e,t]).fail(i.reject),i.promise},d.nodeify=R,p.prototype.nodeify=function(e){return e?void this.then(function(t){d.nextTick(function(){e(null,t)})},function(t){d.nextTick(function(){e(t)})}):this};var re=l();return d.denodeify2=function(e){var t=J(arguments,1),i=function(){var i=t.concat(J(arguments));if(i.length>0&&"function"==typeof i[i.length-1])return e.apply(null,i);var a=u();return i.push(a.makeNodeResolver()),d(e).fapply(i).fail(a.reject),a.promise},a=e.toString().split(")")[0].split("(")[1],n=a?a.split(",").map(function(e){return e.trim()}):[];return i.$formalParams=n,i},d}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define(t):e.SuiEvent=t()}(this,function(){"use strict";var e={};return e.trigger=function(e,t){var i=e.target||document,a=e.eventName||"",n=new CustomEvent(a,{detail:{data:e.data,q:Q,promiseArray:[]},bubbles:!0,cancelBubble:!0,cancelable:!0});i.dispatchEvent(n),Q.all(n.detail.promiseArray).then(function(){console.log(arguments);var e=arguments[0].indexOf(!1)==-1;t&&t(null,{success:e})},function(){t&&t({message:"exception in "+e.eventName})})},e.promise=function(e,t){if(e&&e.detail&&"function"==typeof e.detail.q&&"function"==typeof t){var i=e.detail.q,a=i.defer();t(e.detail.data,function(e,t){e?a.reject(e):a.resolve(t)}),e.detail.promiseArray instanceof Array&&e.detail.promiseArray.push(a.promise)}},e.version="1.0.1",e}),function(e,t){function i(e){r<o.length?a(e,o[r],i):setTimeout(function(){cmp.dialog.loading(!1);var t=e.contentWindow.document.querySelectorAll(".documents_penetration_16");[].forEach.call(t,function(e){e.css("display","none")});var i=e.contentWindow.document.querySelectorAll("img");[].forEach.call(i,function(e){var t=e.getAttribute("src").toLowerCase();t.indexOf("uploadfile.gif")==-1&&t.indexOf("selecetuser.gif")==-1&&t.indexOf("date.gif")==-1&&t.indexOf("uploadimage.gif")==-1&&t.indexOf("delete.gif")==-1&&t.indexOf("handwrite.gif")==-1||e.css("display","none")})},500),r+=1}function a(e,t,i){var a=document.createElement("script");a.src=n+"/forwardForm/"+t,i=i||function(){},a.onload=a.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i(e),this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this))},e.contentWindow.document.getElementsByTagName("head")[0].appendChild(a)}e.sui=e.sui||{};var n="";e.sui.renderForwardForm=function(e,t){if(n=t,e.containerId){var a=document.getElementById(e.containerId);if(a){var r=a.offsetWidth+"px",o=a.offsetHeight+"px";a.innerHTML='<iframe id="contentfrm" style="width: '+r+";height: "+o+';overflow: hidden;border: none;" ></iframe>';var s=document.getElementById("contentfrm");s.onload=function(){s.contentWindow.document.getElementById("mainbodyHtmlDiv_0").innerHTML=s3scope.contentList[0].contentHtml,e.onScroll&&(s.contentWindow.onScroll=e.onScroll),e.onScrollBottom&&(s.contentWindow.onScrollBottom=e.onScrollBottom),s.contentWindow.serverPath=cmp.origin;var t=s3scope.contentList[0];if(s.contentWindow.formData=s3scope,t.extraMap.formJson){var a=JSON.parse(t.extraMap.formJson);t.tableList=a.tableList,t.pageSize=a.pageSize,t.unShowSubDataIdMap=a.unShowSubDataIdMap,t.id=a.id,s.contentWindow.document.getElementById("#id").value=t.id}s.contentWindow.form=t,i(s)};var l=n+"/forwardForm/content.html";if(cmp.platform.CMPShell){var c={url:l,success:function(e){var t=e.localUrl;s.setAttribute("src",t)},error:function(e){_this.isLoading=!1,console.log("读取iframe地址失败")}};cmp.app.getLocalResourceUrl(c)}else s.setAttribute("src",l)}}};var r=0,o=["jquery-debug.js","dev/new_style/m1-form-style.js","dev/new_style/m1-newCalendar.js","seeyon.ui.calendar-debug.js","dev/new_style/iscroll-zoom.js","m1-global-debug.js","jquery.json-debug.js","v3x-debug.js","m1-form-debug.js","m1-content-debug.js","m1-common-debug.js","jquery.comp-debug.js","jquery.jsonsubmit-debug.js","jquery.code-debug.js","jquery.fillform-debug.js","common-debug.js","seeyon.ui.checkform-debug.js","i18n_en.js"]}(cmp,document),function(e,t){function i(e){switch(e){case"text":return"v-sui-input";case"textarea":return"v-sui-input";case"date":return"v-sui-date";case"datetime":return"v-sui-date";case"flowdealoption":return"v-sui-static";case"lable":return"v-sui-static";case"label":return"v-sui-static";case"member":case"multimember":case"account":case"multiaccount":case"department":case"multidepartment":case"post":case"multipost":case"level":case"multilevel":return"v-sui-organization";default:return"v-sui-"+e}}function a(e){return"relation"==e.inputType||"outwrite"==e.inputType?e.finalInputType:e.inputType}function n(e,t,i){var a=[];return a.push('<div id="'+e+'" class="sui-source-form-ctrl-wrapper '+i+'">'),a.push('<div id="master|'+e+'" sui-type="'+i+'" class="sui-form-ctrl sui-form-viewType-1 sui-form-ctrl-'+e+'">'),a.push("<div "+t+"=\"s3scope.data.master['"+e+"'].value\" v-bind:scope=\"{model:s3scope.data.master['"+e+"'], fieldInfo:s3scope.metadata.fieldInfo['"+e+"'], isMaster:true}\"></div>"),a.push("</div>"),a.push("</div>"),a.join("")}function r(e,t,i,a){var n=[];return n.push('<div id="'+t+'" class="sui-source-form-ctrl-wrapper '+a+'">'),n.push('<div id="'+e+"|{{item.__id}}|"+t+'" sui-type="'+a+'" class="sui-form-ctrl sui-form-viewType-1 sui-form-ctrl-'+t+'">'),n.push("<div "+i+"=\"item['"+t+"'].value\" v-bind:scope=\"{model:item['"+t+"'], fieldInfo:s3scope.metadata.children['"+e+"'].fieldInfo['"+t+"'], isMaster:false}\"></div>"),n.push("</div>"),n.push("</div>"),n.join("")}e.sui=e.sui||{},e.sui.templateConvertor=function(e,t,o){if(o.indexOf('class="sui-form-wrapper"')!=-1)return o;var s=new Date,l=o;e&&(Object.keys(e.fieldInfo||{}).forEach(function(r){if(r.indexOf("field")!=-1&&t.master[r]){var o=e.fieldInfo[r],s="@"+o.name+"@",c=a(o),d=i(c),u=n(o.name,d,c);l=l.replace(s,u)}}),Object.keys(e.children||{}).forEach(function(n){Object.keys(e.children[n].fieldInfo||{}).forEach(function(o){if(o.indexOf("field")!=-1&&t.children[n]&&t.children[n].data&&t.children[n].data.length>0){var s=t.children[n].data[0];if(s[o]){var c=e.children[n].fieldInfo[o],d="@"+c.name+"@",u=a(c),f=i(u),m=r(n,c.name,f,u);l=l.replace(d,m)}}})})),l+='<div v-sui-qrscan v-show="s3scope.allowQRScan" ></div>';var c=document.createElement("div");c.classList.add("sui-form-wrapper"),c.id="formWrapper_"+(new Date).getTime(),c.innerHTML='<div class="sui-form-content" v-bind:class="{ \'sui-form-content-allow-check\': s3scope.allowCheck}"></div>';var d=c.children[0];d.innerHTML=l,d.classList.add("sui-form-grid");var u=d.querySelectorAll("script");Array.apply(null,u).forEach(function(e){e.remove()});var f=d.querySelectorAll("[recordid]");Array.apply(null,f).forEach(function(e){var t=e.querySelectorAll('[id*="formson_"]'),i=t.length;if(i>0){var a=t[0],n=a.id.split("|")[0];e.classList.add("sui-sub-table-record"),e.setAttribute("recordid","{{item.__id}}"),e.setAttribute("tablename",n),e.setAttribute("recordindex","{{$index}}"),e.setAttribute("previd","{{item.__prevId}}"),e.setAttribute("track-by","__id"),e.setAttribute("v-for","item in s3scope.data.children['"+n+"'].data"),"TR"!=e.tagName&&(e.style.display="inline-table");var r=document.createElement(e.tagName);r.classList.add("sui-sub-table-more-ctrl-grid"),r.setAttribute("v-show","s3scope.unShowSubDataIdMap && s3scope.unShowSubDataIdMap['"+n+"'] && s3scope.unShowSubDataIdMap['"+n+"'].length>0"),r.setAttribute("colspan",i),"TR"==e.tagName?r.innerHTML='<td colspan="'+i+'"><span v-on:touchend.prevent v-on:tap="onLoadMore(\''+n+"')\">查看更多</span></td>":r.innerHTML="<span v-on:touchend.prevent v-on:tap=\"onLoadMore('"+n+"')\">查看更多</span>",e.parentNode.appendChild(r),e.parentNode.style.position="relative";var o=document.createElement("div");o.classList.add("see-icon-v5-form-table-collect"),o.setAttribute("v-show",'s3scope.metadata.children["'+n+'"].collectTable'),o.setAttribute("v-on:tap",'onCollectSubTableRecords("'+n+'")'),e.parentNode.appendChild(o)}});var m=c.querySelectorAll("img");Array.apply(null,m).forEach(function(e){if(e.src&&!e.src.startsWith("http")){var t=e.src;t.startsWith("file://")&&(t=t.substring("file://".length)),e.src=cmp.serverIp+t}});var p=new Date;return console.log("耗时：",p-s),c.outerHTML}}(cmp,document),function(e,t){"use strict";function i(e){var t={};return(e||[]).forEach(function(e){t[e.__id]=e}),t}function a(e,t){var i,a,n=e.containerId,r=e.templateId;i=document.getElementById(n),a=s3utils.C_iRefresh_Refresh,s3utils.refreshElement(i,a,window[r].formMain.call(this,t),!0)}function n(t,i){var a=t.containerId,n=(t.templateId,document.getElementById(a));if(n)if("infopath"==i.metadata.templateType)i.metadata.template=e.sui.templateConvertor(i.metadata,i.data,i.metadata.template),n.innerHTML=i.metadata.template,e.sui.nextTick(function(){r(t)});else{n.innerHTML=i.metadata.template;var o=document.querySelector(".sui-form-content");o&&o.classList.add("sui-light-form")}}function r(t){var i=document.querySelector(".sui-form-wrapper"),a=document.querySelector(".sui-form-content"),n=(i.id,i.offsetWidth/a.offsetWidth);console.log("percent",n);var r=0,o=!1;q&&q.destroy(),q=new IScroll("#"+i.id,{zoom:!0,scrollX:!0,scrollY:!0,disableTouch:!1,mouseWheel:!0,zoomStart:n,zoomMin:n>1?1:n,preventDefaultException:{tagName:/^(INPUT|SPAN|IMG|A|TEXTAREA|SELECT)$/},zoomMax:1,wheelAction:"zoom"}),e.storage.get(e.sui.getErrorInfoKey(),!0)||u(n);i.addEventListener("tap",function(t){console.log("in wrapper tap"),e.sui.nextTick(function(){s(t.target)})}),t.onScrollBottom&&q.on("scrollEnd",function(){o&&(r>0?(console.log("bottom"),t.onScrollBottom(),r=0):r++)}),q.on("scroll",function(e){t.onScroll&&t.onScroll(-q.y,q.directionY),o=q.y<=q.maxScrollY-10});var l,c,d=!1;i.addEventListener("touchstart",function(e){1==e.targetTouches.length?(l=e.touches[0].pageY,c=e.timeStamp,d=!0):d=!1}),i.addEventListener("touchend",function(e){var i=e.changedTouches[0].pageY,a=e.timeStamp;1==d&&i-l>10&&a-c>100&&0==q.y&&t.onScroll&&t.onScroll(-5,-1)})}function o(e,t,i){q&&(q.refresh(),i&&q.zoom(q.options.zoomMax),q.scrollToElement&&q.scrollToElement(e,t,!0,!0))}function s(e){var t=e.closest(".sui-sub-table-record");if(t){var i=t.getAttribute("tablename"),a=s3scope.data.children[i];if(a&&(a.allowAdd||a.allowDelete)){var n,r=document.querySelectorAll(".subTableBtn");if([].forEach.call(r,function(e){e.style.display="none"}),t.querySelector(".subTableBtn"))n=t.querySelector(".subTableBtn"),n.style.display="block";else{if(n=document.createElement("div"),n.setAttribute("class","subTableBtn"),n.innerHTML='<i class="see-icon-v5-form-edit-circle"></i>',"tr"==t.tagName.toLowerCase()){var o=t.childNodes[0];o.appendChild(n);var s=d(o).left,l=parseInt(o.style.paddingLeft.replace("px","").replace("","0")),u=d(document.querySelector(".sui-form-content")).left,f=n.offsetWidth,m=-(f+(s-u-30)+l);m=m>0-f?0-f:m,n.style.marginLeft=m+"px"}else n.style.left="-26px",t.appendChild(n);c(n),n.parentNode.style.position="relative",n.parentNode.style.overflow="visible";var p=n.parentNode.parents("td");p.forEach(function(e){e.style.overflow="visible"})}}}}function l(e){var t=e.closest(".sui-sub-table-record");if(t){var i=t.getAttribute("tablename"),a=s3scope.data.children[i];a.allowAdd||a.allowDelete?e.style.display="block":e.style.display="none"}}function c(t){t.addEventListener("tap",function(){var i=[],a=this.closest(".sui-sub-table-record"),n=a.getAttribute("tablename"),r=s3scope.data.children[n];if(r.allowAdd||r.allowDelete){var o=(a.getAttribute("recordid"),a.getAttribute("recordindex"));r.allowAdd&&(i.push({key:"copy",name:e.i18n("form.childrenTable.copy")}),i.push({key:"empty",name:e.i18n("form.childrenTable.add")})),r.allowDelete&&(i.push({key:"del",name:e.i18n("form.childrenTable.delCurrent")}),i.push({key:"delAll",name:e.i18n("form.childrenTable.delAll")}));var s=!1,c=null;cmp.dialog.actionSheet(i,e.i18n("form.btn.cancel"),function(i){if(s)return c&&clearTimeout(c),void(c=setTimeout(function(){s=!1},5e3));s=!0;var a=s3scope.data.children[n].data,r=a[o];if("copy"==i.key||"empty"==i.key)cmp.dialog.loading(),e.sui.addRecordInSubTable(i.key,n,r,function(i,a){cmp.dialog.loading(!1),i||(l(t),e.sui.refreshIScroll()),s=!1});else if("collect"==i.key)e.sui.collectSubTableRecords(n);else if("del"==i.key)if(a.length>1){var d=e.i18n("form.childrenTable.deleteConfirm");e.notification.confirm(d,function(i){1==i?(cmp.dialog.loading(),e.sui.delRecordInSubTable("del",n,r,function(i,n){cmp.dialog.loading(!1),s=!1,i?e.notification.alert("Error when calling $.sui.delRecordInSubTable!",null,"",e.i18n("form.btn.ok")):(a.splice(o,1),l(t),e.sui.refreshIScroll())})):s=!1},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else e.notification.alert(e.i18n("form.childrenTable.deleteLastNotice"),null,"",e.i18n("form.btn.ok")),s=!1;else"delAll"==i.key&&e.sui.onDeleteAllSubTableRecords(n,function(i,a){i||(l(t),e.sui.refreshIScroll())})},function(){})}})}function d(e){var t=navigator.userAgent.toLowerCase(),i=t.indexOf("opera")!=-1;t.indexOf("msie")!=-1&&!i;if(null===e.parentNode||"none"==e.style.display)return!1;var a=e.getBoundingClientRect();return{left:a.left,top:a.top}}function u(t){if(q){var i=e.storage.get(e.sui.getScrollStateKey(),!0);e.storage.delete(e.sui.getScrollStateKey(),!0),i?(i=e.parseJSON(i),q.zoom(i.scale),q.scrollTo(i.x,i.y,1,!1)):q.zoom(t)}}function f(){if(q){var t={x:q.x,y:q.y,scale:q.scale};e.storage.save(e.sui.getScrollStateKey(),JSON.stringify(t),!0)}}function m(t){var i=e.sui.getLastPosKey();try{if("lightForm"==t.templateType){var a=e.storage.get(i,!0);e.sui.nextTick(function(){var t=document.getElementById(a);t&&(e.sui.scrollIntoView(t),e.sui.lastPosCtrlId=null)})}}catch(t){e.sui.lastPosCtrlId=null}}function p(t){var i=e.sui.getTempKey();if(i)try{var a=JSON.parse(e.storage.get(i,!0));if(a&&a.metadata){cmp.dialog.loading();var n,r;a.metadata.masterField?n=s3scope.data.master[a.metadata.name]:(r=s3scope.data.children[a.metadata.ownerTableName].data.filter(function(e){return e.__id==a.metadata.recordId}),n=r.length>0?r[0][a.metadata.name]:{},"infopath"==s3scope.metadata.templateType&&e.sui.nextTick(function(){var e=document.querySelector('[recordid="'+r[0].__id+'"]');e&&s(e)}));var o="relation"==a.metadata.inputType?a.metadata.finalInputType:a.metadata.inputType;if(a.data)switch(o){case"handwrite":case"barcode":case"linenumber":cmp.dialog.loading(!1);break;case"relationform":e.sui.dataService.capForm.dealFormRelation({selectArray:a.data.selectArray,fieldName:a.metadata.name,rightId:s3scope.rightId,toFormId:a.metadata.relation.toRelationObj,fromFormId:a.metadata.relation.fromRelationObj,recordId:a.metadata.recordId,fromDataId:s3scope.formMasterId,moduleId:s3scope.moduleId,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)},function(t,i){return t?(cmp.dialog.loading(!1),void e.notification.alert(t.message||"Error when calling dealFormRelation!",null,"",e.i18n("form.btn.ok"))):void e.sui.refreshFormData(r&&r.length>0?r[0]:null,i.results?i.results:i,function(){cmp.dialog.loading(!1)})});break;case"relation":case"project":cmp.dialog.loading(!1);break;case"member":case"account":case"department":case"post":case"level":var l=[],c=[];console.log(a.data),(a.data.orgResult||[]).forEach(function(e){"string"==typeof e&&(e=JSON.parse(e)),l.push(e.id),c.push(e.name)}),n.value=l.join(","),n.display=c.join("、"),e.sui.dataService.capForm.dealOrgFieldRelation({formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:a.metadata.name,recordId:a.metadata.recordId,selectType:a.metadata.finalInputType,orgId:n.value,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)},function(t,i){return t?(cmp.dialog.loading(!1),void e.notification.alert(t.message||"Error when calling dealOrgFieldRelation!",null,"",e.i18n("form.btn.ok"))):void e.sui.refreshFormData(r&&r.length>0?r[0]:null,i.results?i.results:i,function(){cmp.dialog.loading(!1)})});break;case"multimember":case"multiaccount":case"multidepartment":case"multipost":case"multilevel":var l=[],c=[];console.log(a.data),(a.data.orgResult||[]).forEach(function(e){"string"==typeof e&&(e=JSON.parse(e)),l.push(e.id),c.push(e.name)}),n.value=l.join(","),n.display=c.join("、");var t={formMasterId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:a.metadata.name,recordId:a.metadata.recordId,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};e.sui.dataService.capForm.calculate(t,function(t,i){return t?(cmp.dialog.loading(!1),void e.notification.alert(t.message||"Error when calling calculate!",null,"",e.i18n("form.btn.ok"))):void e.sui.refreshFormData(r&&r.length>0?r[0]:null,i.results?i.results:i,function(){cmp.dialog.loading(!1)})});break;case"attachment":case"image":case"document":case"outwrite":case"externalwrite-ahead":cmp.dialog.loading(!1);break;case"exchangetask":e.sui.dataService.capForm.dealDeeRelation({contentDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:a.metadata.name,recordId:a.metadata.recordId,masterId:a.data.masterId,detailRows:a.data.detailRows,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)},function(t,i){return t?(cmp.dialog.loading(!1),void e.notification.alert(t.message||"Error when calling dealDeeRelation!",null,"",e.i18n("form.btn.ok"))):void e.sui.refreshFormData(r&&r.length>0?r[0]:null,i.results?i.results:i,function(){
cmp.dialog.loading(!1)})});break;case"querytask":break;case"mapmarked":case"maplocate":case"mapphoto":cmp.dialog.loading(!1);break;case"customcontrol":cmp.dialog.loading(!1),n.display=a.data.display,n.value=a.data.value;break;default:cmp.dialog.loading(!1)}else cmp.dialog.loading(!1);"lightForm"==s3scope.metadata.templateType&&e.sui.nextTick(function(){var t=document.getElementById(a.metadata.ctrlId);e.sui.scrollIntoView(t)})}e.storage.delete(i,!0)}catch(t){console.log(t),e.notification.alert("Error when calling _reSetLastOperation!",null,"",e.i18n("form.btn.ok")),e.storage.delete(i,!0),cmp.dialog.loading(!1)}}function h(){var e=(new Date).getTime();Object.keys(s3scope).forEach(function(e){["data","allowCheck","allowQRScan","subTableExpandInfo","unShowSubDataIdMap"].indexOf(e)!=-1||Object.defineProperty(s3scope,e,{configurable:!1})}),s3scope.data&&(Object.keys(s3scope.data.master).forEach(function(e){if(e.startsWith("field")){var t=s3scope.data.master[e];Object.keys(t||{}).forEach(function(e){"value"!=e&&Object.defineProperty(t,e,{configurable:!1})})}}),Object.keys(s3scope.data.children||{}).forEach(function(e){var t=s3scope.data.children[e].data;s3scope.data.children[e].selected=!!s3scope.data.children[e].selected,(t||[]).forEach(function(e){e.selected=!!e.selected,Object.keys(e).forEach(function(t){if(t.startsWith("field")){var i=e[t];Object.keys(i||{}).forEach(function(e){"value"!=e&&Object.defineProperty(i,e,{configurable:!1})})}})})}));var t=(new Date).getTime();console.log(e),console.log(t),console.log(t-e)}function v(t,i,a){return s3scope.contentList.length>0&&"10"==s3scope.contentList[0].contentType?void e.sui.renderForwardForm(t,C):(e.sui.formDestroy(t),i.call(this,t,window.s3scope),h(),V&&(V.$destroy(),V=null),t.containerId&&"undefined"!=typeof Vue&&(V=new Vue({el:"#"+t.containerId,data:{s3scope:s3scope},methods:{onDeleteAllSubTableRecords:function(t){e.sui.onDeleteAllSubTableRecords(t)},onCollectSubTableRecords:function(t){e.sui.collectSubTableRecords(t)},onSelectAll:function(e){s3scope.data.children[e].selected=!s3scope.data.children[e].selected,(s3scope.data.children[e].data||[]).forEach(function(t){t.selected=s3scope.data.children[e].selected})},onLoadMore:function(i){if(s3scope.unShowSubDataIdMap&&s3scope.unShowSubDataIdMap[i]){cmp.dialog.loading();var a=s3scope.unShowSubDataIdMap[i].slice(0,20),n={dataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,tableName:i,nextPage:a.join(","),data:e.sui.reduceSubmitData(s3scope.data),viewState:t.viewState};e.sui.dataService.capForm.showMore(n,function(t,a){return t?(cmp.dialog.loading(!1),void e.notification.alert("Error when calling showMore!",null,"",e.i18n("form.btn.ok"))):(a.results.data&&a.results.data.children&&a.results.data.children[i]&&(s3scope.unShowSubDataIdMap[i].splice(0,20),e.sui.refreshFormData(null,a.results),e.sui.refreshIScroll()),void cmp.dialog.loading(!1))})}}}}),window.testVue=V),a&&g(t),void w())}function g(t){m(t),p(t),e.sui.showFormErrorTips(t)}function y(t){var i=e.sui.getCachedDataKey();if(e.storageDB.save(i,window.s3scope,function(e){}),e.sui.lastPosCtrlId){var a=e.sui.getLastPosKey();e.storage.save(a,e.sui.lastPosCtrlId,!0)}window.s3scope&&window.s3scope.metadata&&"infopath"==window.s3scope.metadata.templateType&&f()}function I(e){document.removeEventListener("beforepageredirect",y),document.addEventListener("beforepageredirect",y)}function b(t,i,a){e.sui.initCacheKeyMap(t);var n=e.sui.getCachedDataKey();I(t);var r=e.sui.getStoreFlagKey(),o="1"===sessionStorage.getItem(r);e.storageDB.get(n,function(s){s.success&&s.data&&o?(window.s3scope=s.data,window.s3scope.allowCheck=!!t.allowCheck,window.s3scope.allowQRScan=!!t.allowQRScan,window.s3scope.attachmentInputs=window.s3scope.attachmentInputs||{},window.s3scope.signatures=window.s3scope.signatures||{},window.s3scope.indexParam=t.indexParam,window.s3scope.moduleId=t.summaryId?t.summaryId:t.moduleId,window.s3scope.affaireId=t.affairId,window.s3scope.templateType=t.templateType,"function"==typeof t.callback&&t.callback(window.s3scope.contentList),S(t,function(r,o){!r&&o&&(o.isForwardForm||o.metadata)?window.s3scope.metadata=o.metadata:e.notification.alert("表单切换时模板加载异常!",function(){a&&a({message:"表单切换时模板加载异常!"})},"",e.i18n("form.btn.ok"));try{v(t,i,!0),e.storageDB.delete(n,function(e){}),a&&a()}catch(t){console.log(t),e.storageDB.delete(n,function(e){}),a&&a(t)}})):e.sui.dataService.capForm.showFormData(t,function(o,s){if(o)return void e.notification.alert(o.message||o.responseText,function(){a&&a(o)},"",e.i18n("form.btn.ok"));if(0==s.success)return void e.notification.alert("Error when calling showFormData!",function(){a&&a(o)},"",e.i18n("form.btn.ok"));e.sui.s3scopeInit(t,s),sessionStorage.setItem(r,"1"),"function"==typeof t.callback&&t.callback(window.s3scope.contentList);try{window.s3scope.subTableExpandInfo={},window.s3scope.metadata&&Object.keys(window.s3scope.metadata.children||{}).forEach(function(e){window.s3scope.subTableExpandInfo[e]=window.s3scope.metadata.children[e].expand||!1}),v(t,i,!1),e.storageDB.delete(n,function(e){}),a&&a()}catch(t){console.log(t),e.storageDB.delete(n,function(e){}),a&&a(t)}})})}function w(){SuiEvent.trigger({target:document,eventName:"sui_form_afterFormRender",data:{contentDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,metadata:s3scope.metadata}},function(e,t){})}function S(t,i){if(window.s3scope&&window.s3scope.contentList.length>0&&"10"==window.s3scope.contentList[0].contentType)i&&i(null,{metadata:window.s3scope.metadata,isForwardForm:!0});else if(window.s3scope&&window.s3scope.metadata&&window.s3scope.metadata.templateType==t.templateType&&window.s3scope.indexParam==t.indexParam&&t.rightId.indexOf(window.s3scope.rightId)!=-1)i&&i(null,{metadata:window.s3scope.metadata});else{var a=e.sui.getErrorInfoKey();e.storage.delete(a,!0),t.formId=window.s3scope.formId,t.contentDataId=window.s3scope.formMasterId,e.sui.dataService.capForm.loadTemplate(t,function(e,t){console.log(t),i&&i(e,t)})}}function k(t,i,a,n){var r="";switch(a){case"text":t.value=i.model.value.escapeHTML(),"browse"==n||"relationform"==i.fieldInfo.inputType?(t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>","urlPage"==i.fieldInfo.formatType||e.sui.urlAssert(i.model.display)?r="<div "+e.sui.attrBuilder({url:i.model.value.escapeHTML(),class:"sui-input-url sui-form-ctrl-value-display sui-text-multi",id:i.fieldInfo.name})+">"+i.model.display.escapeHTML()+"</div>":r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-text-multi",id:i.fieldInfo.name})+">"+i.model.display.escapeHTML()+"</div>"):r+="<input "+e.sui.attrBuilder(t)+"/>";break;case"textarea":t.value=i.model.value.escapeHTML(),"relationform"==i.fieldInfo.inputType&&(t.readonly="true"),"browse"!=n||"urlPage"!=i.fieldInfo.formatType&&!e.sui.urlAssert(i.model.display)?r+="<textarea "+e.sui.attrBuilder(t)+">"+i.model.value+"</textarea>":r="<div "+e.sui.attrBuilder({url:i.model.value.escapeHTML(),class:"sui-input-url sui-form-ctrl-value-display sui-text-multi",id:i.fieldInfo.name})+">"+i.model.display.escapeHTML()+"</div>";break;case"checkbox":t.type="checkbox",t.value=i.model.value,t.checked=i.model.value,t.class+=" see-icon","browse"==n&&(t.disabled=!0,t.readonly=!0),r+="<input "+e.sui.attrBuilder(t)+"/>";break;case"radio":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+='<form class="sui-form-ctrl-value-display sui-radio-group" id="radiogroup_'+i.fieldInfo.name+'">',i.model.items=i.model.items||[];var o=i.model.items,s="radio_"+i.fieldInfo.name,l={name:s};"browse"==n&&(l.disabled=!0,l.readonly=!0,l.id=i.fieldInfo.name),o.forEach(function(t){l.value=t.value,r+='<div class="sui-radio-item">',r+='<input type="radio"'+e.sui.attrBuilder(l)+" /><label>"+(t.text||t.display||"").escapeHTML()+"</label>",r+="</div>"}),r+="</form>";break;case"select":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>";var c=(i.model.items||[]).filter(function(e){return e.value==i.model.value}),d=0==c.length?i.model.display:c[0].text||c[0].display||"";d="image4image"==i.fieldInfo.formatType?d||i.fieldInfo.desc||"":(d||i.fieldInfo.desc||"").escapeHTML(),"infopath"==s3scope.metadata.templateType&&"edit"==n&&(d='<div class="sui-text-single">'+d+"</div>"),r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display "+(i.model.display&&i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">",r+=d+"</div>",r+='<i class="see-icon-v5-form-pull-down"></i>';break;case"date":case"datetime":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide";var u=T(a,i.fieldInfo.formatType);r+="<input "+e.sui.attrBuilder(t)+"/>";var f=new Date(i.model.value);if(isNaN(f)){var m=i.model.value.split(/[- :]/);m.length>=5?f=new Date(m[0],m[1]-1,m[2],m[3],m[4]):m.length>=3&&(f=new Date(m[0],m[1]-1,m[2]))}var d=isNaN(f)?"":f.format(u),p=d||i.fieldInfo.desc||"";"infopath"==s3scope.metadata.templateType&&"edit"==n&&(p='<div class="sui-text-single">'+p+"</div>"),r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+p+"</div>",r+=d?'<i action="clear-value" class="see-icon-v5-form-close-circle-fill"></i>':'<i class="see-icon-v5-form-pull-down"></i>';break;case"flowdealoption":case"lable":case"label":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-text-multi sui-form-ctrl-static "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+(i.model.display||i.fieldInfo.desc||"")+"</div>";break;case"handwrite":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-handwrite",id:i.fieldInfo.name})+">";var h="";i.model.signature&&i.model.signature.picData&&i.model.signature.fieldValue&&(h=' src="data:image/png;base64,'+i.model.signature.picData+'" '),r+="<img "+h+' filename="'+(i.model.display||i.fieldInfo.desc||"")+'">',r+="</div>",r+='<i class="see-icon-v5-form-pull-right"></i>';break;case"barcode":if("relation"!=i.fieldInfo.inputType&&"relationform"!=i.fieldInfo.inputType||(i.model.__state="modified"),t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-barcode",id:i.fieldInfo.name})+">",i.model.attData=i.model.attData||[],i.model.attData instanceof Array&&i.model.attData.length>0){var v=e.sui.dataService.debug?e.sui.dataService.targetServer:e.serverIp,g=v+"/seeyon/fileUpload.do?method=showRTE&showType=small&type=image&fileId="+i.model.attData[0].fileUrl+"&createDate="+new Date(Number(i.model.attData[0].createdate)).format("yyyy-MM-dd");r+='<img src="'+g+'" url="'+g+'" fileid="'+i.model.attData[0].fileUrl+'" filename="'+i.model.attData[0].filename+'">',"edit"==n&&(r+='    <i class="see-icon-v5-form-close-circle-fill"></i>')}r+="</div>","edit"==n&&(r+='<i class="see-icon-v5-form-qrcode"></i>');break;case"relationform":var y=i.fieldInfo.finalInputType;if(i.fieldInfo.relation&&i.model.through){if("1"==i.fieldInfo.relation.toRelationFormType)r+=k(t,i,"relationform-flow-name",e.sui.getFieldAuth("browse"));else if(["2","3"].indexOf(i.fieldInfo.relation.toRelationFormType)!=-1&&(r+=k(t,i,y,e.sui.getFieldAuth("browse")),"browse"==i.model.auth)){var I="form_relation_to_"+i.fieldInfo.name+"_"+e.sui.uuid++;r+='<i id="'+I+'" class="see-icon-v5-form-relation-to relationform allow-click-relationform"></i>',e.sui.doUpdateRelationFormInfo(I,i,i.fieldInfo.name,i.model.display)}}else r+=k(t,i,y,e.sui.getFieldAuth("browse"));"edit"==i.model.auth&&(r+='<i class="see-icon-v5-form-ic-form-fill relationform"></i>');break;case"relationform-flow-name":t.value=i.model.value.escapeHTML(),t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display",id:i.fieldInfo.name})+">";var I="flow_name_"+i.fieldInfo.name+"_"+e.sui.uuid++;if(r+='<div id="'+I+'"'+e.sui.attrBuilder({class:"sui-form-ctrl-flow-name allow-click-relationform"})+">"+i.model.display.escapeHTML()+"</div>",e.sui.doUpdateRelationFormInfo(I,i,i.fieldInfo.name,i.model.display),i.model.relationList&&i.model.relationList.length>0)for(var b=i.model.relationList.length,w=0;w<b;w++){var S=i.model.relationList[w],D=document.createElement("div");D.classList.add("sui-form-ctrl-flow-name"),D.classList.add("allow-click-relationform"),D.classList.add("sub-relationlist"),D.setAttribute("see-att-data",JSON.stringify(S)),D.innerHTML=S.title,r+=D.outerHTML,D.remove(),D=null}r+="</div>";break;case"relation":break;case"project":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide";var p=(i.model.display||i.fieldInfo.desc||"").escapeHTML();"infopath"==s3scope.metadata.templateType&&"edit"==n&&(p='<div class="sui-text-single">'+p+"</div>"),r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-project "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+p+"</div>",r+='<i class="see-icon-v5-form-pull-right"></i>';break;case"member":case"multimember":case"account":case"multiaccount":case"department":case"multidepartment":case"post":case"multipost":case"level":case"multilevel":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({style:"width:inherit;",class:"sui-form-ctrl-value-display organization "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+(i.model.display||i.fieldInfo.desc||"").escapeHTML()+"</div>",r+=i.model.display&&"lightForm"==s3scope.metadata.templateType?'<i action="clear-value" class="see-icon-v5-form-close-circle-fill"></i>':'<i class="see-icon-v5-form-pull-right"></i>';break;case"attachment":"relation"!=i.fieldInfo.inputType&&"relationform"!=i.fieldInfo.inputType||(i.model.__state="modified"),t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-attachment",id:i.fieldInfo.name})+">",i.model.attData=i.model.attData||[];var o=i.model.attData,v=e.sui.dataService.debug?e.sui.dataService.targetServer:e.serverIp;o.length>0?(r+='<div class="attachment-items">',o.forEach(function(e){e.remoteSource=e.remoteSource?e.remoteSource:v+"/seeyon/rest/attachment/file/"+e.fileUrl;e.localSource||e.remoteSource;r+='   <div class="attachment-item">',r+='       <i class="attachment-icon '+E(e.extension)+'"></i>';var t=document.createElement("div");t.classList.add("attachment-content"),t.classList.add("allow-click-attachment"),t.setAttribute("see-att-data",JSON.stringify(e)),t.innerHTML=e.filename,r+=t.outerHTML,"edit"==n&&(r+='    <i class="see-icon-v5-form-close-circle-fill"></i>'),r+="   </div>"})):r+='<div class="attachment-items items-empty">',r+="</div>","edit"==n&&(r+='<div class="attachment-add-item">'+(e.i18n("form.attachment.uploadLimit")||"请选择小于3M的文件上传")+'\t\t <div class="icon-add">           <i class="see-icon-v5-form-add"></i>\t\t</div>\t</div>'),r+="</div>",r+="</div>";break;case"image":"relation"!=i.fieldInfo.inputType&&"relationform"!=i.fieldInfo.inputType||(i.model.__state="modified"),t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-image",id:i.fieldInfo.name})+">",i.model.attData=i.model.attData||[];var o=i.model.attData,v=e.sui.dataService.debug?e.sui.dataService.targetServer:e.serverIp;if("lightForm"==s3scope.metadata.templateType)r+='<div class="image-items">',o.forEach(function(e){e.remoteSource=e.remoteSource?e.remoteSource:v+"/seeyon/fileUpload.do?method=showRTE&showType=small&smallPX=200&type=image&fileId="+e.fileUrl+"&createDate="+new Date(Number(e.createdate)).format("yyyy-MM-dd");var t=e.localSource||e.remoteSource,i=v+"/seeyon/fileUpload.do?method=showRTE&type=image&fileId="+e.fileUrl+"&createDate="+new Date(Number(e.createdate)).format("yyyy-MM-dd");r+='   <div class="image-item">',r+='       <div class="sui-image-wrapper">',r+='           <img src="'+t+'" url="'+i+'" fileid="'+e.fileUrl+'" filename="'+e.filename+'"/>',r+="       </div>","edit"==n&&(r+='       <div class="image-icon-close">',r+='           <i class="see-icon-v5-form-close-circle"></i>',r+="       </div>"),r+="   </div>"}),"edit"==n&&(r+='<div class="image-add-item">\t\t<div class="sui-image-wrapper">\t\t\t<div class="top">\t\t\t\t<i class="see-icon-v5-form-import-img"></i>\t\t\t</div>\t\t\t<div class="bottom">'+(e.i18n("form.image.upload")||"请上传图片")+"</div>\t\t</div>\t</div>"),r+="</div>";else{if(r+='<div class="infopath-image-item">',o.length>0){var L=o[0];L.remoteSource=L.remoteSource?L.remoteSource:v+"/seeyon/fileUpload.do?method=showRTE&showType=small&smallPX=200&type=image&fileId="+L.fileUrl+"&createDate="+new Date(Number(L.createdate)).format("yyyy-MM-dd");var g=L.localSource||L.remoteSource,x=v+"/seeyon/fileUpload.do?method=showRTE&type=image&fileId="+L.fileUrl+"&createDate="+new Date(Number(L.createdate)).format("yyyy-MM-dd");r+='<img src="'+g+'" url="'+x+'" fileid="'+L.fileUrl+'" filename="'+L.filename+'"/>',"edit"==n&&(r+='<i class="see-icon-v5-form-close-circle-fill"></i>')}r+="</div>","edit"==n&&(r+='<div class="image-add-item">',r+='<i class="see-icon-v5-form-import-img"></i>',r+="</div>")}r+="</div>";break;case"document":"relation"!=i.fieldInfo.inputType&&"relationform"!=i.fieldInfo.inputType||(i.model.__state="modified"),t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-document",id:i.fieldInfo.name})+">",i.model.attData=i.model.attData||[];var o=i.model.attData,v=e.sui.dataService.debug?e.sui.dataService.targetServer:e.serverIp;o.length>0?(r+='<div class="document-items">',o.forEach(function(e){e.remoteSource=e.remoteSource?e.remoteSource:v+"/seeyon/rest/document/file/"+e.fileUrl;e.localSource||e.remoteSource;r+='   <div class="document-item">',r+="collaboration"==e.mimeType?'       <i class="document-icon see-icon-v5-form-ic-col-fill"></i>':"edoc"==e.mimeType?'       <i class="document-icon see-icon-v5-form-ic-offdoc-fill"></i>':'       <i class="document-icon see-icon-v5-form-relation-doc"></i>';var t=document.createElement("div");t.classList.add("document-content"),t.classList.add("allow-click-attachment"),t.setAttribute("see-att-data",JSON.stringify(e)),t.innerHTML=e.filename,r+=t.outerHTML,"edit"==n&&(r+='    <i class="see-icon-v5-form-close-circle-fill"></i>'),r+="   </div>"})):r+='<div class="document-items items-empty">',r+="</div>","edit"==n&&(r+='<div class="document-add-item">'+(e.i18n("form.document.notice")||"请选择关联文档")+'\t\t <div class="icon-add">           <i class="see-icon-v5-form-add"></i>\t\t</div>\t</div>'),r+="</div>",r+="</div>";break;case"outwrite":var y=i.fieldInfo.finalInputType;if(i.model.through&&i.model.extMap){t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display",id:i.fieldInfo.name})+">";var D=document.createElement("div");D.classList.add("sui-form-ctrl-flow-name"),D.classList.add("allow-click-relationform"),D.setAttribute("see-att-data",JSON.stringify(i.model.extMap||{})),D.innerHTML=(i.model.display||"").escapeHTML(),r+=D.outerHTML,D.remove(),D=null,r+="</div>"}else r+=k(t,i,y,e.sui.getFieldAuth("browse"));break;case"externalwrite-ahead":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-static "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+(i.model.display||i.fieldInfo.desc||"").escapeHTML()+"</div>";break;case"exchangetask":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+(i.model.display||i.fieldInfo.desc||"").escapeHTML()+"</div>",r+='<i class="see-icon-v5-form-pull-right"></i>';break;case"querytask":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-querytask "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+(i.fieldInfo.desc||"").escapeHTML()+"</div>",r+='<i class="see-icon-v5-form-search"></i>';break;case"mapmarked":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide";var d=i.model.display||i.fieldInfo.desc||"";"infopath"==s3scope.metadata.templateType&&(d='<div class="sui-text-single">'+d+"</div>"),r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-mapmarked "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+d,"edit"==n&&(r+='<i class="see-icon-v5-form-location-fill"></i>',i.model.value),r+="</div>";break;case"maplocate":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide";var d=i.model.display||i.fieldInfo.desc||"";"infopath"==s3scope.metadata.templateType&&(d='<div class="sui-text-single">'+d+"</div>"),r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-maplocate "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+d,"edit"==n&&i.model.value&&(r+='<i class="see-icon-v5-form-close-circle-fill"></i>'),r+="</div>",r+='<i class="see-icon-v5-form-location-fill"></i>';break;case"mapphoto":"relation"!=i.fieldInfo.inputType&&"relationform"!=i.fieldInfo.inputType||(i.model.__state="modified"),t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-image",id:i.fieldInfo.name})+">",i.model.attData=i.model.attData||[];var o=i.model.attData,v=e.sui.dataService.debug?e.sui.dataService.targetServer:e.serverIp;if("lightForm"==s3scope.metadata.templateType)r+='<div class="image-items">',o.forEach(function(e){e.remoteSource=e.remoteSource?e.remoteSource:v+"/seeyon/fileUpload.do?method=showRTE&showType=small&smallPX=200&type=image&fileId="+e.fileUrl+"&createDate="+new Date(Number(e.createdate)).format("yyyy-MM-dd");var t=e.localSource||e.remoteSource,i=v+"/seeyon/fileUpload.do?method=showRTE&type=image&fileId="+e.fileUrl+"&createDate="+new Date(Number(e.createdate)).format("yyyy-MM-dd");r+='   <div class="image-item">',r+='       <div class="sui-image-wrapper">',r+='           <img src="'+t+'" url="'+i+'" fileid="'+e.fileUrl+'" filename="'+e.filename+'"/>',r+="       </div>","edit"==n&&(r+='       <div class="image-icon-close">',r+='           <i class="see-icon-v5-form-close-circle"></i>',r+="       </div>"),r+="   </div>"}),"edit"==n&&(r+='<div class="image-add-item">\t\t<div class="sui-image-wrapper">\t\t\t<div class="top">\t\t\t\t<i class="see-icon-v5-form-camera-fill"></i>\t\t\t</div>\t\t\t<div class="bottom">'+(e.i18n("form.photo.notice")||"请拍照定位")+"</div>\t\t</div>\t</div>"),r+="</div>",r+="</div>";else{if(r+='<div class="infopath-image-item">',o.length>0){var L=o[0];L.remoteSource=L.remoteSource?L.remoteSource:v+"/seeyon/fileUpload.do?method=showRTE&showType=small&smallPX=200&type=image&fileId="+L.fileUrl+"&createDate="+new Date(Number(L.createdate)).format("yyyy-MM-dd");var g=L.localSource||L.remoteSource,x=v+"/seeyon/fileUpload.do?method=showRTE&type=image&fileId="+L.fileUrl+"&createDate="+new Date(Number(L.createdate)).format("yyyy-MM-dd");r+='<img src="'+g+'" url="'+x+'" fileid="'+L.fileUrl+'" filename="'+L.filename+'"/>',"edit"==n&&(r+='<i class="see-icon-v5-form-close-circle-fill"></i>')}r+="</div>","edit"==n&&(r+='<div class="image-add-item">',r+='<i class="see-icon-v5-form-camera-fill"></i>',r+="</div>")}break;case"linenumber":case"customcontrol":t.value=i.model.value,t.readonly="true",t.class+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-display sui-form-ctrl-static "+(i.model.value?"":"sui-form-placeholder"),id:i.fieldInfo.name})+">"+(i.model.display||i.fieldInfo.desc||"").escapeHTML()+"</div>"}return"hide"==n&&(r+="<div "+e.sui.attrBuilder({class:"sui-form-ctrl-value-hide",id:i.fieldInfo.name})+">***</div>"),r}function T(e,t){if("date"!=e)return"yyyy-MM-dd hh:mm";switch(t){case"yyyy-mm-dd-china":return"yyyy年M月d日-china";case"yyyy-mm-china":return"yyyy年M月-china";case"mm-dd-china":return"M月d日-china";case"yyyy-mm-dd-number":return"yyyy年M月d日";case"yyyy-mm-number":return"yyyy年M月";case"mm-dd-number":return"M月d日";case"day_of_week":return"星期W";default:return"yyyy-MM-dd"}}function E(e){switch(e=(e||"").toLowerCase(),e=e.substring(e.lastIndexOf(".")+1)){case"txt":return"see-icon-v5-form-ic-txt-fill";case"jpg":case"png":case"icon":case"gif":return"see-icon-v5-form-ic-image-fill";case"doc":case"docx":return"see-icon-v5-form-ic-doc-fill";case"xls":case"xlsx":return"see-icon-v5-form-ic-xls-fill";case"ppt":case"pptx":return"see-icon-v5-form-ic-ppt-fill";case"wps":return"see-icon-v5-form-ic-wps-fill";case"vsd":return"see-icon-v5-form-ic-vsd-fill";case"pdf":return"see-icon-v5-form-ic-pdf-fill";case"et":return"see-icon-v5-form-ic-et-fill";case"htm":case"html":case"sht":case"shtm":case"shtml":case"asp":case"aspx":case"jsp":case"php":return"see-icon-v5-form-ic-html-fill";case"mp3":return"see-icon-v5-form-ic-mp3-fill";case"avi":case"mp4":case"wmv":case"rm":case"rmvb":case"mpg":case"mkv":case"flv":return"see-icon-v5-form-ic-mp4-fill";case"wma":case"wav":case"amr":case"ava":case"ACT":return"see-icon-v5-form-ic-voice-fill";case"zip":case"rar":case"jar":case"7z":case"tar":return"see-icon-v5-form-ic-zip-fill"}return"see-icon-v5-form-ic-unknown-fill"}function D(t,i,a){var n={type:2,info:{}},r=i.ruleError||"数据不符合规范，请检查!";(i.fields||[]).forEach(function(e){n.info[e]=r});var o=document.querySelector(".sui-form-content");if(o)F(n);else{var s=e.sui.getErrorInfoKey(t);e.storage.save(s,JSON.stringify(n),!0)}}function L(e,t){if(!e||!t)return!1;for(var i=Object.keys(e),a=i.length,n=0;n<a;n++){var r=i[n];if(r.startsWith("field")){var o=e[r],s=t[r];if(o.attData||s.attData){if(o.value!=s.value)return!1;if(o.attData.length>0||s.attData.length>0)return!1}else if(o&&s&&o.value!=s.value)return!1}}return!0}function x(){for(var e=Object.keys(s3scope.data.children||[]),t=e.length,i=0;i<t;i++){var a=e[i];s3scope.data.children[e[i]];if(s3scope.unShowSubDataIdMap&&s3scope.unShowSubDataIdMap[a]&&s3scope.unShowSubDataIdMap[a].length>0&&s3scope.hasNotNullField&&s3scope.hasNotNullField[a])return!0}return!1}function M(t,i,a){if(e.sui.clearAllErrorTips(t),t.needCheckRule){if(!e.sui.formAssert(t,!0,a))return void(i&&i({message:"form assert failed!"}));if(x())return void e.notification.alert("重复表没有加载全，并且可能包含必填字段，请点击查看更多加载数据！",function(){i&&i({message:"form assert failed!"})},"",e.i18n("form.btn.ok"))}else if(a&&!e.sui.formAssert(t,!1,!0))return void(i&&i({message:"form assert failed!"}));A(t,i)}function A(t,i){t.content=s3scope.contentList[s3scope.indexParam],t.data=e.sui.reduceSubmitData(s3scope.data),t.attachmentInputs=e.sui.getAttachments(s3scope.attachmentInputs),t.signatures=e.sui.getSignatures(s3scope.signatures),void 0!=t.moduleId&&(t.content.moduleId=t.moduleId),t.content.moduleTemplateId==-1&&(t.templateId?t.content.moduleTemplateId=t.templateId:t.content.moduleTemplateId=t.content.id,t.content.id=-1),e.sui.dataService.capForm.saveOrUpdate(t,function(a,n){if(a)return e.notification.alert(a.message,null,"",e.i18n("form.btn.ok")),void(i&&i(a,n));if("true"==n.success)if(n.sn&&"object"==typeof n.sn){var r=n.sn,o="";for(var s in r)o+=e.i18n("form.app.serialNumber",s)+r[s]+"\n";n.snMsg=o,!t.notSaveDB&&e.sui.clearCache(t),i&&i(a,n)}else!t.notSaveDB&&e.sui.clearCache(t),i&&i(a,n);else if(n.errorMsg)try{var l=n.errorMsg;if("string"==typeof n.errorMsg&&(l=JSON.parse(n.errorMsg)),l.ruleError&&1!=l.forceCheck){var c=l.ruleError;cmp.dialog.loading(!1),e.notification.confirm(c,function(a){return 1==a?(t.needCheckRule=!1,M(t,i,!1)):(e.sui.clearAllErrorTips(t),void(i&&i({message:"后台校验出错"},n)))},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.continue")])}else e.sui.clearAllErrorTips(t),D(t,l,!0),i&&i({message:"后台校验出错"},n)}catch(t){e.notification.alert(n.errorMsg,function(){i&&i({message:n.errorMsg},n)},"",e.i18n("form.btn.ok"))}else i&&i({message:"提交失败"},n)})}function _(e){if(e&&e.id&&e.id.indexOf("master|")==-1){var t=e.id.split("|")[0];s3scope.subTableExpandInfo[t]=!0}}function F(t){var i="";"1"==t.type?Object.keys(t.info).forEach(function(a){var n=document.getElementById(a);n?(_(n),e.sui.nextTick(function(){e.sui.setCtrlErrorTips(n,t.info[a])})):i+=t.info[a]}):Object.keys(t.info).forEach(function(a){var n=document.querySelectorAll(".sui-form-ctrl-"+a);n&&n.length>0?Array.apply(null,n).forEach(function(i){_(i),e.sui.nextTick(function(){e.sui.setCtrlErrorTips(i,t.info[a])})}):i+=t.info[a]});var a=document.querySelector(".sui-form-content");i&&a&&e.sui.nextTick(function(){e.notification.alert(i,null,"",e.i18n("form.btn.ok"))})}function N(e){var t=(e||"").split("|"),i=null,a=null,n="0";if(2==t.length&&"master"==t[0]){var r=t[1];i=s3scope.data.master[r],a=s3scope.metadata.fieldInfo[r]}else if(3==t.length){var o=t[0];n=t[1];var r=t[2],s=s3scope.data.children[o].data,l=(s||[]).filter(function(e){return e.__id==n});l.length>0&&(i=l[0][r]),a=s3scope.metadata.children[o].fieldInfo[r]}return{model:i,fieldInfo:a,recordId:n}}function H(e,t){if(e.notNull)if(["attachment","document","image"].indexOf(t.finalInputType)!=-1){if(!e.attData||!e.attData.length)return!0}else if("handwrite"==t.finalInputType){if(!e.signature||!e.signature.fieldValue)return!0}else if(void 0==e.value||null==e.value||""==e.value)return!0;return!1}function O(e){return e.openFrom="listPending",e.indexParam=e.indexParam||0,e.style="1",e}function B(e){if(e.master&&s3scope.metadata.fieldInfo&&Object.keys(e.master).forEach(function(t){e.master[t]instanceof Object&&void 0!==e.master[t].value&&s3scope.data.master[t]&&(s3scope.metadata.fieldInfo[t]&&"DECIMAL"==s3scope.metadata.fieldInfo[t].fieldType?s3scope.data.master[t].value="0000000000":s3scope.data.master[t].value="     ")}),e.children&&s3scope.metadata.children)for(var t in e.children){var a=e.children[t].data;if(a&&s3scope.data.children[t]&&s3scope.metadata.children[t])for(var n=a.length,r=s3scope.data.children[t].data||[],o=i(r),s=0;s<n;s++){var l=a[s];o.hasOwnProperty(l.__id)&&Object.keys(l).forEach(function(e){l[e]instanceof Object&&void 0!==l[e].value&&o[l.__id][e]&&(s3scope.metadata.children[t]&&s3scope.metadata.children[t].fieldInfo[e]&&"DECIMAL"==s3scope.metadata.children[t].fieldInfo[e].fieldType?o[l.__id][e].value="0000000000":o[l.__id][e].value="     ")})}}}function j(t,i,a,n,r,o){cmp.dialog.loading(),e.lbs.takePicture({uploadPicUrl:r,serverDateUrl:o,userName:e.member&&e.member.name?e.member.name:"",success:function(n){cmp.dialog.loading(!1),"string"==typeof n&&(n=JSON.parse(n)),n&&e.sui.dataService.cmplbs.save(n,function(r,o){i.attData.splice(0);var s=o.value,l=s3scope.moduleId;(n.listAttachment||[]).forEach(function(e){e.subReference=s,e.reference=l,e.createdate=e.createdate||(new Date).getTime().toString(),i.attData.push(e)}),i.__state="modified",i.editAttr=!0,t.set(o.value),t.update(o.value);var c=e.sui.getRecordIdByVueElement(t.el,a),d={formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:a.name,recordId:c,lbsId:o.value,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)
};e.sui.dataService.capForm.dealLbsFieldRelation(d,function(t,i){return t?void e.notification.alert(t.message||"Error when calling dealLbsFieldRelation!",null,"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i)})})},cancel:function(){cmp.dialog.loading(!1)},error:function(e){cmp.dialog.loading(!1)}})}var C="";C=e.platform.CMPShell?"http://form.v5.cmp/v":"/seeyon/m3/apps/v5/form",e.i18n.load(C+"/i18n/","form",function(){},"20170520");var R=/^(https|http|ftp|rtsp|mms)?:\/\/([0-9A-Za-z_-]+\.?)+(\/[0-9A-Za-z_-]+)*(\.[0-9a-zA-Z-_]*)?(:?[0-9]{1,4})?(\/[\u4E00-\u9FA50-9A-Za-z_-]+\.?[\u4E00-\u9FA50-9A-Za-z_-]+)*(\?([\u4E00-\u9FA50-9a-zA-Z-_]+=[\u4E00-\u9FA50-9a-zA-Z-_%]*(&|&amp;)?)*)?\/?$/,P=/^(https|http|ftp|rtsp|mms):\/\/\[\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*\]:([0-9]{1,5}$)?/,V=null,q=null,K=!1;Date.prototype.format=function(e){function t(e){if(r){e=parseInt(e).toString();for(var t=e.length,i="",n=0;n<t;n++)i+=a[parseInt(e[n])];return i}return e.toString()}function i(e){if(r){e=parseInt(e);var t=a[e];return t}return e.toString()}var a=["〇","一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十","二十一","二十二","二十三","二十四","二十五","二十六","二十七","二十八","二十九","三十","三十一"],n=["日","一","二","三","四","五","六"],r=!1;e.indexOf("-china")>=0&&(e=e.replace("-china",""),r=!0);var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"W+":n[this.getDay()],"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,t(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in o)if(new RegExp("("+s+")").test(e)){var l="";if(1==RegExp.$1.length)l=i(o[s]);else{var c=i(o[s]),d=i("0")+c;l=d.substr(d.length-Math.max(2,c.length))}e=e.replace(RegExp.$1,l)}return e},String.prototype.htmlEncode=function(){var e=this;return 0==this.length?"":(e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"))},String.prototype.htmlDecode=function(){var e="";return 0==this.length?"":(e=this.replace(/&gt;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&nbsp;/g," "),e=e.replace(/&#39;/g,"'"),e=e.replace(/&quot;/g,'"'),e=e.replace(/<br>/g,"\n"))},Element.prototype.suiMatchesSelector=function(e){var t=this;return t.matches?t.matches(e):t.matchesSelector?t.matchesSelector(e):t.webkitMatchesSelector?t.webkitMatchesSelector(e):t.msMatchesSelector?t.msMatchesSelector(e):t.mozMatchesSelector?t.mozMatchesSelector(e):t.oMatchesSelector?t.oMatchesSelector(e):null},Element.prototype.parent=function(e){var t=this;if(!t)return null;for(var i=void 0!==e;null!==(t=t.parentElement);)if(t.nodeType===Node.ELEMENT_NODE&&(!i||t.suiMatchesSelector(e)))return t;return null},Element.prototype.closest=function(e){var t=this;if(!t)return null;var i=void 0!==e;do{if(!i||t.suiMatchesSelector(e))return t;t=t.parent()}while(t&&"BODY"!==t.tagName);return null},Element.prototype.parents=function(e){var t=[],i=this;if(!i)return null;for(var a=void 0!==e;null!==(i=i.parentElement);)i.nodeType===Node.ELEMENT_NODE&&(a&&!i.suiMatchesSelector(e)||t.push(i));return t},HTMLCollection.prototype.toArray=function(){return Array.apply(null,this)},e.sui=e.sui||{},e.sui.preventSubmit=!1,e.sui.onCalcing=!1,e.sui.lastPosCtrlId=null,e.sui.lastPosInput=null,e.sui.uuid=1,e.sui.cacheKeyMap=null,e.sui.nextTick=function(e,t){setTimeout(function(){"function"==typeof e&&e()},t||0)},e.sui.getAttachments=function(e){var t=[];return Object.keys(e||{}).forEach(function(i){var a=e[i];(a||[]).forEach(function(e){var i={};Object.keys(e).forEach(function(t){i["attachment_"+t]=e[t]}),t.push(i)})}),t},e.sui.getSignatures=function(e){var t=[];return Object.keys(e||{}).forEach(function(i){var a=e[i];t.push(a)}),t},e.sui.refreshIScroll=function(){q&&q.refresh()},e.sui.scrollIntoView=function(t){t&&("infopath"==s3scope.metadata.templateType?o(t,100,!0):e.sui.scrollIntoViewIfNeeded(t))},e.sui.scrollIntoViewIfNeeded=function(e){e&&(e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView&&e.scrollIntoView())},e.sui.collectSubTableRecords=function(t){s3scope.subTableExpandInfo[t]=!0;var i={formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,tableName:t,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};cmp.dialog.loading(),e.sui.dataService.capForm.generateSubData(i,function(i,a){return i?(cmp.dialog.loading(!1),void e.notification.alert("Error when calling generateSubData!",null,"",e.i18n("form.btn.ok"))):(console.log(a),s3scope.data.children[t],s3scope.data.children[t]&&s3scope.data.children[t].data&&s3scope.data.children[t].data.splice(0),e.sui.refreshFormData(null,a.results?a.results:a,function(){cmp.dialog.loading(!1)}),void e.sui.refreshIScroll())})},e.sui.cacheFormData=function(t){var i=e.sui.getCachedDataKey();if(e.sui.lastPosCtrlId){var a=e.sui.getLastPosKey();e.storage.save(a,e.sui.lastPosCtrlId,!0)}e.storageDB.save(i,window.s3scope,function(i){i.success?"function"==typeof t&&t():e.notification.alert("缓存表单数据失败！",null,"",e.i18n("form.btn.ok"))})},e.sui.s3scopeInit=function(t,i){e.sui.cacheKeyMap||e.sui.initCacheKeyMap(t);var a=t.indexParam;i.results&&i.contentList&&i.contentList.length>0&&(i.results.formMasterId=i.contentList[a].contentDataId,i.results.formId=i.contentList[a].contentTemplateId,i.results.rightId=i.contentList[a].rightId,i.results.moduleType=i.contentList[a].moduleType),window.s3scope=i.results,window.s3scope.contentList=i.contentList,window.s3scope.moduleId=t.summaryId?t.summaryId:t.moduleId,window.s3scope.affaireId=t.affairId,window.s3scope.allowCheck=!!t.allowCheck,window.s3scope.allowQRScan=!!t.allowQRScan,window.s3scope.indexParam=t.indexParam,window.s3scope.templateType=t.templateType,window.s3scope.attachmentInputs=window.s3scope.attachmentInputs||{},window.s3scope.signatures=window.s3scope.signatures||{}},e.sui.reduceSubmitData=function(){if(!window.s3scope)return{};var e={master:{},children:{}},t=s3scope.data.master;t&&Object.keys(t).forEach(function(i){if(i.indexOf("field")!=-1){var a=t[i];a&&(e.master[i]={value:"     "==a.value?"":a.value},a.__state&&(e.master[i].__state=a.__state))}});var i=s3scope.data.children;return i&&Object.keys(i).forEach(function(t){i[t]&&i[t].data instanceof Array&&(e.children[t]={data:[]},i[t].data.forEach(function(i){var a={__id:i.__id};i.__id;Object.keys(i).forEach(function(e){if(e.indexOf("field")!=-1){var t=i[e];t&&(a[e]={value:"     "==t.value?"":t.value},t.__state&&(a[e].__state=t.__state))}}),e.children[t].data.push(a)}))}),e},e.sui.s3scopeDataConverter=function(){if(window.s3scope){window.s3scope.attachmentInputs={};var t={};if(s3scope.data.master&&s3scope.metadata.fieldInfo){var i=s3scope.data.master;Object.keys(i).forEach(function(e){if(e.indexOf("field")!=-1){var t=i[e],a=s3scope.metadata.fieldInfo[e];if(t&&a){var n="master|"+a.name;["image","document","attachment","barcode","mapphoto"].indexOf(a.finalInputType)!=-1&&(s3scope.attachmentInputs[n]=t.attData)}}})}var a=s3scope.data.children,n=s3scope.metadata.children;return a&&n&&Object.keys(a).forEach(function(e){a[e]&&a[e].data instanceof Array&&n[e]&&n[e].fieldInfo&&a[e].data.forEach(function(t){var i=t.__id;Object.keys(t).forEach(function(a){if(a.indexOf("field")!=-1){var r=t[a],o=n[e].fieldInfo[a];if(r&&o){var s=e+"|"+i+"|"+o.name;["image","document","attachment","barcode","mapphoto"].indexOf(o.finalInputType)!=-1&&(s3scope.attachmentInputs[s]=r.attData)}}})})}),t.attachmentInputs=e.sui.getAttachments(s3scope.attachmentInputs),t}},e.sui.isPreventSubmit=function(){return e.sui.preventSubmit},e.sui.formDestroy=function(e){if(V&&(V.$destroy(),V=null),q&&(q.destroy(),q=null),e){var t=document.getElementById(e.containerId);t&&(t.innerHTML="")}},e.sui.getFormProtectedData=function(e,t){if(!window.s3scope)return{};var i=e?"name":"display",a={};if(s3scope.data.master&&s3scope.metadata.fieldInfo){var n=s3scope.data.master;Object.keys(n).forEach(function(e){if(e.indexOf("field")!=-1){var t=n[e],r=s3scope.metadata.fieldInfo[e];if(t&&r){var o="";if(["image","document","attachment"].indexOf(r.finalInputType)!=-1)o=(t.attData||[]).map(function(e){return e.filename}).join(",");else if(["member","multimember","account","multiaccount","department","multidepartment","post","multipost","level","multilevel"].indexOf(r.finalInputType)!=-1)o=t.display;else if(["select","radio"].indexOf(r.finalInputType)!=-1){var s=(t.items||[]).filter(function(e){return e.value==t.value});s.length>0&&(o=s[0].name)}else o=t.value;"undefined"!=typeof a[r[i]]?a[r[i]].data.push(o):a[r[i]]={fieldType:r.finalInputType,data:[o]}}}})}var r=s3scope.data.children,o=s3scope.metadata.children;return r&&o&&Object.keys(r).forEach(function(e){r[e]&&r[e].data instanceof Array&&o[e]&&o[e].fieldInfo&&r[e].data.forEach(function(t){Object.keys(t).forEach(function(n){if(n.indexOf("field")!=-1){var r=t[n],s=o[e].fieldInfo[n];if(r&&s){var l="";if(["image","document","attachment"].indexOf(s.finalInputType)!=-1)l=(r.attData||[]).map(function(e){return e.filename}).join(",");else if(["member","multimember","account","multiaccount","department","multidepartment","post","multipost","level","multilevel"].indexOf(s.finalInputType)!=-1)l=r.display;else if(["select","radio"].indexOf(s.finalInputType)!=-1){var c=(r.items||[]).filter(function(e){return e.value==r.value});c.length>0&&(l=c[0].name)}else l=r.value;"undefined"!=typeof a[s[i]]?a[s[i]].data.push(l):a[s[i]]={fieldType:s.finalInputType,data:[l]}}}})})}),"function"==typeof t&&t(null,a),a},e.sui.loadFormDataFromCache=function(t,i){e.sui.initCacheKeyMap(t);var a=e.sui.getCachedDataKey();e.storageDB.get(a,function(t){if(t.success&&t.data)try{window.s3scope=t.data,window.s3scope.attachmentInputs=window.s3scope.attachmentInputs||{},window.s3scope.signatures=window.s3scope.signatures||{},i&&i({success:!0})}catch(t){console.log(t),e.notification.alert("Error when calling loadFormDataFromCache!",null,"",e.i18n("form.btn.ok")),i&&i({success:!1})}else i&&i({success:!1})})},e.sui.clearCache=function(t,i){e.sui.cacheKeyMap||e.sui.initCacheKeyMap(t);var a=e.sui.getErrorInfoKey();e.storage.delete(a,!0),a=e.sui.getTempKey(),e.storage.delete(a,!0),a=e.sui.getLastPosKey(),e.storage.delete(a,!0),a=e.sui.getScrollStateKey(),e.storage.delete(a,!0),a=e.sui.getCachedDataKey(),e.storageDB.delete(a,function(e){}),a=e.sui.getStoreFlagKey(),sessionStorage.removeItem(a)},e.sui.repeatedRecordsAssert=function(){var e=s3scope.data.children;if(e&&s3scope.metadata.children)for(var t=Object.keys(e),i=t.length,a=0;a<i;a++){var n=t[a];if(e[n]&&e[n].data instanceof Array&&s3scope.metadata.children[n])for(var r=e[n].data.length,o=0;o<r-1;o++)for(var s=o+1;s<r;s++){var l=L(e[n].data[o],e[n].data[s]);if(l){var c=s3scope.metadata.children[n].display;return{success:!1,tableName:n,index:a+1,title:c}}}}return{success:!0}},e.sui.submit=function(t,i){return window.s3scope?e.sui.preventSubmit?void(i&&i({message:"字段验证有误"})):void M(t,i,!0):(e.notification.alert("表单正在加载中!",null,"",e.i18n("form.btn.ok")),void(i&&i({message:"表单正在加载中!"})))},e.sui.clearAllErrorTips=function(){var e=document.querySelectorAll(".sui-form-ctrl-error");Array.apply(null,e).forEach(function(e){e.classList.remove("sui-form-ctrl-error")});var t=document.querySelectorAll(".sui-form-ctrl-error-tips");Array.apply(null,t).forEach(function(e){e.remove()})},e.sui.clearErrorTips=function(e){e.parentNode.classList.remove("sui-form-ctrl-error");var t=e.querySelectorAll(".sui-form-ctrl-error-tips");Array.apply(null,t).forEach(function(e){e.remove()})},e.sui.setCtrlErrorTips=function(t,i){if(t){t.classList.add("sui-form-ctrl-error");var a=document.createElement("div");a.classList.add("sui-form-ctrl-error-tips"),a.innerHTML=i;var n=t.querySelector(".sui-form-ctrl-field");if(n){var r=n.querySelectorAll(".sui-form-ctrl-error-tips");Array.apply(null,r).forEach(function(e){e.remove()}),n.insertBefore(a,n.children[0]),e.sui.scrollIntoView(t)}}},e.sui.showFormErrorTips=function(t){var i=e.sui.getErrorInfoKey(),a=e.storage.get(i,!0);if(a)try{a=JSON.parse(a),e.sui.nextTick(function(){F(a),e.storage.delete(i,!0)})}catch(t){console.log(t),e.notification.alert("Form assert Failed!",null,"",e.i18n("form.btn.ok"))}},e.sui.showFormErrorTipsByErrorInfo=function(e){F(e)},e.sui.assertFieldLength=function(t,i){if(!t||!i||!i.fieldLength||"edit"!=e.sui.getFieldAuth(t.auth)&&"add"!=e.sui.getFieldAuth(t.auth))return{success:!0};var a=i.finalInputType,n=e.i18n("form.field.lengthLimit",i.fieldLength),r={success:!0,tips:n};switch(a){case"text":if("DECIMAL"==i.fieldType){var o=t.value.replace(/\./g,"").length,s=o<=Number(i.fieldLength);if(!s)return{success:!1,tips:n};var l=t.value.split(".");if(l.length>2)return{success:!1,tip:e.i18n("form.number.notValid")};if(2==l.length){var c=l[0].length,d=l[1].length,u=Number(i.fieldLength)-Number(i.digitNum);return(s=c<=u)?(s=d<=Number(i.digitNum),{success:s,tips:e.i18n("form.number.maxDecimal",i.digitNum)}):{success:s,tips:e.i18n("form.number.maxDigits",String(u))}}var u=Number(i.fieldLength)-Number(i.digitNum);return s=t.value.length<=u,s?r:{success:s,tips:e.i18n("form.number.maxDigits",String(u))}}var o=e.sui.utf8StrLength(t.value),s=o<=Number(i.fieldLength);return s?r:{success:!1,tips:n};case"textarea":var o=e.sui.utf8StrLength(t.value),s=o<=Number(i.fieldLength);return{success:s,tips:n};case"checkbox":case"radio":case"select":case"date":case"datetime":case"flowdealoption":case"lable":case"label":case"handwrite":case"barcode":case"linenumber":return r;case"relationform":case"relation":var o=e.sui.utf8StrLength(t.value),s=o<=Number(i.fieldLength);return{success:s,tips:n};case"project":return r;case"member":case"multimember":case"account":case"multiaccount":case"department":case"multidepartment":case"post":case"multipost":case"level":case"multilevel":return r;case"attachment":case"image":case"document":case"outwrite":case"externalwrite-ahead":return r;case"exchangetask":if("DATETIME"==i.fieldType)return r;var o=e.sui.utf8StrLength(t.value),s=o<=Number(i.fieldLength);return{success:s,tips:n};case"querytask":case"mapmarked":case"maplocate":case"mapphoto":case"customcontrol":return r}return{success:!0,tips:n}},e.sui.formRequiredAssert=function(){for(var t={success:!0,errorInfo:{}},i=document.querySelectorAll(".sui-form-required"),a=i.length,n=0;n<a;n++){var r=e.sui.getFormCtrl(i[n]),o=r.id.split("|"),s=null,l=null;if(2==o.length&&"master"==o[0]){var c=o[1];s=s3scope.data.master[c],l=s3scope.metadata.fieldInfo[c]}else if(3==o.length){var d=o[0],u=o[1],c=o[2],f=s3scope.data.children[d].data,m=(f||[]).filter(function(e){return e.__id==u});m.length>0&&(s=m[0][c]),l=s3scope.metadata.children[d].fieldInfo[c]}s&&(void 0!=s.value&&null!=s.value&&""!=s.value||(t.success=!1,"DECIMAL"==l.fieldType?t.errorInfo[r.id]=e.i18n("form.number.notValid"):t.errorInfo[r.id]=e.i18n("form.field.require")))}return t},e.sui.formRequiredAndFieldLengthAssert=function(t,i,a){var n={success:!0,errorInfo:{}},r=s3scope.data.master;Object.keys(r).forEach(function(t){if(t.indexOf("field")!=-1){var o=r[t],s=s3scope.metadata.fieldInfo[t];if(o&&s){var l="master|"+s.name;if(i&&o.notNull&&(["attachment","document","image"].indexOf(s.finalInputType)!=-1?o.attData&&o.attData.length||(n.success=!1,n.errorInfo[l]=e.i18n("form.field.require")):"handwrite"==s.finalInputType?o.signature&&o.signature.fieldValue||(n.success=!1,n.errorInfo[l]=e.i18n("form.field.require")):void 0!=o.value&&null!=o.value&&""!=o.value||(n.success=!1,n.errorInfo[l]=e.i18n("form.field.require"))),a){if(!n.errorInfo[l]){var c=e.sui.assertFieldLength(o,s);c.success||(n.success=!1,n.errorInfo[l]=c.tips)}"text"==s.finalInputType&&"urlPage"==s.formatType&&o.value&&!e.sui.urlAssert(o.value)&&(n.success=!1,n.errorInfo[l]=e.i18n("form.field.urlNotValid"))}}}});var o=s3scope.data.children,s=s3scope.metadata.children;return o&&s&&Object.keys(o).forEach(function(t){o[t]&&o[t].data instanceof Array&&s[t]&&s[t].fieldInfo&&o[t].data.forEach(function(r){Object.keys(r).forEach(function(o){if(o.indexOf("field")!=-1){var l=r[o],c=s[t].fieldInfo[o];if(l&&c){var d=t+"|"+r.__id+"|"+c.name;if(i&&l.notNull&&(["attachment","document","image"].indexOf(c.finalInputType)!=-1?l.attData&&l.attData.length||(n.success=!1,n.errorInfo[d]=e.i18n("form.field.require")):"handwrite"==c.finalInputType?l.signature&&l.signature.fieldValue||(n.success=!1,n.errorInfo[d]=e.i18n("form.field.require")):void 0!=l.value&&null!=l.value&&""!=l.value||(n.success=!1,n.errorInfo[d]=e.i18n("form.field.require"))),a){if(!n.errorInfo[d]){var u=e.sui.assertFieldLength(l,c);u.success||(n.success=!1,n.errorInfo[d]=u.tips)}"text"==c.finalInputType&&"urlPage"==c.formatType&&l.value&&!e.sui.urlAssert(l.value)&&(n.success=!1,n.errorInfo[d]=e.i18n("form.field.urlNotValid"))}}}})})}),n},e.sui.urlAssert=function(e){return!!R.test(e)||!!P.test(e)},e.sui.formAssert=function(t,i,a){var n=(new Date).getTime(),r=e.sui.formRequiredAndFieldLengthAssert(t,i,a),o=r.errorInfo,s={type:1,info:o,fromPc:"pc"==t.submitSource},l=document.querySelector(".sui-form-content");if(l)F(s);else{var c=e.sui.getErrorInfoKey();e.storage.save(c,JSON.stringify(s),!0)}return console.log("assert耗时:",(new Date).getTime()-n),r.success},e.sui.loadForm=function(e,t){e=O(e),b(e,n,t)},e.sui.refreshWhenWebViewShow=function(e,t){e=O(e),g(e),t&&t()},e.sui.loadForm_test=function(e,t){e=O(e);var i=document.getElementById(e.containerId).getAttribute("rootpath");i+"/s3js/"+e.templateId+".s3js";b(e,a,t)},e.sui.getSelectedData=function(){return[]},e.sui.initCacheKeyMap=function(t){if(t){var i=t.moduleId+"_"+t.rightId+"_"+t.viewState;e.sui.cacheKeyMap={errorInfoKey:"m3_v5_cmp_form_error_"+i,tempKey:"m3_v5_cmp_form_last_"+i,lastPosKey:"m3_v5_cmp_form_last_pos_"+i,scrollStateKey:"m3_v5_cmp_form_scroll_"+i,cachedDataKey:"m3_v5_cmp_form_"+i,storeFlagKey:"m3_v5_cmp_form_store_flag"+i}}},e.sui.metadata2Map=function(){if(!window.s3scope||!window.s3scope.metadata)return{};var e={};return Object.keys(s3scope.metadata.fieldInfo).forEach(function(t){e[t]=s3scope.metadata.fieldInfo[t]}),Object.keys(s3scope.metadata.children||{}).forEach(function(t){Object.keys(s3scope.metadata.children[t].fieldInfo||{}).forEach(function(i){e[i]=s3scope.metadata.children[t].fieldInfo[i]})}),e},e.sui.getErrorInfo=function(){var t=e.sui.getErrorInfoKey(),i=e.storage.get(t,!0);if(i){try{i=JSON.parse(i)}catch(e){return""}var a=[];return"1"==i.type?Object.keys(i.info).forEach(function(e){if(i.fromPc)a.push("["+e+"]"+i.info[e]);else{var t=N(e);t.fieldInfo&&a.push("["+t.fieldInfo.display+"]"+i.info[e])}}):Object.keys(i.info).forEach(function(e){var t=i.info[e];a.indexOf(t)==-1&&a.push(t)}),e.storage.delete(t,!0),a.join("<br/>")}return""},e.sui.getErrorInfoKey=function(){return e.sui.cacheKeyMap?e.sui.cacheKeyMap.errorInfoKey:""},e.sui.getTempKey=function(){return e.sui.cacheKeyMap?e.sui.cacheKeyMap.tempKey:""},e.sui.getLastPosKey=function(){return e.sui.cacheKeyMap?e.sui.cacheKeyMap.lastPosKey:""},e.sui.getScrollStateKey=function(){return e.sui.cacheKeyMap?e.sui.cacheKeyMap.scrollStateKey:""},e.sui.getStoreFlagKey=function(){return e.sui.cacheKeyMap?e.sui.cacheKeyMap.storeFlagKey:""},e.sui.getCachedDataKey=function(){return e.sui.cacheKeyMap?e.sui.cacheKeyMap.cachedDataKey:""},e.sui.utf8StrLength=function(e){for(var t=e.length,i=0,a=0;a<t;a++){var n=e.charCodeAt(a);i+=n<=127?1:n<=2047?2:n<=65535?3:4}return i},e.sui.utf8SubStr=function(e,t){for(var i=e.length,a="",n=0,r=0;r<i;r++){var o=e.charCodeAt(r);if(n+=o<=127?1:o<=2047?2:o<=65535?3:4,n>t)return a;a+=e[r]}return a},e.sui.hasEditRightOfFlowDealOption=function(){if(window.s3scope&&window.s3scope.metadata&&window.s3scope.data){if(window.s3scope.metadata.fieldInfo)for(var e=Object.keys(window.s3scope.metadata.fieldInfo),t=e.length,i=0;i<t;i++){var a=e[i],n=window.s3scope.metadata.fieldInfo[a];if("flowdealoption"==n.finalInputType){var r=(window.s3scope.data.master[n.name]||{}).auth;if("edit"==r||"add"==r)return!0}}if(window.s3scope.metadata.children)for(var o=Object.keys(window.s3scope.metadata.children),t=o.length,i=0;i<t;i++)for(var s=o[i],e=Object.keys(window.s3scope.metadata.children[s].fieldInfo),l=e.length,c=0;c<l;c++){var a=e[c],n=window.s3scope.metadata.children[s].fieldInfo[a];if("flowdealoption"==n.finalInputType){var d=window.s3scope.data.children[s].data,u=!1;if(d.forEach(function(e){"edit"!=e.auth&&"add"!=e.auth||(u=!0)}),u)return!0}}}return!1};var W=!1,z=0;e.sui.refreshIScrollAsync=function(){W||(W=!0,e.sui.nextTick(function(){e.sui.refreshIScrollWhenResize(),W=!1}))},e.sui.refreshIScrollWhenResize=function(){var t=document.querySelector(".sui-form-content");if(t){var i=t.offsetHeight;i!=z&&(e.sui.refreshIScroll(),z=i)}},e.sui.htmlBuilder=function(t){if(!t||!t.model||!t.fieldInfo)return"";var i;t.model.notNull&&(i=!0);var a="sui-form-ctrl-inner "+t.fieldInfo.inputType+" "+t.fieldInfo.finalInputType;H(t.model,t.fieldInfo)&&(a+=" sui-form-ctrl-empty");var n="<div "+e.sui.attrBuilder({class:a+(i?" sui-form-ctrl-required":"")})+">";n+="<label "+e.sui.attrBuilder({class:"sui-form-ctrl-title"})+">",i&&(n+="<span "+e.sui.attrBuilder({class:"sui-form-required"})+">*</span>"),n+=t.fieldInfo.display.escapeHTML(),n+="</label>";var r="sui-auth-"+e.sui.getFieldAuth(t.model.auth||"edit");n+="<div"+e.sui.attrBuilder({class:"sui-form-ctrl-field "+r})+">",n+=t.fieldInfo.relation&&["2","3"].indexOf(t.fieldInfo.relation.toRelationFormType)!=-1&&t.model.through?"<div"+e.sui.attrBuilder({class:"sui-form-ctrl-field-main un-flow-relationform-through"})+">":"<div"+e.sui.attrBuilder({class:"sui-form-ctrl-field-main"})+">";var o={class:"sui-form-ctrl-value",id:t.fieldInfo.name,fieldname:t.fieldInfo.fieldName,inputtype:t.fieldInfo.inputType};i&&(o.required="true"),o.validate="true",o.placeholder=(t.fieldInfo.desc||"").escapeHTML(),"DECIMAL"==t.fieldInfo.fieldType?(o.type="number",o.name="number"):(o.type="text",o.name="text"),"edit"!=e.sui.getFieldAuth(t.model.auth)&&(o.readonly="true",o.disabled="disabled");var s="relation"==t.fieldInfo.inputType?t.fieldInfo.finalInputType:t.fieldInfo.inputType;return n+=k(o,t,s,e.sui.getFieldAuth(t.model.auth)),n+="</div>",n+="</div>",n+="</div>",e.sui.refreshIScrollAsync(),n},e.sui.attrBuilder=function(e){var t="";for(var i in e)t+=" "+i+'="'+(e[i]||"")+'"';return t},e.sui.clone=function(t,i){var a;a=t.constructor==Object?new t.constructor:new t.constructor(t.valueOf());for(var n in t)a[n]!=t[n]&&("object"==typeof t[n]?a[n]=e.sui.clone(t[n],i):(a[n]=t[n],i&&("value"!=n&&"display"!=n||(a[n]=""))));return a.toString=t.toString,a.valueOf=t.valueOf,a},e.sui.getBindId=function(e){return""},e.sui.addRecordInSubTable=function(t,i,a,n){SuiEvent.trigger({target:document,eventName:"sui_form_beforeAddRecord",data:{tableName:i,record:a}},function(r,o){if(r)return cmp.dialog.loading(!1),void e.notification.alert(r.message,null,"",e.i18n("form.btn.ok"));var s={};for(var l in a)0==l.indexOf("field")&&(s[l]=a[l].value);var c={formMasterId:s3scope.formMasterId,formId:s3scope.formId,rightId:s3scope.rightId,tableName:i,type:t,recordId:a.__id,data:s};e.sui.dataService.capForm.addOrDelDataSubBean(c,function(t,r){return t?(cmp.dialog.loading(!1),void e.notification.alert(t.message||t.msg||"Error when calling addOrDelDataSubBean!",null,"",e.i18n("form.btn.ok"))):void e.sui.refreshFormData(a,r,function(e,t){SuiEvent.trigger({target:document,eventName:"sui_form_afterAddRecord",data:{tableName:i,record:a}},function(e,t){}),n&&n(e,t)})})})},e.sui.delRecordInSubTable=function(t,i,a,n){SuiEvent.trigger({target:document,eventName:"sui_form_beforeDelRecord",data:{tableName:i,record:a}},function(r,o){var s={formMasterId:s3scope.formMasterId,formId:s3scope.formId,rightId:s3scope.rightId,tableName:i,type:t,recordId:a.__id};e.sui.dataService.capForm.addOrDelDataSubBean(s,function(t,r){return t?(cmp.dialog.loading(!1),void e.notification.alert(t.message||t.msg||"Error when calling addOrDelDataSubBean!",null,"",e.i18n("form.btn.ok"))):void e.sui.refreshFormData(a,r,function(e,t){SuiEvent.trigger({target:document,eventName:"sui_form_afterDelRecord",data:{tableName:i,record:a}},function(e,t){}),n&&n(e,t)})})})},e.sui.onDeleteAllSubTableRecords=function(t,i){if(s3scope.data.children[t].data&&s3scope.data.children[t].data.length>1){var a=e.i18n("form.childrenTable.deleteAllConfirm");e.notification.confirm(a,function(a){if(1==a){cmp.dialog.loading();var n=s3scope.data.children[t].data[0];e.sui.delAllRecordInSubTable(t,n,function(e,t){cmp.dialog.loading(!1),i&&i(e,t)})}},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else e.notification.alert(e.i18n("form.childrenTable.deleteLastNotice"),null,"",e.i18n("form.btn.ok"))},e.sui.delAllRecordInSubTable=function(t,i,a){var n={};for(var r in i)0==r.indexOf("field")&&(n[r]=i[r].value);var o={formMasterId:s3scope.formMasterId,formId:s3scope.formId,rightId:s3scope.rightId,moduleId:s3scope.moduleId,tableName:t,remainId:i.__id,data:n};e.sui.dataService.capForm.delAllRepeat(o,function(i,n){return i?void e.notification.alert("Error when calling delAllRepeat!",null,"",e.i18n("form.btn.ok")):(s3scope.data.children[t].data.splice(0),s3scope.unShowSubDataIdMap&&s3scope.unShowSubDataIdMap[t]instanceof Array&&s3scope.unShowSubDataIdMap[t].splice(0),void e.sui.refreshFormData(null,n.results?n.results:n,function(){a&&a(i,n)}))})},e.sui.setFieldData=function(e){if(window.s3scope){var t=null;if(e.isMaster&&window.s3scope.data&&window.s3scope.data.master)t=window.s3scope.data.master[e.fieldName],t&&(t.value="undefined"!=typeof e.value?e.value:t.value,t.display="undefined"!=typeof e.display?e.display:t.display);else if(!e.isMaster&&window.s3scope.data&&window.s3scope.data.children){var i=window.s3scope.data.children[e.tableName].data;if(i instanceof Array){var a=i.filter(function(t){return t.__id==e.recordId});a.length>0&&(t=a[0][e.fieldName])&&t&&(t.value="undefined"!=typeof e.value?e.value:t.value,t.display="undefined"!=typeof e.display?e.display:t.display)}}}},e.sui.getFieldData=function(e){if(!window.s3scope)return null;var t=null;if(e.isMaster&&window.s3scope.data&&window.s3scope.data.master){if(t=window.s3scope.data.master[e.fieldName])return t}else if(!e.isMaster&&window.s3scope.data&&window.s3scope.data.children){var i=window.s3scope.data.children[e.tableName].data;if(i instanceof Array){var a=i.filter(function(t){return t.__id==e.recordId});if(a.length>0&&(t=a[0][e.fieldName])&&t)return JSON.parse(JSON.stringify(t))}}},e.sui.getFormData=function(){if(window.s3scope&&"object"==typeof window.s3scope.data)return JSON.parse(JSON.stringify(window.s3scope.data))},e.sui.getFormMetaData=function(){if(window.s3scope&&"object"==typeof window.s3scope.metadata)return JSON.parse(JSON.stringify(window.s3scope.metadata))},e.sui.refreshFormData=function(t,a,n){if(!a||!a.data)return n&&n(null,{}),void SuiEvent.trigger({target:document,eventName:"sui_form_afterCalculate",data:{}},function(e,t){});var r={},o=a.data;B(o),Vue.nextTick(function(){if(o.master&&Object.keys(o.master).forEach(function(e){o.master[e]instanceof Object&&void 0!==o.master[e].value&&s3scope.data.master[e]&&(o.master[e].attData?Object.keys(o.master[e]).forEach(function(t){"attData"==t?(s3scope.data.master[e].attData.splice(0),(o.master[e].attData||[]).forEach(function(t){t.reference=s3scope.moduleId,s3scope.data.master[e].attData.push(t)})):s3scope.data.master[e][t]=o.master[e][t]}):Object.keys(o.master[e]).forEach(function(t){s3scope.data.master[e][t]=o.master[e][t]}))}),o.children){for(var a in o.children){s3scope.data.children[a]&&(void 0!=o.children[a].allowAdd&&(s3scope.data.children[a].allowAdd=o.children[a].allowAdd||!1),void 0!=o.children[a].allowDelete&&(s3scope.data.children[a].allowDelete=o.children[a].allowDelete||!1));var s=o.children[a].data;if(s&&s3scope.data.children[a])for(var l=s.length,c=s3scope.data.children[a].data||[],d=i(c),u=0,f=0;f<l;f++){var m=s[f];if(d.hasOwnProperty(m.__id))Object.keys(m).forEach(function(e){m[e]instanceof Object&&void 0!==m[e].value&&d[m.__id][e]&&(m[e].attData?Object.keys(m[e]).forEach(function(t){"attData"==t?(d[m.__id][e].attData.splice(0),(m[e].attData||[]).forEach(function(t){t.reference=s3scope.moduleId,d[m.__id][e].attData.push(t)})):d[m.__id][e][t]=m[e][t]}):Object.keys(m[e]).forEach(function(t){d[m.__id][e][t]=m[e][t]}))});else if(t){u++;var p=c.indexOf(t)+u;c.splice(p,0,m),r=m}else{var p=c.length;c.splice(p,0,m),r=m}}}e.sui.trigger("onupdatetoolbar")}n&&n(null,r),SuiEvent.trigger({target:document,eventName:"sui_form_afterCalculate",data:o},function(e,t){})})},e.sui.onImgLoadHandler=function(t){var i=t.target;if("IMG"==i.tagName){var a=i.parentNode.getBoundingClientRect(),n=a.width||110,r=a.height||110;console.log(n),console.log(r),"lightForm"==s3scope.metadata.templateType?i.width>n&&i.height>r?i.width>i.height?i.style.height="100%":i.style.width="100%":(i.style.maxWidth="100%",i.style.maxHeight="100%"):(i.width<30||0==i.height?(i.parentNode.parentNode.setAttribute("style","padding-right:0px !important;"),i.parentNode.parentNode.childNodes.length>1&&(i.parentNode.parentNode.childNodes[1].style.position="static",i.parentNode.parentNode.childNodes[1].style.transform="none"),i.style.width="100%",i.parentNode.childNodes.length>1&&(i.parentNode.childNodes[1].style.position="static",i.parentNode.childNodes[1].style.transform="none")):i.width<n&&i.height<r&&(i.width/i.height>n/r?i.style.width="100%":i.style.height="100%"),e.sui.refreshIScrollAsync())}},e.sui.maplocate_clickHandler=function(t,i,a,n,r){if(!e.platform.CMPShell)return e.notification.alert(e.i18n("form.weixin.canNotMaplocate"),null,"",e.i18n("form.btn.ok")),void(r&&r());if("edit"!=e.sui.getFieldAuth(a.auth)||"relationform"==n.inputType){if(a.value){var o={lbsUrl:e.serverIp+"/seeyon/rest/cmplbs/"+a.value,userName:"",memberIconUrl:""};e.lbs.showLocationInfo(o)}return void(r&&r())}if(t.target.classList.contains("see-icon-v5-form-close-circle-fill")){a.__state="modified",a.display="",a.editAttr=!0,i.set(""),i.update("");var s=e.sui.getRecordIdByVueElement(i.el,n),l={formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:n.name,recordId:s,lbsId:a.value,data:s3scope.data,attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};e.sui.dataService.capForm.dealLbsFieldRelation(l,function(t,i){return t?void e.notification.alert(t.message||"Error when calling dealLbsFieldRelation!",null,"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i)})}else if(t.target.classList.contains("see-icon-v5-form-location-fill"))e.lbs.getLocationInfo({success:function(t){"string"==typeof t&&(t=JSON.parse(t)),t&&e.sui.dataService.cmplbs.save(t,function(o,s){a.display=t.lbsAddr,a.__state="modified",a.editAttr=!0,i.set(s.value),i.update(a.value);var l=e.sui.getRecordIdByVueElement(i.el,n),c={formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:n.name,recordId:l,lbsId:s.value,data:e.sui.reduceSubmitData(s3scope.data),
attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};e.sui.dataService.capForm.dealLbsFieldRelation(c,function(t,i){return t?(e.notification.alert(t.message||"Error when calling dealLbsFieldRelation!",null,"",e.i18n("form.btn.ok")),void(r&&r())):void e.sui.refreshFormData(null,i.results?i.results:i)})})},error:function(t){e.notification.alert(t.message||"Error when calling cmp.lbs.getLocationInfo!",null,"",e.i18n("form.btn.ok")),r&&r()}});else if(t.target.classList.contains("sui-form-ctrl-maplocate")&&a.value){var o={lbsUrl:e.serverIp+"/seeyon/rest/cmplbs/"+a.value,userName:"",memberIconUrl:""};e.lbs.showLocationInfo(o)}r&&r()},e.sui.mapmarked_clickHandler=function(t,i,a,n){if(!e.platform.CMPShell)return void e.notification.alert(e.i18n("form.weixin.canNotMapmarked"),null,"",e.i18n("form.btn.ok"));if("edit"==e.sui.getFieldAuth(a.auth)&&"relationform"!=n.inputType){e.lbs.markLocation({success:function(t){"string"==typeof t&&(t=JSON.parse(t)),t&&e.sui.dataService.cmplbs.save(t,function(r,o){a.display=t.lbsAddr,a.__state="modified",a.editAttr=!0,i.set(o.value),i.update(a.value);var s=e.sui.getRecordIdByVueElement(i.el,n),l={formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:n.name,recordId:s,lbsId:o.value,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};e.sui.dataService.capForm.dealLbsFieldRelation(l,function(t,i){return t?void e.notification.alert(t.message||"Error when calling dealLbsFieldRelation!",null,"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i)})})}})}else if(a.value){var r={lbsUrl:e.serverIp+"/seeyon/rest/cmplbs/"+a.value,userName:"",memberIconUrl:""};e.lbs.showLocationInfo(r)}},e.sui.mapphoto_clickHandler=function(t,i,a,n){if("edit"==e.sui.getFieldAuth(a.auth))if("IMG"==t.target.tagName)console.log(t.target);else if(t.target.classList.contains("see-icon-v5-form-close-circle")||t.target.classList.contains("see-icon-v5-form-close-circle-fill")){var r=e.i18n("form.photo.deleteConfirm");e.notification.confirm(r,function(t){if(1==t){a.attData.splice(0),a.__state="modified",a.editAttr=!0,i.set(""),i.update(a.value);var r=e.sui.getRecordIdByVueElement(i.el,n),o={formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:n.name,recordId:r,lbsId:a.value,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};e.sui.dataService.capForm.dealLbsFieldRelation(o,function(t,i){return t?void e.notification.alert(t.message||"Error when calling dealLbsFieldRelation!",null,"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i)})}},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else if(t.target.parent(".image-add-item")){if(!e.platform.CMPShell)return void e.notification.alert(e.i18n("form.weixin.canNotMapphoto"),null,"",e.i18n("form.btn.ok"));var o=e.sui.dataService.debug?e.sui.dataService.targetServer:e.serverIp,s=o+"/seeyon/rest/attachment?option.n_a_s=1",l=o+"/seeyon/rest/cmplbs/servertime";if(a.attData.length>0){var r=e.i18n("form.photo.updateConfirm");e.notification.confirm(r,function(e){1==e&&j(i,a,n,o,s,l)},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else j(i,a,n,o,s,l)}},e.sui.getSelectedRecordIds=function(){var e={};return Object.keys(s3scope.data.children||{}).forEach(function(t){e[t]=[];var i=s3scope.data.children[t].data;(i||[]).forEach(function(i){i.selected&&e[t].push(i.__id)})}),e},e.sui.getFormCtrl=function(e){return e.closest(".sui-form-ctrl")},e.sui.getFormCtrlIdByVueElement=function(t){var i="",a=e.sui.getFormCtrl(t);return a&&(i=a.id),i},e.sui.getRecordIdByVueElement=function(e,t){var i=0;if(!t.masterField){var a=e.parent("[recordid]");a&&(i=a.getAttribute("recordid"))}return i},e.sui.getRecordIdByDom=function(e){var t=0,i=e.closest("[recordid]");return i&&(t=i.getAttribute("recordid")),t},e.sui.getRecordIndexByVueElement=function(e,t){var i=0;if(!t.masterField){var a=e.parent("[recordindex]");a&&(i=a.getAttribute("recordindex"))}return i},e.sui.getFieldAuth=function(e){return s3scope.allowCheck?"hide"==e?e:"browse":e},e.sui.trigger=function(e,t){t=t||document;var i=t.createEvent("HTMLEvents");i.initEvent(e,!0,!0),i.eventType="form_event",t.dispatchEvent(i)},e.sui.attachmentDataConverter=function(e,t,i,a){return(t||[]).forEach(function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}var n={};if(t.fileUrl)Object.keys(t).forEach(function(e){n[e]=t[e]});else if(n.category="1",n.extraMap={},n.genesisId=null,n.new=a,n.officeTransformEnable="disable",n.reference=s3scope.moduleId,n.sort="0",n.subReference=i,n.type="2",n.v="0","docFile"==t.type){var r=new Date(t.fr_create_time);r=isNaN(r)?new Date:r,n.createdate=r.format("yyyy-MM-dd hh:mm"),n.fileUrl=t.fr_id,n.description=t.fr_id,n.filename=t.fr_name,n.icon="km.gif",n.id=t.id,n.mimeType="km",n.size=t.fr_size.toString()}else if("collaboration"==t.type){var r=new Date(t.createDate);r=isNaN(r)?new Date:r,n.createdate=r.format("yyyy-MM-dd hh:mm"),n.fileUrl=t.affairId,n.description=t.affairId,n.filename=t.subject,n.icon="collaboration.gif",n.id=t.id,n.mimeType="collaboration",n.size="0"}else{var r=new Date(t.createDate);r=isNaN(r)?new Date:r,n.createdate=r.format("yyyy-MM-dd hh:mm"),n.fileUrl=t.affairId,n.description=t.affairId,n.filename=t.summary.subject,n.icon="edoc.gif",n.id=t.affairId,n.mimeType="edoc",n.size="0"}e.push(n)}),e},e.sui.doCalculate=function(t,i){if(i.inCalc||i.inCondition){var a=e.sui.getRecordIdByVueElement(t,i),n={formMasterId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:i.name,recordId:a,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};e.sui.preventSubmit=!0,e.sui.onCalcing=!0,e.sui.dataService.capForm.calculate(n,function(t,i){return t?void e.notification.alert(t.message||"Error when calling calculate!",function(){e.sui.preventSubmit=!1,e.sui.onCalcing=!1},"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i,function(){e.sui.preventSubmit=!1,e.sui.onCalcing=!1})})}},e.sui.doDecodeBarCode=function(t){"object"==typeof t.text&&(t.text=JSON.stringify(t.text));try{var i=JSON.parse(t.text);if(i&&i.content){var a="",n="",r="0";if(e.sui.lastPosCtrlId){var o=N(e.sui.lastPosCtrlId);a=o.fieldInfo.name,n=o.fieldInfo.ownerTableName;var s=(e.sui.lastPosCtrlId||"").split("|");3===s.length&&(r=s[1])}var l={formId:s3scope.formId,currentField:a,dataId:s3scope.formMasterId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,tableName:n,recordId:r,content:t.text,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};cmp.dialog.loading(),e.sui.dataService.capForm.decodeBarCode(l,function(t,i){return t?(cmp.dialog.loading(!1),void e.notification.alert(t.message||"Error when calling decodeBarCode!",null,"",e.i18n("form.btn.ok"))):void e.sui.refreshFormData(null,i.results?i.results:i,function(){cmp.dialog.loading(!1),i.tips&&e.notification.alert(i.tips,null,"",e.i18n("form.btn.ok"))})})}else if(e.sui.lastPosCtrlId){var o=N(e.sui.lastPosCtrlId);o.model&&o.fieldInfo&&("edit"!=o.model.auth&&"add"!=o.model.auth||"text"!=o.fieldInfo.finalInputType&&"textarea"!=o.fieldInfo.finalInputType||(o.model.display=o.model.display+t.text,o.model.value=o.model.value+t.text))}return}catch(e){}if(e.sui.lastPosCtrlId){var o=N(e.sui.lastPosCtrlId);o.model&&o.fieldInfo&&("edit"!=o.model.auth&&"add"!=o.model.auth||"text"!=o.fieldInfo.finalInputType&&"textarea"!=o.fieldInfo.finalInputType||(o.model.display=o.model.display+t.text,o.model.value=o.model.value+t.text))}},e.sui.doUpdateRelationFormInfo=function(t,i,a,n){Vue.nextTick(function(){var r=document.getElementById(t),o=e.sui.getRecordIdByVueElement(r,i.fieldInfo),s={formMasterDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:a,text:n,recordId:o};e.sui.dataService.capForm.showFormRelationRecord(s,function(e,t){console.log(t),t.errorMsg&&"I"!=r.tagName&&(r.innerHTML=r.innerHTML+'<span style="color:#8f8f8f">['+t.errorMsg+"]</span>"),r.setAttribute("see-att-data",JSON.stringify(t))})})},e.sui.resize=function(t){if(t){var i=t.getBoundingClientRect(),a=i.height,n=window.getComputedStyle(t,null),r=parseInt(n.paddingTop)+parseInt(n.paddingBottom),o=2*parseInt(n.borderWidth),s=parseInt(n.lineHeight),l=e.sui.getFormCtrl(t),c=(l&&l.getAttribute("maxrows")||4,s+r+o);t.style.overflowY="hidden",t.style.height=c+"px";var d=t.scrollHeight+o;t.style.height=d+"px",t.scrollHeight>d&&(t.style.overflowY="auto"),d!=a&&"infopath"==s3scope.templateType&&e.sui.refreshIScrollAsync()}},window.onbeforeunload=function(){},e.sui.unbind=function(e){e.el.remove(),e.el=null},document.addEventListener("tap",function(t){console.log("in document tap");var i=e.sui.getFormCtrl(t.target);if(i){var a=i.id;a&&(e.sui.lastPosInput&&e.sui.lastPosInput!=t.target,e.sui.lastPosCtrlId=a,e.sui.lastPosInput=t.target),K=!1}else K=!0;window.s3scope&&"infopath"==window.s3scope.templateType&&t.target.classList.contains("sui-form-ctrl-error-tips")&&(cmp.notification.toast(t.target.innerText,"center"),t.stopPropagation())},!0),cmp.event.listenClosePage(function(){cmp.storageDB.deleteAll()})}(cmp,document),function(e,t,i){"use strict";t.directive("sui-qrscan",{params:["scope"],twoWay:!0,bind:function(){},update:function(t,i){if(this.unbind(),s3scope.allowQRScan){var a=document.createElement("div");a.classList.add("sui-form-drag"),a.setAttribute("draggable","true"),a.innerHTML='<i class="see-icon-v5-form-qrscan"></i>',document.body.appendChild(a);var n=window.screen.availHeight,r=window.screen.availWidth,o=!1,s=!1,l={x:0,y:0};this.clickHandler=function(t){o=!1,s=!1;var i=a;if(i&&i.classList.remove("sui-form-drag-active"),!e.platform.CMPShell)return void e.notification.alert(e.i18n("form.qr.alert"),null,"",e.i18n("form.btn.ok"));var n={success:function(t){t&&"Cancel"!=t.cancelled&&e.sui.doDecodeBarCode(t)},error:function(t){t&&t.message&&"18006"!=t.code&&("string"==typeof t.message&&(t.message=JSON.parse(t.message)),t.message.cancelled||e.notification.alert(JSON.stringify(t.message),null,"",e.i18n("form.btn.ok")))}};e.barcode.scan(n)}.bind(this),this.touchendHandler=function(e){o=!1,s=!1;var t=a;t&&t.classList.remove("sui-form-drag-active")}.bind(this),this.dragHandler=function(e){var t=a;if(!s&&t&&(s=!0,t.classList.add("sui-form-drag-active")),o){var i=60,c=t.getBoundingClientRect(),d=l.x+(e.detail.move.x-e.detail.start.x),u=l.y+(e.detail.move.y-e.detail.start.y),f=r-parseInt(c.width),m=n-parseInt(c.height)-i;d=d<0?0:d>f?f:d,u=u<i?i:u>m?m:u,t.style.top=u+"px",t.style.left=d+"px"}e.stopPropagation(),e.preventDefault()}.bind(this),this.touchstartHandler=function(e){o=!0;var t=a,i=t.getBoundingClientRect();l={x:parseInt(i.left),y:parseInt(i.top)}}.bind(this),this.touchmoveHandler=function(e){e.preventDefault()}.bind(this),a.addEventListener("tap",this.clickHandler),a.addEventListener("touchend",this.touchendHandler),a.addEventListener("drag",this.dragHandler),a.addEventListener("touchmove",this.touchmoveHandler),a.addEventListener("touchstart",this.touchstartHandler)}},unbind:function(){var e=document.querySelectorAll(".sui-form-drag");if(e&&e.length>0)for(var t=e.length,i=0;i<t;i++){var a=e[i];a.removeEventListener("tap",this.clickHandler),a.removeEventListener("touchend",this.touchendHandler),a.removeEventListener("drag",this.dragHandler),a.removeEventListener("touchmove",this.touchmoveHandler),a.removeEventListener("touchstart",this.touchstartHandler),a.remove(),a=null}}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-barcode",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;t.attData=t.attData||[],t.attData.length>0&&(t.__state="modified"),this.vm.$nextTick(function(){var i=e.sui.getFormCtrlIdByVueElement(a.el);s3scope.attachmentInputs[i]=t.attData});var n=!1,r=null;this.clickHandler=function(o){if(n)return r&&clearTimeout(r),void(r=setTimeout(function(){n=!1},5e3));if("edit"!=e.sui.getFieldAuth(t.auth))return void(n=!1);if(o.target.suiMatchesSelector(".see-icon-v5-form-qrcode")){n=!0;var s=e.sui.getRecordIdByVueElement(a.el,i),l={dataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:i.name,recordId:s,data:e.sui.reduceSubmitData(s3scope.data)};e.sui.dataService.capForm.generateBarCode(l,function(i,r){if(i||!r.attr){var o=r&&r.msg?r.msg:"";return void e.notification.alert(o||"Error when calling generateBarCode!",function(){n=!1},"",e.i18n("form.btn.ok"))}t.attData.splice(0),t.attData.push(r.attr),a.set(r.attr.subReference),a.update(t.value),n=!1})}else if(o.target.suiMatchesSelector(".see-icon-v5-form-close-circle-fill")){n=!0;var c=e.i18n("form.qr.deleteConfirm");e.notification.confirm(c,function(e){1==e&&(t.attData.splice(0),a.set(""),a.update("")),n=!1},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else n=!1}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;a.attData=a.attData||[],this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n})},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-checkbox",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;this.changeHandler=function(n){var r=t.value,o=this.el.querySelector("input"),s=o.checked.toString();if(r!=s){o.value=s;var l="true"==s?"1":"0";this.set(l),t.__state="modified",e.sui.clearErrorTips(this.el),e.sui.doCalculate(a.el,i)}}.bind(this),this.el.addEventListener("change",this.changeHandler)}},update:function(t){var i=this.params.scope.model,a=this.params.scope.fieldInfo,n=this,r=this.el.getAttribute("desc");this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:r,model:i,fieldInfo:a}),n.el.querySelector("input").checked="true"==t.toString()||"1"==t},unbind:function(){this.el.removeEventListener("change",this.changeHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-date",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=(new Date).getFullYear(),n={type:"date"==i.finalInputType?"date":"datetime",beginYear:1900,endYear:a+50},r=this,o=this.params.scope.options,s=(t.items||[],e.extend(n,o)),l=null;this.clickHandler=function(a){if("edit"==e.sui.getFieldAuth(t.auth)){var n=a.target.getAttribute("action");if("clear-value"==n)return r.set(""),t.display="",t.__state="modified",this.update(""),e.sui.doCalculate(r.el,i),void a.stopPropagation();s.value=t.value,l=new e.DtPicker(s),console.log(l),l.show(function(a){var n=a.value||"";console.log(n);var o=t.value;o!=n&&(r.set(n),t.__state="modified",r.update(n),e.sui.doCalculate(r.el,i)),l.dispose(),l=null},function(){l.dispose(),l=null})}}.bind(this),this.el.addEventListener("tap",this.clickHandler);this.el.querySelector(".see-icon-v5-form-close-circle-fill")}},update:function(t){var i=this.params.scope.model,a=this.params.scope.fieldInfo,n=this.el.getAttribute("desc");this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:n,model:i,fieldInfo:a}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-handwrite",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;t.signature=t.signature||{};var n=i.name+"_"+s3scope.formMasterId,r=(t.signature||{}).fieldValue||"";this.clickHandler=function(o){if(e.platform.CMPShell){if("edit"!=e.sui.getFieldAuth(t.auth))return void o.stopPropagation();var s="500",l="400";if("infopath"==s3scope.metadata.templateType){var c=a.el.querySelector(".sui-form-ctrl-value-display");if(c){var d=window.getComputedStyle(c);s=parseInt(d.width),l=parseInt(d.height)}}var u={height:l,width:s,fieldValue:r,fieldName:n,summaryID:s3scope.formMasterId,signatureListUrl:e.serverIp+"/seeyon/rest/signet/signets/"+s3scope.affaireId,signaturePicUrl:e.serverIp+"/seeyon/rest/signet/signetPic",affairId:s3scope.affaireId,success:function(e){if(e instanceof Array&&e.length>0){t.display=n,a.set(n),t.__state="modified",t.signature=e[0],a.update(n);var r={isNewImg:!1,affairId:s3scope.moduleId,qianpiData:JSON.stringify(e)};s3scope.signatures[i.name]=r}},error:function(e){}};e.handWriteSignature.show(u),o.stopPropagation()}}.bind(this),this.el.addEventListener("tap",this.clickHandler),this.onLoadHandler=function(e){e.target.style.maxWidth="100%"}.bind(this),this.el.addEventListener("load",this.onLoadHandler,!0)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo,r=(n.name+"_"+s3scope.formMasterId,this);if(this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.platform.CMPShell)a.signature&&!a.signature.picData&&cmp.handWriteSignature&&cmp.handWriteSignature.initSignatureData({value:[a.signature],success:function(e){if(console.log(e),e instanceof Array&&e.length>0){var t=r.el.querySelector("img");t&&e[0].picData&&(a.signature.picData=e[0].picData,t.src="data:image/png;base64,"+e[0].picData)}},error:function(e){}});else{var o=r.el.querySelector(".sui-form-ctrl-value-display");o&&(o.innerHTML=e.i18n("form.weixin.canNotHandwrite")||"微协同环境不支持签章")}},unbind:function(){this.el.removeEventListener("tap",this.clickHandler),this.el.removeEventListener("load",this.onLoadHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-input",{params:["scope"],twoWay:!0,bind:function(){function t(t){if((a.inCalc||a.inCondition)&&"modified"==i.__state){var o=e.sui.assertFieldLength(i,a);if(!o.success){e.sui.preventSubmit=!0;var s={type:1,info:{}};if(s.info[r]=o.tips,e.sui.showFormErrorTipsByErrorInfo(s),e.sui.nextTick(function(){e.sui.preventSubmit=!1}),"DECIMAL"==a.fieldType)n.set("");else{var l=e.sui.utf8SubStr(t.value,Number(a.fieldLength));n.set(l)}n.update()}var c=e.sui.getRecordIdByVueElement(n.el,a);({formMasterId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:a.name,recordId:c,data:s3scope.data});e.sui.doCalculate(n.el,a)}i.notNull&&(i.value?n.el.children[0].classList.remove("sui-form-ctrl-empty"):n.el.children[0].classList.add("sui-form-ctrl-empty"))}var i=this.params.scope.model,a=this.params.scope.fieldInfo,n=(this.params.scope.isMaster,this),r="";this.vm.$nextTick(function(){r=e.sui.getFormCtrlIdByVueElement(n.el)});var o=/^(https|http|ftp|rtsp|mms)?:\/\/([0-9A-Za-z_-]+\.?)+(\/[0-9A-Za-z_-]+)*(\.[0-9a-zA-Z-_]*)?(:?[0-9]{1,4})?(\/[\u4E00-\u9FA50-9A-Za-z_-]+\.?[\u4E00-\u9FA50-9A-Za-z_-]+)*(\?([\u4E00-\u9FA50-9a-zA-Z-_]+=[\u4E00-\u9FA50-9a-zA-Z-_%]*(&|&amp;)?)*)?\/?$/;this.keydownHandler=function(e){e.ctrlKey||8==e.keyCode||46==e.keyWord||e.target.setAttribute("notnull","true")}.bind(this),this.changeHandler=function(t){var a=t.target,r=i.value,o=n.el.querySelector(".sui-form-ctrl-value"),s=(o||{}).value;s&&t.target.setAttribute("notnull","false"),r!=s&&(n.set(s),i.__state="modified","TEXTAREA"==a.tagName&&e.sui.resize(a),e.sui.clearErrorTips(n.el),e.sui.preventSubmit=!1)}.bind(this),this.focusoutHandler=function(s){console.log("state:",i.__state),console.log("in focusoutHandler");var l=n.el.querySelector(".sui-form-ctrl-value");if("DECIMAL"==a.fieldType&&!l.value&&(l.value="",n.set(""),"true"==l.getAttribute("notnull"))){e.sui.preventSubmit=!0;var c={type:1,info:{}};c.info[r]=e.i18n("form.number.notValid"),e.sui.showFormErrorTipsByErrorInfo(c),e.sui.nextTick(function(){e.sui.preventSubmit=!1})}if("urlPage"==a.formatType&&l.value&&!o.test(l.value)){e.sui.preventSubmit=!0;var c={type:1,info:{}};c.info[r]=e.i18n("form.field.urlNotValid"),e.sui.showFormErrorTipsByErrorInfo(c),e.sui.nextTick(function(){e.sui.preventSubmit=!1}),l.value="",n.set("")}t(l),"infopath"==s3scope.metadata.templateType&&setTimeout(function(){var e=document.querySelector(".sui-form-wrapper");e&&(e.scrollLeft=0,e.scrollTop=0)},0)}.bind(this);n.el.querySelector("input");this.el.addEventListener("keydown",this.keydownHandler),this.el.addEventListener("input",this.changeHandler),this.el.addEventListener("focusout",this.focusoutHandler),this.clickHandler=function(o){var s=o.target;if(s.classList.contains("sui-form-ctrl-value")&&setTimeout(function(){e.sui.scrollIntoViewIfNeeded(s)},300),o.target.classList.contains("sui-input-url")){if(e.platform.CMPShell){var l=o.target.getAttribute("src");e.openWebView({url:l,useNativebanner:!0})}}else i&&"add"==e.sui.getFieldAuth(i.auth)&&e.sui.nextTick(function(){e.notification.prompt(e.i18n("form.field.appendNotice"),function(o,l){if(0==o){var c=""==i.value?"":"\r\n",d=i.value,u=" ";e.member&&e.member.name&&(u=e.member.name+" "),l=l.replace(/\n/g,"\r\n");var f=i.value+c+l+"\r\n\t["+u+(new Date).format("yyyy-MM-dd hh:mm")+"]";n.set(f);var m=e.sui.assertFieldLength(i,a);if(m.success){var p=n.el.querySelector("input");p&&(p.value=f);var h=n.el.querySelector("textarea");h&&(h.value=f,n.update(f),e.sui.clearErrorTips(n.el))}else{n.set(d);var v={type:1,info:{}};v.info[r]=m.tips,e.sui.showFormErrorTipsByErrorInfo(v)}i.__state="modified";var g=n.el.querySelector(".sui-form-ctrl-value");t(g),"TEXTAREA"==s.tagName&&e.sui.resize(s)}},[e.i18n("form.btn.ok"),e.i18n("form.btn.cancel")],"","",4)})}.bind(this),this.el.addEventListener("tap",this.clickHandler)},update:function(t){var i=this.params.scope.model,a=this.params.scope.fieldInfo,n=this.el.getAttribute("desc");this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:n,model:i,fieldInfo:a});var r=this.el.querySelector("textarea"),o=this;r&&o.vm.$nextTick(function(){var t=o.el.querySelector("textarea");e.sui.resize(t),setTimeout(function(){if(o&&o.el){var t=o.el.querySelector("textarea");e.sui.resize(t)}},100)}),e.sui.clearErrorTips(o.el)},unbind:function(){this.el.removeEventListener("input",this.changeHandler),this.el.removeEventListener("keydown",this.keydownHandler),this.el.removeEventListener("focusout",this.focusoutHandler),this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-radio",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;this.changeHandler=function(n){var r=t.value,o=a.el.querySelector("input"),s=n.target.value;r!=s&&(o.value=s,a.set(s),t.__state="modified",e.sui.clearErrorTips(a.el),a.el.children[0].classList.remove("sui-form-ctrl-empty"),e.sui.doCalculate(a.el,i))}.bind(this),this.el.addEventListener("change",this.changeHandler)}},update:function(t){var i=this.params.scope.model,a=this.params.scope.fieldInfo,n=this;this.setOptions(i.items);var r=this.el.getAttribute("desc");this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:r,model:i,fieldInfo:a});var o=n.el.querySelector("#radiogroup_"+a.name);if(o){var s=o.querySelector('[value="'+t+'"]');s&&(s.checked=!0)}},setOptions:function(e){e&&e.length>0&&void 0==e[0].text&&e.forEach(function(e){e.text=e.display||e.text})},unbind:function(){this.el.removeEventListener("change",this.changeHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-select",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;this.clickHandler=function(n){if("edit"==e.sui.getFieldAuth(t.auth)){var r=new e.PopPicker;this.setOptions(t),r.setData(t.items),r.defaultValue=t.value,r.setPickerDefalutValue(),r.show(function(n){var o=n[0],s=t.value,l=o.value||"";if(s!=l){t.display=o.text||"",a.set(l),t.__state="modified",a.update(l);var c=e.sui.getRecordIdByVueElement(a.el,i),d={formMasterId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:i.name,recordId:c,currentEnumItemValue:l,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};"refresh"==t.event?e.sui.dataService.capForm.dealMultiEnumRelation(d,function(t,i){return t?void e.notification.alert(t.message||"Error when calling dealMultiEnumRelation!",null,"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i)}):"calc"==t.event&&e.sui.doCalculate(a.el,i)}r.dispose(),r=null},function(){r.dispose(),r=null})}}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t){var i=this.params.scope.model,a=this.params.scope.fieldInfo;this.setOptions(i);var n=this.el.getAttribute("desc");this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:n,model:i,fieldInfo:a}),e.sui.clearErrorTips(this.el)},setOptions:function(t){var i=e.i18n("form.select.notice")||"--请选择--",a=t.items;a&&a.length>0&&void 0==a[0].text&&(a.forEach(function(e){e.text=e.display||e.text}),""!=a[0].display&&"0"!=a[0].value||("edit"==t.auth?a[0].text=i:a[0].text="",a[0].value=""))},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-static",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;t&&i&&(this.onLoadHandler=function(t){"infopath"==s3scope.metadata.templateType&&e.sui.refreshIScrollAsync()}.bind(this),this.el.addEventListener("load",this.onLoadHandler,!0))},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n});for(var r=this.el.querySelectorAll("img"),o=r.length,s=0;s<o;s++){var l=r[s];if("string"==typeof l.src&&!l.src.startsWith("http")){var c=l.src;c.startsWith("file://")&&(c=c.replace("file://","")),l.src=e.serverIp+c}}},unbind:function(){this.el.removeEventListener("load",this.onLoadHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";var a=t.extend({props:["scope"],template:'<div class="mui-input-row"><label>{{scope.fieldInfo.display}}</label><textarea type="text" v-model="scope.model.value"></textarea></div>'});t.component("sui-textarea",a)}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-attachment",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;t.attData=t.attData||[],t.attData.length>0&&(t.__state="modified"),this.vm.$nextTick(function(){var i=e.sui.getFormCtrlIdByVueElement(a.el);s3scope.attachmentInputs[i]=t.attData}),this.clickHandler=function(i){if("edit"==e.sui.getFieldAuth(t.auth))if(i.target.classList.contains("see-icon-v5-form-close-circle-fill")){var n=e.i18n("form.attachment.deleteConfirm");e.notification.confirm(n,function(e){if(1==e){var n=i.target.parent(".attachment-items").children.toArray(),r=i.target.parent(".attachment-item"),o=n.indexOf(r);o!=-1&&(t.attData.splice(o,1),t.__state="modified",t.editAttr=!0,a.update(t.value))}},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else if(i.target.closest(".attachment-add-item")){var r=[{key:"1",name:e.i18n("form.btn.photo")},{key:"2",name:e.i18n("form.btn.voice")},{key:"3",name:e.i18n("form.btn.localFile")},{key:"4",name:e.i18n("form.btn.localImage")}];e.platform.CMPShell||r.splice(1,1),cmp.dialog.actionSheet(r,e.i18n("form.btn.cancel"),function(i){var n="";"1"==i.key?n="photo":"2"==i.key?n="voice":"3"==i.key?n="localFile":"4"==i.key&&(n="picture"),n&&(cmp.dialog.loading(),e.att.suite({type:n,maxFileSize:52428800,success:function(e){cmp.dialog.loading(!1);var i=t.value;s3scope.moduleId;(e.att||[]).forEach(function(e){e.subReference=i,e.createdate=e.createdate||(new Date).getTime().toString(),t.attData.push(e)}),a.update(t.value),t.__state="modified",t.editAttr=!0,console.log(e)},cancel:function(){cmp.dialog.loading(!1)},error:function(t){cmp.dialog.loading(!1),e.notification.alert(t.message||t.msg||"上传附件失败!",null,"",e.i18n("form.btn.ok"))}}))},function(){})}else i.target.closest(".attachment-item")}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;a.attData=a.attData||[],this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-linenumber",{params:["scope"],twoWay:!0,bind:function(){var e=this.params.scope.model,t=this.params.scope.fieldInfo},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n})},unbind:function(){}}),t.directive("sui-customcontrol",{params:["scope"],twoWay:!0,bind:function(){var e=this.params.scope.model,t=this.params.scope.fieldInfo},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo,r=this.params.scope.isMaster;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n});var o=this;this.vm.$nextTick(function(){var t=e.sui.getFormCtrlIdByVueElement(o.el),i=-1,s=String(t).split("|");3==s.length&&(i=s[1]),SuiEvent.trigger({target:document,eventName:"sui_form_customcontrol_render",data:{model:a,fieldInfo:n,handler:o,isMaster:r,tableName:a.ownerTableName,recordId:i,target:o.el.querySelector(".sui-form-ctrl-field-main")}},function(e,t){})})},unbind:function(){}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-document",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;t.attData=t.attData||[],t.attData.length>0&&(t.__state="modified"),this.vm.$nextTick(function(){var i=e.sui.getFormCtrlIdByVueElement(a.el);s3scope.attachmentInputs[i]=t.attData}),this.clickHandler=function(i){if("edit"==e.sui.getFieldAuth(t.auth))if(i.target.classList.contains("see-icon-v5-form-close-circle-fill")){var n=e.i18n("form.document.deleteConfirm");e.notification.confirm(n,function(e){if(1==e){var n=i.target.parent(".document-items").children.toArray(),r=i.target.parent(".document-item"),o=n.indexOf(r);o!=-1&&(t.attData.splice(o,1),t.__state="modified",t.editAttr=!0,a.update(t.value))}},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else i.target.closest(".document-add-item")?e.accDoc("form-document",{fillbackData:t.attData,callback:function(i){"string"==typeof i&&(i=JSON.parse(i)),console.log(i);var n=t.value;t.attData.splice(0),e.sui.attachmentDataConverter(t.attData,i,n,!0),a.update(t.value),t.__state="modified",t.editAttr=!0}}):i.target.closest(".document-item")}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;a.attData=a.attData||[],this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-exchangetask",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;this.clickHandler=function(n){if("edit"==e.sui.getFieldAuth(t.auth)){var r=e.sui.getFormCtrlIdByVueElement(a.el),o=e.sui.getRecordIndexByVueElement(a.el,i),s=e.sui.getTempKey(),l=e.sui.getRecordIdByVueElement(a.el,i);e.sui.lastPosCtrlId=r;var c=e.extend({recordIndex:o,ctrlId:r,recordId:l},i),d={formId:s3scope.formId,contentDataId:s3scope.formMasterId,fieldName:i.name,recordId:l,allowCheck:!0};e.sui.dataService.capForm.mergeFormData({formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)},function(t,i){e.deeDataList(s,c,d)})}}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},
update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n})},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-externalwrite-ahead",{params:["scope"],twoWay:!0,bind:function(){var e=this.params.scope.model,t=this.params.scope.fieldInfo},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n})},unbind:function(){}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-image",{params:["scope"],twoWay:!0,bind:function(){function t(t,i){var a=[{key:"1",name:e.i18n("form.btn.photo")},{key:"2",name:e.i18n("form.btn.localImage")}];cmp.dialog.actionSheet(a,e.i18n("form.btn.cancel"),function(i){var a="";"1"==i.key?a="photo":"2"==i.key&&(a="picture"),a&&(cmp.dialog.loading(),cmp.att.suite({type:a,pictureNum:1,maxFileSize:10485760,success:function(e){cmp.dialog.loading(!1),t.attData.splice(0);var i=t.value,a=s3scope.moduleId;(e.att||[]).forEach(function(e){e.subReference=i,e.reference=a,e.createdate=e.createdate||(new Date).getTime().toString(),t.attData.push(e)}),n.update(t.value),t.__state="modified",t.editAttr=!0,console.log(e)},cancel:function(){cmp.dialog.loading(!1)},error:function(t){cmp.dialog.loading(!1),e.notification.alert(t.message||t.msg||"上传图片失败!",null,"",e.i18n("form.btn.ok"))}}))},function(){})}var i=this.params.scope.model,a=this.params.scope.fieldInfo;if(i&&a){var n=this;i.attData=i.attData||[],i.attData.length>0&&(i.__state="modified"),this.vm.$nextTick(function(){var t=e.sui.getFormCtrlIdByVueElement(n.el);s3scope.attachmentInputs[t]=i.attData});e.sui.dataService.debug?e.sui.dataService.targetServer:e.serverIp;this.clickHandler=function(r){if("edit"==e.sui.getFieldAuth(i.auth))if("IMG"==r.target.tagName);else if(r.target.classList.contains("see-icon-v5-form-close-circle")||r.target.classList.contains("see-icon-v5-form-close-circle-fill")){var o=e.i18n("form.image.deleteConfirm");e.notification.confirm(o,function(e){1==e&&(i.attData.splice(0),i.__state="modified",i.editAttr=!0,n.update(i.value))},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else if(r.target.parent(".image-add-item"))if(i.attData.length>0){var o=e.i18n("form.image.updateConfirm");e.notification.confirm(o,function(e){1==e&&t(i,a)},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else t(i,a)}.bind(this),this.el.addEventListener("tap",this.clickHandler),this.onLoadHandler=function(t){e.sui.onImgLoadHandler(t)}.bind(this),this.el.addEventListener("load",this.onLoadHandler,!0)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;a.attData=a.attData||[],this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("load",this.onLoadHandler),this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-outwrite",{params:["scope"],twoWay:!0,bind:function(){var e=this.params.scope.model,t=this.params.scope.fieldInfo},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n})},unbind:function(){}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-querytask",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;this.clickHandler=function(n){if("edit"==e.sui.getFieldAuth(t.auth)){var r=e.sui.getFormCtrlIdByVueElement(a.el),o=e.sui.getRecordIndexByVueElement(a.el,i),s=e.sui.getTempKey(),l=e.sui.getRecordIdByVueElement(a.el,i);e.sui.lastPosCtrlId=r;var c=e.extend({recordIndex:o,ctrlId:r,recordId:l},i),d={formId:s3scope.formId,contentDataId:s3scope.formMasterId,fieldName:i.name,recordId:l,allowCheck:!1};e.sui.dataService.capForm.mergeFormData({formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)},function(t,i){e.deeDataList(s,c,d)})}}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n})},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-maplocate",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this,n=!1,r=null;this.clickHandler=function(o){return n?(r&&clearTimeout(r),void(r=setTimeout(function(){n=!1},5e3))):(n=!0,void e.sui.maplocate_clickHandler(o,a,t,i,function(){n=!1}))}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-mapmarked",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;this.clickHandler=function(n){e.sui.mapmarked_clickHandler(n,a,t,i)}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-mapphoto",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;t.attData=t.attData||[],t.attData.length>0&&(t.__state="modified"),this.vm.$nextTick(function(){var i=e.sui.getFormCtrlIdByVueElement(a.el);s3scope.attachmentInputs[i]=t.attData}),this.clickHandler=function(n){e.sui.mapphoto_clickHandler(n,a,t,i)}.bind(this),this.el.addEventListener("tap",this.clickHandler),this.onLoadHandler=function(t){e.sui.onImgLoadHandler(t)}.bind(this),this.el.addEventListener("load",this.onLoadHandler,!0)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;a.attData=a.attData||[],this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler),this.el.removeEventListener("load",this.onLoadHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-organization",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;this.clickHandler=function(n){if("edit"==e.sui.getFieldAuth(t.auth)){var r=n.target.getAttribute("action");if("clear-value"==r){a.set(""),t.display="",t.__state="modified",this.update(""),n.stopPropagation();var o=e.sui.getRecordIdByVueElement(this.el,i);return void e.sui.dataService.capForm.dealOrgFieldRelation({formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:i.name,recordId:o,selectType:i.finalInputType,orgId:t.value,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)},function(t,i){return t?void e.notification.alert(t.message||"Error when calling dealOrgFieldRelation!",null,"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i)})}var s=({command:1,value:{selectType:"Member",isMulti:!0,value:t.value}},1);0==i.finalInputType.indexOf("multi")&&(s=Math.floor(i.fieldLength/21),s=s||1),"longtext"==i.fieldType.toLowerCase()&&(s=9999999999);var l=e.sui.getFormCtrlIdByVueElement(this.el),c=e.sui.getRecordIndexByVueElement(this.el,i),o=e.sui.getRecordIdByVueElement(this.el,i);e.sui.lastPosCtrlId=l;var d=e.extend({recordIndex:c,ctrlId:l,recordId:o},i);console.log(i.finalInputType),console.log(d);var u=[];t.display=t.display.replace(/,/g,"、");for(var f=t.value.split(","),m=t.display.split("、"),p=i.finalInputType.replace("multi",""),h=f.length,v=0;v<h;v++)f[v]&&u.push({id:f[v],name:m[v],type:p});var g=!1,y=["dept","org","post","team","extP"],I=p;"0"!=i.externalType?(g=!0,"department"==p&&(I="1"==i.externalType?"department_vj1":"department_vj2")):"member"==p&&(y=["dept","org","post","team","extP","vjOrg"]),e.selectOrgJump("select-jump",{type:2,fillBackData:u,maxSize:s,minSize:-1,debug:e.sui.dataService.debug,_proxyServer:e.sui.dataService.proxyServer,_targetServer:e.sui.dataService.targetServer,_sessionId:e.sui.dataService.sessionId,label:y,selectType:I,vj:g,pageKey:e.sui.getTempKey(),metadata:d})}}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-project",{params:["scope"],twoWay:!0,bind:function(){function t(t,r){i.display=r,n.set(t),i.__state="modified",n.update(t);var o=e.sui.getRecordIdByVueElement(n.el,a),s={formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,fieldName:a.name,recordId:o,projectId:t,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)};e.sui.dataService.capForm.dealProjectFieldRelation(s,function(t,i){return t?void e.notification.alert(t.message||"Error when calling dealProjectFieldRelation!",null,"",e.i18n("form.btn.ok")):void e.sui.refreshFormData(null,i.results?i.results:i)})}var i=this.params.scope.model,a=this.params.scope.fieldInfo;if(i&&a){var n=this;this.clickHandler=function(a){if("edit"==e.sui.getFieldAuth(i.auth)){if("undefined"==typeof $ProjectAccountList)return void e.notification.alert("Can not find the js file $ProjectAccountList!",null,"",e.i18n("form.btn.ok"));var n=i.value;$ProjectAccountList.init({selectedId:n,eventBack:function(){},eventSelected:function(e,i){t(e,i)}})}}.bind(this),this.el.addEventListener("tap",this.clickHandler)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),e.sui.clearErrorTips(this.el)},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-relation",{params:["scope"],twoWay:!0,bind:function(){var e=this.params.scope.model,t=this.params.scope.fieldInfo;e&&t&&(this.clickHandler=function(e){}.bind(this),this.el.addEventListener("tap",this.clickHandler))},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo;this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n})},unbind:function(){this.el.removeEventListener("tap",this.clickHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-relationform",{params:["scope"],twoWay:!0,bind:function(){var t=this.params.scope.model,i=this.params.scope.fieldInfo;if(t&&i){var a=this;t.attData=t.attData||[],t.attData.length>0&&(t.__state="modified"),this.vm.$nextTick(function(){var i=e.sui.getFormCtrlIdByVueElement(a.el);s3scope.attachmentInputs[i]=t.attData}),this.clickHandler=function(n){if(n.target.suiMatchesSelector(".see-icon-v5-form-ic-form-fill")){if(t.extMap&&t.extMap.templateSize<=0)return void e.notification.alert(e.i18n("form.app.noBind"),null,"",e.i18n("form.btn.ok"));e.sui.dataService.capForm.mergeFormData({formDataId:s3scope.formMasterId,formId:s3scope.formId,moduleId:s3scope.moduleId,rightId:s3scope.rightId,data:e.sui.reduceSubmitData(s3scope.data),attachmentInputs:e.sui.getAttachments(s3scope.attachmentInputs)},function(t,n){console.log("after mergeFormData");var r=e.sui.getFormCtrlIdByVueElement(a.el),o=e.sui.getRecordIndexByVueElement(a.el,i),s=e.sui.getTempKey(),l=e.sui.getRecordIdByVueElement(a.el,i);e.sui.lastPosCtrlId=r;var c={formId:i.relation.toRelationObj,fromFormId:i.relation.fromRelationObj,moduleId:s3scope.moduleId,fromDataId:s3scope.formMasterId,fromRecordId:l,fromRelationAttr:i.relation.fromRelationAttr,toRelationAttr:i.relation.toRelationAttr,formType:"1"==i.relation.toRelationFormType?"form":"unflowform",mutiselect:!(r.indexOf("master")>=0),showView:void 0==i.relation.showView||1==i.relation.showView,data:s3scope.data},d=e.extend({recordIndex:o,ctrlId:r,recordId:l},i);return console.log(c),"undefined"==typeof e.relationForm?void e.notification.alert("Can not find the js file $.relationForm!",null,"",e.i18n("form.btn.ok")):void e.relationForm(s,d,c)})}else n.target.suiMatchesSelector(".allow-click-relationform")||("maplocate"==i.finalInputType?e.sui.maplocate_clickHandler(n,a,t,i):"mapmarked"==i.finalInputType?e.sui.mapmarked_clickHandler(n,a,t,i):"mapphoto"==i.finalInputType&&e.sui.mapphoto_clickHandler(n,a,t,i))}.bind(this),this.el.addEventListener("tap",this.clickHandler),this.onLoadHandler=function(t){e.sui.onImgLoadHandler(t)}.bind(this),"handwrite"!=i.finalInputType&&"image"!=i.finalInputType&&"mapphoto"!=i.finalInputType||this.el.addEventListener("load",this.onLoadHandler,!0)}},update:function(t,i){var a=this.params.scope.model,n=this.params.scope.fieldInfo,r=this;if(this.setOptions(a),this.el.innerHTML=e.sui.htmlBuilder({value:t,desc:"",model:a,fieldInfo:n}),n.relation&&"2"==n.relation.viewSelectType){var o=this.el.querySelector(".sui-form-ctrl-field");o&&(o.classList.remove("sui-auth-edit"),o.classList.add("sui-auth-browse"))}if("radio"==n.finalInputType){var s=this.el.querySelector("#radiogroup_"+n.name).querySelector('[value="'+t+'"]');s&&(s.checked=!0)}else for(var l=this.el.querySelectorAll("input,textarea,select"),c=l.length,d=0;d<c;d++){var u=l[d];u.value=t,u.checked="true"==t.toString()||"1"==t}if("textarea"==n.finalInputType)r.vm.$nextTick(function(){var t=r.el.querySelector("textarea");e.sui.resize(t),setTimeout(function(){var t=r.el.querySelector("textarea");e.sui.resize(t)},100)});else if("flowdealoption"==n.finalInputType)for(var f=this.el.querySelectorAll("img"),c=f.length,d=0;d<c;d++){var o=f[d];if("string"==typeof o.src&&!o.src.startsWith("http")){var m=o.src;m.startsWith("file://")&&(m=m.replace("file://","")),o.src=e.serverIp+m}}},setOptions:function(t){var i=(e.i18n("form.select.notice")||"--请选择--",t.items);i&&i.length>0&&void 0==i[0].text&&(i.forEach(function(e){e.text=e.display||e.text}),""!=i[0].display&&"0"!=i[0].value||(i[0].text="",i[0].value=""))},unbind:function(){this.el.removeEventListener("tap",this.clickHandler),this.el.removeEventListener("load",this.onLoadHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";function a(e,t){(e||[]).forEach(function(e){e.selected=t})}function n(e){for(var t=(e||[]).length,i=0;i<t;i++)if(!e[i].selected)return!1;return!0}t.directive("sui-sub-table-check-all",{params:["scope"],twoWay:!0,bind:function(){var t=window.s3scope,i=this.params.scope.tableName,r=this,o=!1;this.clickHandler=function(n){n.target.classList.contains("see-icon-v5-form-checkbox-checked")?(this.set(!1),a(t.data.children[i].data,!1),o=!1,e.sui.trigger("onsubtablecheck")):(this.set(!0),a(t.data.children[i].data,!0),o=!0,e.sui.trigger("onsubtablecheck"))}.bind(this),this.expandHandler=function(t){for(var i=t.target.parentNode.parentNode.parentNode,a=i.querySelectorAll("textarea"),n=a.length,r=0;r<n;r++){var o=a[r];!function(t){e.sui.nextTick(function(){e.sui.resize(t)})}(o)}};var s=this.el.parentNode.querySelector(".see-icon-v5-form-arrow-down");s&&s.addEventListener("tap",this.expandHandler),this.el.addEventListener("tap",this.clickHandler),this.el.classList.add("sui-sub-table-check-all"),this.subTableCheckHandler=function(e){var a=n(t.data.children[i].data);r.update(a)}.bind(this),document.addEventListener("onsubtablecheck",this.subTableCheckHandler)},update:function(e){var t=window.s3scope,i=this.params.scope.tableName,a=(t.data.children[i].data,"");a+=e?'<i action="selectItem" class="see-icon-v5-form-checkbox-checked"></i>':'<i action="selectItem" class="see-icon-v5-form-checkbox-unchecked-my"></i>',this.el.innerHTML=a},unbind:function(){var e=this.el.parentNode.querySelector(".see-icon-v5-form-arrow-down");e&&(e.removeEventListener("tap",this.expandHandler),e=null),this.el.removeEventListener("tap",this.clickHandler),document.removeEventListener("onsubtablecheck",this.subTableCheckHandler)}})}(cmp,Vue,document),function(e,t,i){"use strict";t.directive("sui-sub-table-toolbar",{params:["scope"],twoWay:!0,bind:function(){function t(t){"lightForm"==i.metadata.templateType&&t&&e.sui.nextTick(function(){var i=document.querySelector('[recordid="'+t.__id+'"]');i&&(e.sui.scrollIntoView(i),i.classList.add("sui-sub-table-new-record"))})}var i=window.s3scope,a=this.params.scope.tableName,n=i.data.children[a].data,r=this.params.scope.item,o=("sub-table-"+a+"-"+r.__id,this);o.update();var s=!1,l=null;this.clickHandler=function(i){if(s)return l&&clearTimeout(l),void(l=setTimeout(function(){s=!1},5e3));s=!0;var o=i.target.getAttribute("action"),c=n.indexOf(r);if("copy"==o||"empty"==o)cmp.dialog.loading(),e.sui.addRecordInSubTable(o,a,r,function(e,i){cmp.dialog.loading(!1),e||t(i),s=!1});else if("del"==o)if(n.length>1){var d=e.i18n("form.childrenTable.deleteConfirm");e.notification.confirm(d,function(t){1==t?(cmp.dialog.loading(),e.sui.delRecordInSubTable("del",a,r,function(t,i){cmp.dialog.loading(!1),s=!1,t?e.notification.alert(t.message||t.msg||"Error when calling $.sui.delRecordInSubTable!",null,"",e.i18n("form.btn.ok")):n.splice(c,1)})):s=!1},"",[e.i18n("form.btn.cancel"),e.i18n("form.btn.ok")])}else e.notification.alert(e.i18n("form.childrenTable.deleteLastNotice"),null,"",e.i18n("form.btn.ok")),s=!1;else"selectItem"==o?(r.selected=!r.selected,e.sui.trigger("onsubtablecheck"),s=!1):s=!1}.bind(this),this.el.addEventListener("tap",this.clickHandler),this.subTableCheckHandler=function(e){o.update()}.bind(this),this.updateToolbarHandler=function(e){o.update()}.bind(this),document.addEventListener("onsubtablecheck",this.subTableCheckHandler),document.addEventListener("onupdatetoolbar",this.updateToolbarHandler)},update:function(){var e=window.s3scope,t=this.params.scope.tableName,i=(e.data.children[t].data,this.params.scope.item),a="sub-table-"+t+"-"+i.__id,n="";(e.data.children[t].allowDelete||e.data.children[t].allowAdd||e.allowCheck)&&(n='<div id="'+a+'" class="sui-sub-table-btns">',e.allowCheck&&(n+=i.selected?'<i action="selectItem" class="see-icon-v5-form-checkbox-checked"></i>':'<i action="selectItem" class="see-icon-v5-form-checkbox-unchecked"></i>'),e.data.children[t].allowAdd&&(n+='<i action="copy" class="toolbar-btn see-icon-v5-form-new-circle"></i>',n+='<i action="empty" class="toolbar-btn see-icon-v5-form-copy-circle"></i>'),e.data.children[t].allowDelete&&(n+='<i action="del" class="toolbar-btn see-icon-v5-form-remove-circle"></i>'),n+="</div>"),this.el.innerHTML=n},unbind:function(){this.el.removeEventListener("tap",this.clickHandler),document.removeEventListener("onsubtablecheck",this.subTableCheckHandler),document.removeEventListener("onupdatetoolbar",this.updateToolbarHandler)}})}(cmp,Vue,document);