"use strict";!function(e,t){function a(e,t){var a=document.createElement("script");a.src=e,t=t||function(){},a.onload=a.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(t(),this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this))},document.getElementsByTagName("head")[0].appendChild(a)}function r(e,t,a){var r,s;r=document.getElementById(e),s=s3utils.C_iRefresh_Refresh,s3utils.refreshElement(r,s,window[t].formMain.call(this,a),!0)}function s(t,a){var r="",s=a.fieldInfo.inputType;switch(s){case"text":t.value=a.value,r+="<input "+e.sui.attrBuilder(t)+"/>";break;case"textarea":t.value=a.value,r+="<textarea "+e.sui.attrBuilder(t)+">"+a.value+"</textarea>";break;case"checkbox":t.type="checkbox",t.value=a.value,t.checked=a.value,t["class"]+=" see-icon",r+="<input "+e.sui.attrBuilder(t)+"/>";break;case"radio":t.value=a.value,t.readonly="true",t["class"]+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",r+='<div class="sui-radio-group">';var i=a.model.items;i.forEach(function(e){r+='<div class="sui-radio-group">'}),console.log(i),r+="</div>";break;case"select":t.value=a.value,t.readonly="true",t["class"]+=" sui-hide",r+="<input "+e.sui.attrBuilder(t)+"/>",console.log(a.model.items.filter(function(e){return e.value==a.value}));var o=(a.model.items||[]).filter(function(e){return e.value==a.value}),l=0==o.length?a.value:o[0].text||"";r+="<div "+e.sui.attrBuilder({"class":"sui-form-ctrl-value-display"})+">"+l+"</div>",r+='<i class="see-icon-v5-common-pull-down"></i>';break;case"date":case"datetime":t.value=a.value,t.readonly="true",t["class"]+=" sui-hide";var n="date"==s?"yyyy-MM-dd":"yyyy-MM-dd hh:mm";r+="<input "+e.sui.attrBuilder(t)+"/>";var c=new Date(a.value),l=isNaN(c)?"":c.format(n);r+="<div "+e.sui.attrBuilder({"class":"sui-form-ctrl-value-display"})+">"+l+"</div>",r+=l?'<i action="clear-value" class="see-icon-v5-common-close-circle-fill"></i>':'<i class="see-icon-v5-common-pull-down"></i>';break;case"flowdealoption":case"lable":case"handwrite":case"barcode":case"linenumber":case"relationform":case"relation":case"project":case"member":case"multimember":case"account":case"multiaccount":case"department":case"multidepartment":case"post":case"multipost":case"level":case"multilevel":t.value=a.value,t.readonly="true",r+="<input "+e.sui.attrBuilder(t)+"/>";break;case"attachment":case"image":case"document":case"outwrite":case"externalwrite-ahead":case"exchangetask":case"querytask":case"mapmarked":case"maplocate":case"mapphoto":case"customcontrol":}return r}function i(e){var t={};return(e||[]).forEach(function(e){t[e.id]=e}),t}function o(e,t,a){console.log("触发后台计算，向后台发送数据");for(var r=document.querySelectorAll('[fieldname="field0103"]'),s=r.length,i=0,o=0;o<s;o++)i+=Number(r[o].value);var l={master:{__state:"none",field0007:{value:i,display:i,auth:"browse"}},children:{form002:[]}};console.log(i),a(null,l)}Element.prototype.parents=function(e){for(var t=[],a=this,r=void 0!==e;null!==(a=a.parentElement);)a.nodeType===Node.ELEMENT_NODE&&(r&&!a.matches(e)||t.push(a));return t},e.sui=e.sui||{},e.sui.loadForm=function(t,s){var i=t.containerId,o=t.moduleId,l=t.rightId,n=t.viewState,c=t.moduleType,u="form_1001",d=document.getElementById(i).getAttribute("rootpath"),m=d+"/js/"+u+".s3js";a(m,function(){e.ready(function(){var t={moduleId:o,rightId:l,viewState:n,openFrom:"listPending",moduleType:c};e.sui.dataService.capForm.showFormData(t,function(e,t){if(e)return void alert(e.message||e.responseText);t.results&&t.contentList&&t.contentList.length>0&&(t.results.formMasterId=t.contentList[0].contentDataId,t.results.formId=t.contentList[0].contentTemplateId),window.s3scope=t.results,window.s3scope.moduleId=o,window.s3scope.rightId=l,r(i,u,window.s3scope);new Vue({el:"#"+i,data:{s3scope:s3scope},methods:{}})})})})},e.sui.htmlBuilder=function(t){var a=((t.tagName||"input").toLowerCase(),"<div "+e.sui.attrBuilder({"class":"sui-form-ctrl-inner"})+">");a+="<label "+e.sui.attrBuilder({"class":"sui-form-ctrl-title"})+">";var r;t.model.notNull&&"false"!=t.model.notNull,a+="<span "+e.sui.attrBuilder({"class":"sui-form-required"})+">*</span>",r=!0,a+=t.fieldInfo.display,a+="</label>",t.desc&&"false"!=t.desc&&(a+="<div "+e.sui.attrBuilder({"class":"sui-form-ctrl-desc"})+">"+t.desc+"</div>");var i="sui-auth-"+(t.model.auth||"edit");a+="<div"+e.sui.attrBuilder({"class":"sui-form-ctrl-field "+i})+">";var o={"class":"sui-form-ctrl-value",fieldname:t.fieldInfo.fieldName,inputtype:t.fieldInfo.inputType};return r&&(o.required="true"),o.validate="true","DECIMAL"==t.fieldInfo.fieldType?o.type="number":o.type="text","edit"!=t.model.auth&&(o.readonly="true",o.disabled="disabled"),a+=s(o,t),a+="</div>",a+="</div>"},e.sui.attrBuilder=function(e){var t="";for(var a in e)t+=" "+a+'="'+(e[a]||"")+'"';return t},e.sui.clone=function(t,a){var r;r=t.constructor==Object?new t.constructor:new t.constructor(t.valueOf());for(var s in t)r[s]!=t[s]&&("object"==typeof t[s]?r[s]=e.sui.clone(t[s],a):(r[s]=t[s],a&&("value"!=s&&"display"!=s||(r[s]=""))));return r.toString=t.toString,r.valueOf=t.valueOf,r},e.sui.getBindId=function(e){return""},e.sui.addRecordInSubTable=function(t,a,r,s,i){var o={};for(var l in s)0==l.indexOf("field")&&(o[l]=s[l].value);console.log(o);var n={formMasterId:s3scope.formMasterId,formId:s3scope.formId,rightId:s3scope.rightId,tableName:a,type:t,recordId:r.id,data:o};console.log(n);var c={formMasterId:s3scope.formMasterId,formId:s3scope.formId,rightId:s3scope.rightId,tableName:a,fieldName:"field0010",currentEnumItemValue:"7384053969087909078"};e.sui.dataService.capForm.dealFormRelation(c,function(e,t){console.log(t)})},e.sui.delRecordInSubTable=function(t,a,r,s){var i={formMasterId:s3scope.formMasterId,formId:s3scope.formId,rightId:s3scope.rightId,tableName:a,type:t,recordId:r.id};e.sui.dataService.capForm.addOrDelDataSubBean(i,function(t,a){e.sui.refreshFormData(r,a,s)})},e.sui.refreshFormData=function(e,t,a){if(!t||!t.data)return void(a&&a());var r=t.data;if(r.master)for(var s in r.master)r.master[s]instanceof Object&&void 0!==r.master[s].value&&(s3scope.data.master[s]=r.master[s]);if(r.children)for(var o in r.children)for(var l=r.children[o],n=l.length,c=s3scope.data.children[o],u=i(c),d=0;d<n;d++){var m=l[d];if(u.hasOwnProperty(m.id))for(var f in m)m[f]instanceof Object&&void 0!==m[f].value&&(c[d][s]=m[f]);else{var v=c.indexOf(e);v=v>=0?v:c.length-1,c.splice(v+1,0,m)}}},e.sui.reCalcWhenRecordChange=function(t,a,r){setTimeout(function(){o(null,null,function(t,a){e.sui.refreshAfterReCalc(a)})},10)},e.sui.calculate=function(t,a){console.log(t);var r={formMasterId:s3scope.formMasterId,formId:s3scope.formId,rightId:s3scope.rightId,fieldName:t.fieldInfo.fieldName};!t.isMaster&&t.recordId&&(r.recordId=t.recordId),e.sui.dataService.capForm.calculate(r,function(a,r){console.log(r),e.sui.refreshFormData(t.model,r,callback)})},e.sui.refreshAfterReCalc=function(e,t){console.log(e),console.log("重新计算完成，刷新相关DOM展现");for(var a in e.master)e.master[a]instanceof Object&&void 0!==e.master[a].value&&(s3scope.data.master[a]=e.master[a]);for(var r in e.children)for(var s=e.children[r],o=s.length,l=s3scope.data.children[r],n=i(l),c=0;c<o;c++){var u=s[c];if(n.hasOwnProperty(u.id))for(var d in u)u[d]instanceof Object&&void 0!==u[d].value&&(l[c][a]=u[d]);else{var m=l.indexOf(t);m=m>=0?m:l.length-1,l.splice(m+1,0,u)}}},e.sui.getFormCtrl=function(t){if(t.classList.contains("sui-form-ctrl"))return t;if("HTML"==t.tagName)return null;var a=t.parentNode;return e.sui.getFormCtrl(a)}}(cmp,document);