(function(h,e,f,g){f._showDetail=function(a){var c=this;var d=a.attr("signatureId");var b=a.attr("divid");var j=c._getSigngaturesBySignatureId(d);j[0].signature.divId=b;c.dialog=artDialog({signatureDiv:a,id:"kg_showDetailWin",content:null,zIndex:(c.defaults.zindex+1987),width:"320px",height:"213px",title:true,lockClick:true,padding:0,ok:false,cancel:false,lock:true,background:"#000",opacity:0.6});
c.getSignInfo({signatures:j,callback:c._showDetailCallBack,dialog:c.dialog.config.id});};f._showDetailCallBack=function(t,v,b){var q=b;if(!t.error){var p=q.dialog;var r=p.config.signatureDiv;var s=q._getDOM(q.templates.detailHTML);var u=t.properties.signatures[0];for(var c in u){if(s[c]!==g){s[c].text(u[c]);
}}if(r.attr("ismodified")==="true"){s.signResult.text("\u6587\u4ef6\u5df2\u88ab\u7be1\u6539");}else{s.signResult.text("\u6587\u4ef6\u5b8c\u597d\u65e0\u635f");}if(q.currentKeysn!==r.attr("keysn")){s.removeSignature.remove();s.runCert.remove();s.signVerify.remove();s.certVerify.remove();}var d=t.properties.certificates[0];
if(d.signed==="false"){s.certTable.hide();s.signVerify.remove();s.certVerify.remove();s.certTip.html(d.errorMsg).show();}else{s.runCert.remove();for(var c in d){if(s[c]!==g){s[c].text(d[c]);}}}var a=s.content.height();p.size(q.dialog.config.width,a);}else{q._alertX(t.errorMsg);q.dialog.close();}};f._verifyCertCall=function(a,c){var b=this;
if(a.error){b._alertX(a.errorMsg);}else{b._alertX("\u8bc1\u4e66\u9a8c\u8bc1\u6b63\u5e38\uff01");}};f._changePwdCallBack=function(c){var d=this;var j=d._getDialog(c);var b=j.config.kgparam;var a=j.config.kgdom;b.oldPwd=a.oldpwdInput.val();b.newPwd=a.newpwdInput.val();if(b.signName){b.signMethod="1";b.signVal=b.signName;
}else{if(b.signIndex){b.signMethod="0";b.signVal=b.signIndex;}}d.ajax(d.urls.changePwdUrl,b,function(i){if(b.callback){b.callback(i);}else{if(i.error){d._alertX(i.errorMsg);}else{d._alertX("\u5bc6\u7801\u4fee\u6539\u6210\u529f\uff01");j.close();}}},true);};f.changePwd=function(a){var c=this;c.dialog=artDialog({content:null,id:"kg_changePwdWin",title:"\u7535\u5b50\u7b7e\u7ae0",width:"300px",height:"90px",padding:10,zIndex:(c.defaults.zindex+1987),ok:false,cancel:false});
var b=c._getDOM(c.templates.changeHTML);if(a.signName||a.signIndex){b.keysn.text(a.keySN+"("+(a.signName?a.signName:a.signIndex)+")");}else{b.keysn.text.text(a.keySN);}c.dialog.config.kgdom=b;c.dialog.config.kgparam=a;};f._delSignature=function(){var b=this;var a=b.dialog.config.signatureDiv;b.dialog.close();
var c=b.templates.delSignatureHTML.replace("@SIGNNAME@",a.attr("signname"));b.dialog=artDialog({content:c,id:"kg_delSignatureWin",title:"\u64a4\u9500\u7b7e\u7ae0",width:"300px",height:"80px",padding:10,ok:function(){var j={"signatureId":a.attr("signatureId"),"documentId":a.attr("documentid"),"keyPassword":h("#kg_pwdInput").val(),"signVal":a.attr("signName")};
var d=b.delSignature(j);if(b.isGet){return true;}return d;},cancel:true});};f._showSignatureDiv=function(v,r){var s=this;var u=null;s.dialog=artDialog({content:null,id:"kg_showSignatureWin",title:"\u7535\u5b50\u7b7e\u7ae0",width:s.defaults.dW+"px",padding:10,zIndex:(s.defaults.zindex+1987),ok:false,cancel:false});
var a=[];if(v.backGetPwd){a.push("noPwd_tr");a.push("memory_pwd");}if(!v.remenberSign){a.push("memory_sign");}if(!v.remenberPwd){a.push("memory_pwd");}u=s._getDOM(s.templates.signatureHTML,a);u.signnameSelect.focus();var c=r.keySN;var b=r.signatures;var x=u.signnameSelect[0];for(var d=0;d<b.length;d++){var w=b[d];
var t=new Option(w.signName,w.signSn);x.options.add(t);t.id=w.signSn;if(v.runSignatureParams.signMethod==="0"){t.setAttribute("signname",w.signIndex);}else{t.setAttribute("signname",w.signName);}t.setAttribute("unique",c+"_"+d);}if(!v.backGetPwd&&v.remenberPwd){var y=s._getLocal("kg_memory_pwd_text");
if(y!=null){u.pwdInput.val(y);u.memory_pwd_input.attr("checked",true);}}if(v.remenberSign){var z=s._getLocal("kg_memory_sign_text");if(z!=null){document.getElementById(z).setAttribute("selected",true);u.memory_sign_input.attr("checked",true);}}if(v.runSignatureParams.signValue){h("option[signname='"+v.runSignatureParams.signValue+"']").attr("selected",true);
}s.dialog.config.kgdom=u;s.dialog.config.kgparam=v;};f._signVerifyCall=function(a,c){var b=this;if(a.error){b._alertX(a.errorMsg);}else{b._alertX(a.errorMsg);}};f.templates={changeHTML:'<div id="kg_change" class="kg_signature kg_change" style="text-align: center;">'+'<table class="kg_form">'+"<tr>"+'<td class="kg_field">\u5bc6\u94a5\u76d8\uff1a</td>'+'<td class="kg_value" id="kg_keysn" >'+"</td>"+"</tr>"+"<tr >"+'<td class="kg_field">\u539f\u5bc6\u7801\uff1a</td>'+'<td class="kg_value"><input style="width:145px;" type="password" class="kg_pwdInput" maxlength="20" name="kg_pwdInput" id="kg_oldpwdInput" /> '+"</td>"+"</tr>"+"<tr >"+'<td class="kg_field">\u65b0\u5bc6\u7801\uff1a</td>'+'<td class="kg_value"><input style="width:145px;" type="password" class="kg_pwdInput" maxlength="20" name="kg_pwdInput" id="kg_newpwdInput" /> '+"</td>"+"</tr>"+"<tr >"+'<td class="kg_field">\u786e\u8ba4\u5bc6\u7801\uff1a</td>'+'<td class="kg_value"><input style="width:145px;" type="password" class="kg_pwdInput" maxlength="20" name="kg_pwdInput" id="kg_confirmPwdInput" /> '+"</td>"+"</tr>"+"</table>"+'<div class="kg_buttons">'+'<button  class="kg_close" winId="kg_changePwdWin" >&nbsp;\u5173&nbsp;\u95ed&nbsp;</button>'+'<button class="kg_changePwd" winId="kg_changePwdWin" >&nbsp;\u786e&nbsp;\u5b9a&nbsp;</button>'+"</div>"+"</div>",signatureHTML:'<div id="kg_delSignature" class="kg_signature kg_delSignature" style="text-align: center;" >'+'<table class="kg_form">'+"<tr>"+'<td class="kg_field">\u7b7e\u7ae0\uff1a</td>'+'<td class="kg_value" ><select style="width:147px;" name="kg_signname" class="kg_pwdInput" id="kg_signnameSelect" />'+"</td>"+"</tr>"+'<tr id="kg_noPwd_tr" class="">'+'<td class="kg_field">\u5bc6\u7801\uff1a</td>'+'<td class="kg_value"><input style="width:145px;" type="password" class="kg_pwdInput" maxlength="20" name="kg_pwdInput" id="kg_pwdInput" /> '+"</td>"+"</tr>"+"</table>"+'<div class="kg_tip" id="kg_noPwd_div" >'+'<label class="inputSpan " id="kg_memory_sign" for="memory_sign_input">'+'<input type="checkbox" id="kg_memory_sign_input"  class="kg_inputBox" />\u8bb0\u4f4f\u7b7e\u7ae0</label>'+'<label class="inputSpan " for="memory_pwd_input" id="kg_memory_pwd" >'+'<input type="checkbox" id="kg_memory_pwd_input"  class="kg_inputBox"  />\u8bb0\u4f4f\u5bc6\u7801</label>'+"</div>"+'<div class="kg_buttons">'+'<button  class="kg_close" winId="kg_showSignatureWin" >&nbsp;\u5173&nbsp;\u95ed&nbsp;</button>'+'<button class="kg_runSignature" winId="kg_showSignatureWin" >&nbsp;\u786e&nbsp;\u5b9a&nbsp;</button>'+"</div>"+"</div>",delSignatureHTML:'<div id="kg_delSignature" class="kg_signature kg_delSignature" >'+'<table class="kg_form">'+"<tr>"+'<td class="kg_field">\u7b7e\u7ae0\uff1a</td>'+'<td id="kg_signname" class="kg_value">@SIGNNAME@'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field">\u5bc6\u7801\uff1a</td>'+'<td id="kg_pwd" class="kg_value"><input type="password" maxlength="20" name="kg_pwdInput" id="kg_pwdInput" /> '+"</td>"+"</tr>"+"</table>"+"</div>",detailHTML:'<div class="kg_winDetail" id="kg_winDetail" style="width:320px;height:auto;" >'+'<div class="kg_module " id="kg_module" >'+'<div class="kg_tabs">'+"<ul>"+'<li class="kg_current kg_sign" id="kg_sign" ><a class=" kg_sign kg_tab_a" href="javascript:void(0);"><span>\u7b7e\u7ae0\u4fe1\u606f</span></a></li>'+'<li id="kg_cert" class ="kg_cert" ><a class="kg_a_cert kg_tab_a"  href="javascript:void(0);"><span>\u8bc1\u4e66\u4fe1\u606f</span></a></li>'+"</ul>"+"</div>"+"</div>"+'<div class="kg_module kg_content" id="kg_content">'+'<div class="kg_signDetail" id="kg_signDetail">'+'<table class="kg_table ">'+"<tr>"+'<td class="kg_field2">\u68c0\u6d4b\u7ed3\u679c\uff1a</td>'+'<td id="kg_signResult" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field2">\u5e94\u7528\u7a0b\u5e8f\uff1a</td>'+'<td id="kg_appName" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field2">\u6388\u6743\u5355\u4f4d\uff1a</td>'+'<td id="kg_unitName" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field2">\u7528\u6237\u540d\u79f0\uff1a</td>'+'<td id="kg_userName" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field2">\u7b7e\u7ae0\u540d\u79f0\uff1a</td>'+'<td id="kg_signName" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field2">\u7b7e\u7ae0\u5e8f\u53f7\uff1a</td>'+'<td id="kg_signSn" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field2">\u7b7e\u7ae0\u65f6\u95f4\uff1a</td>'+'<td id="kg_datetime" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field2">\u7b7e\u7ae0IP\uff1a</td>'+'<td id="kg_signatureIp" class="kg_value">'+"</td>"+"</tr>"+"</table>"+'<div class="kg_buttons">'+'<button class="kg_close" winId="kg_showDetailWin">\u5173\u95ed</button>'+'<button id="kg_removeSignature" class="kg_removeSignature"  winId="kg_showDetailWin" >\u5220\u9664\u7b7e\u7ae0</button>'+"</div>"+"</div>"+'<div class="kg_certDetail kg_none" id="kg_certDetail" >'+'<div id="kg_certTip" class="kg_none" style="text-align: center;height:60px;line-height:60px;">'+"</div>"+'<table class="kg_table " id="kg_certTable">'+"<tr>"+'<td class="kg_field">\u7248\u672c\uff1a</td>'+'<td id="kg_version" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field">\u9881\u53d1\u8005\uff1a</td>'+'<td id="kg_issuerName" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field">\u9881\u53d1\u7ed9\uff1a</td>'+'<td id="kg_subjectName" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field">\u5e8f\u5217\u53f7\uff1a</td>'+'<td id="kg_serialNumber" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field">\u7b7e\u540d\u7b97\u6cd5\uff1a</td>'+'<td id="kg_sigAlgName" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field">\u6709\u6548\u8d77\u59cb\u65e5\u671f\uff1a</td>'+'<td id="kg_notBefore" class="kg_value">'+"</td>"+"</tr>"+"<tr>"+'<td class="kg_field">\u6709\u6548\u7ec8\u6b62\u65e5\u671f\uff1a</td>'+'<td id="kg_notAfter" class="kg_value">'+"</td>"+"</tr>"+"</table>"+'<div class="kg_buttons">'+'<button  class="kg_close" winId="kg_showDetailWin" >\u5173\u95ed</button>'+'<button id="kg_signVerify" class="kg_signVerify" winId="kg_showDetailWin" >\u7b7e\u540d\u9a8c\u8bc1</button>'+'<button id="kg_certVerify" class="kg_certVerify" winId="kg_showDetailWin" >\u8bc1\u4e66\u9a8c\u8bc1</button>'+'<button id="kg_runCert"  class="kg_runCert" winId="kg_showDetailWin" >\u6570\u5b57\u7b7e\u540d</button>'+"</div>"+"</div>"+"</div>"+"</div>"};
}(window.jQuery,this,iSP));