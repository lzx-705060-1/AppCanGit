/*! >>> built at 2018-12-5 14:53:48 */
webpackJsonp([0],Array(200).concat([function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(276)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_formmain_vue__=__webpack_require__(239),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_formmain_vue__.a,null,!1,__vue_styles__,null,null);__webpack_exports__.default=Component.exports},,function(module,__webpack_exports__,__webpack_require__){"use strict";function _playFile(id,filePath,fileName,lastModified){cmp.dialog.loading("\u6587\u4ef6\u4e0b\u8f7d\u4e2d"),cmp.att.download({url:filePath,title:fileName,extData:{lastModified:lastModified,fileId:id,origin:cmp.origin},progress:function(result){},success:function(result){var localPath=result.target;localPath="file://"+localPath,cmp.dialog.loading(!1),cmp.audio.play({filepath:localPath,filename:fileName})},error:function(e){cmp.notification.alert(e,function(){cmp.dialog.loading(!1)},"\u63d0\u793a","\u786e\u5b9a")}})}__webpack_require__.d(__webpack_exports__,"z",function(){return URLS}),__webpack_require__.d(__webpack_exports__,"q",function(){return path}),__webpack_require__.d(__webpack_exports__,"b",function(){return ready}),__webpack_require__.d(__webpack_exports__,"n",function(){return zoom}),__webpack_require__.d(__webpack_exports__,"i",function(){return openFormSummary}),__webpack_require__.d(__webpack_exports__,"o",function(){return openExternalUrl}),__webpack_require__.d(__webpack_exports__,"j",function(){return openWebView}),__webpack_require__.d(__webpack_exports__,"f",function(){return closeWebView}),__webpack_require__.d(__webpack_exports__,"d",function(){return openLoading}),__webpack_require__.d(__webpack_exports__,"g",function(){return closeLoading}),__webpack_require__.d(__webpack_exports__,"e",function(){return dialog}),__webpack_require__.d(__webpack_exports__,"h",function(){return toast}),__webpack_require__.d(__webpack_exports__,"l",function(){return fireEvent}),__webpack_require__.d(__webpack_exports__,"k",function(){return ajax}),__webpack_require__.d(__webpack_exports__,"a",function(){return serverIp}),__webpack_require__.d(__webpack_exports__,"c",function(){return getParams}),__webpack_require__.d(__webpack_exports__,"m",function(){return getUrlParams}),__webpack_require__.d(__webpack_exports__,"v",function(){return dtPicker}),__webpack_require__.d(__webpack_exports__,"w",function(){return organize}),__webpack_require__.d(__webpack_exports__,"t",function(){return uploadImages}),__webpack_require__.d(__webpack_exports__,"u",function(){return uploadAttachment}),__webpack_require__.d(__webpack_exports__,"y",function(){return location}),__webpack_require__.d(__webpack_exports__,"x",function(){return showLocation}),__webpack_require__.d(__webpack_exports__,"r",function(){return imagesBrowser}),__webpack_require__.d(__webpack_exports__,"s",function(){return filesBrowser}),__webpack_require__.d(__webpack_exports__,"A",function(){return relationDoc}),__webpack_require__.d(__webpack_exports__,"B",function(){return mark}),__webpack_require__.d(__webpack_exports__,"C",function(){return photoLocation}),__webpack_require__.d(__webpack_exports__,"p",function(){return scanQRCode});var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__(44),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1__utils_tools_js__=__webpack_require__(211),SYMB="ios"===__WEBPACK_IMPORTED_MODULE_1__utils_tools_js__.a.systemType()||"iphoneX"===__WEBPACK_IMPORTED_MODULE_1__utils_tools_js__.a.systemType()?"":"?",RT_URL=cmp.platform.CMPShell?"http://cap4.v5.cmp/v1.0.0/htmls/origin/form/index.html"+SYMB+"#/":"/seeyon/m3/apps/v5/cap4/htmls/origin/form/index.html"+SYMB+"#/",CAP3_UNFLOW_FORM_URL=cmp.platform.CMPShell?"http://unflowform.v5.cmp/v1.0.0/html/info.html":"/seeyon/m3/apps/v5/unflowform/html/info.html",BASE_URL=RT_URL,FILE_URL="/seeyon/rest/attachment?token=&firstSave=true&applicationCategory=13&option.n_a_s=1",URLS={collaboration:cmp.platform.CMPShell?"http://collaboration.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/collaboration",meeting:cmp.platform.CMPShell?"http://meeting.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/meeting",edoc:cmp.platform.CMPShell?"http://edoc.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/edoc",news:cmp.platform.CMPShell?"http://news.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/news",bulletin:cmp.platform.CMPShell?"http://bulletin.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/bulletin",inquiry:cmp.platform.CMPShell?"http://inquiry.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/inquiry",bbs:cmp.platform.CMPShell?"http://bbs.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/bbs",doc:cmp.platform.CMPShell?"http://doc.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/doc"},path=(cmp.platform,{base:cmp.platform.CMPShell?"http://cap4.v5.cmp/v1.0.0":"/seeyon/m3/apps/v5/cap4"}),ready=function(handle){cmp.ready(handle)},zoom=function(el,options){return new IScroll(el,options)},openFormSummary=function(payload){var ignore=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(payload.summaryId){var url=URLS.collaboration+"/html/details/summary.html";return openWebView(url,payload,"all",ignore)}return"cap3"===payload.version?openWebView(CAP3_UNFLOW_FORM_URL,payload,"all",ignore):openWebView("formmain",payload,null,ignore)},openExternalUrl=function(url){var ignore=arguments.length>1&&void 0!==arguments[1]&&arguments[1],done=function(){cmp.platform.CMPShell?cmp.openWebView({url:url,useNativebanner:!0}):cmp.href.next(url)};if(ignore)return done();cmp.platform.CMPShell?cmp.event.trigger("beforeviewleave",document,{location:"store",done:done}):cmp.event.trigger("beforepageredirect",document,{location:"store",done:done})},openWebView=function(route,data,type){var ignore=arguments.length>3&&void 0!==arguments[3]&&arguments[3],url="all"===type?route:""+BASE_URL+route,done=function(){cmp.platform.CMPShell?cmp.href.next(url,data,{openWebViewCatch:1}):cmp.href.next(url,data)};if(ignore)return done();cmp.platform.CMPShell?cmp.event.trigger("beforeviewleave",document,{location:"store",done:done}):cmp.event.trigger("beforepageredirect",document,{location:"store",done:done})},closeWebView=function(){var data=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];data?setTimeout(function(){return cmp.href.back(!0===data?"":data)},30):cmp.href.back()},openLoading=function(params){cmp.dialog.loading(params)},closeLoading=function(){cmp.dialog.loading(!1)},dialog=function(params){switch(params.type){case"warning":cmp.notification.confirm(params.text,function(index){params.callback&&params.callback(index)},null,params.buttons,null,null,params.buttons.length-1);break;case"success":cmp.dialog.success(params.text,function(index){params.callback&&params.callback(index)},null,params.buttons,!0);break;case"prompt":cmp.notification.prompt(params.title,function(index,val){params.callback&&params.callback(index,val)},params.buttons,params.placeholder,params.defaultValue,params.subType,"notClose");break;case"alert":cmp.notification.alert(params.text,function(index){params.callback&&params.callback(index)},params.title,params.buttons,!0);break;case"close":cmp.notification.close({})}},toast=function(text,position,time,type){cmp.notification.toast(text,position,time,type)},fireEvent=function(params){cmp.webViewListener.fire(params)},ajax=function(params){cmp.ajax({type:params.type||"POST",data:__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(params.data),url:params.url.match(/seeyon/)?params.url:serverIp()+"/seeyon/"+params.url,timeout:params.timeout||"30000",dataType:"json",cmpReady2Fire:!0,fastAjax:!window.CMPREADYMARK,headers:{"Content-Type":"application/json; charset=utf-8","Accept-Language":"zh-CN",token:cmp.token||""},success:params.success,error:params.error})},serverIp=function(){return cmp.serverIp},getParams=function(){return cmp.href.getParam()},getUrlParams=function(){var result={},hrefArr=window.location.href.split("?");if(hrefArr.length>1){hrefArr[1].split("&").forEach(function(v){result[v.split("=")[0]]=v.split("=")[1]})}return result},dtPicker=function(params,callback){new cmp.DtPicker({value:params.value,beginYear:(new Date).getFullYear()-100,endYear:(new Date).getFullYear()+100,type:params.type}).show(function(rs){callback(rs.value)})},organize=function(params,extra){var id=params.recordId?params.id+"_"+params.recordId:params.id;cmp.selectOrg(id,{type:2,minSize:-1,maxSize:-1===params.type.indexOf("multi")?1:-1,selectType:-1===params.type.indexOf("multi")?params.type:params.type.substr(5,params.type.length),multitype:!1,lightOptsChange:!1,fillback:null,label:["dept","org","post","team","extP"],fillBackData:extra.fillBackData,excludeData:extra.excludeData,vj:!1,callback:function(result){extra.callback(JSON.parse(result).orgResult),cmp.selectOrgDestory(id)},closeCallback:function(){extra.closeCallback(),cmp.selectOrgDestory(id)}})},uploadImages=function(params,num,extra){cmp.dialog.actionSheet([{key:1,name:"\u62cd\u7167"},{key:2,name:"\u672c\u5730\u56fe\u7247"}],"\u53d6\u6d88",function(result){cmp.camera.getPictures({compress:!0,quality:100,targetWidth:-1,targetHeight:-1,saveToPhotoAlbum:!1,destinationType:1,sourceType:"1"===result.key?1:2,encodingType:0,pictureNum:num,success:function(cameraResult){var files=cameraResult.files,num=params.value.length;files.forEach(function(){params.uploadState.push(!1),params.value.push("")}),cmp.att.upload({url:""+serverIp()+FILE_URL,fileList:files,title:"",extData:"",success:function(ret){var data=JSON.parse(ret.response);extra.success(data.atts[0],num),num++},error:function(){extra.error()}})}})})},uploadAttachment=function(params,extra){var items=[{key:1,name:"\u62cd\u7167"},{key:2,name:"\u8bed\u97f3"},{key:3,name:"\u672c\u5730\u6587\u4ef6"},{key:4,name:"\u672c\u5730\u56fe\u7247"}];cmp.platform.CMPShell||items.splice(1,1),cmp.dialog.actionSheet(items,"\u53d6\u6d88",function(result){var type="";switch(result.key){case"1":type="photo";break;case"2":type="voice";break;case"3":type="localFile";break;case"4":type="picture"}cmp.att.suite({type:type,pictureNum:9,initDocData:null,maxFileSize:5242880,extData:{firstSave:!0},success:function(ret){var files={name:ret.att[0].filename,size:ret.att[0].size};extra.success(files,ret.att[0])},error:function(){extra.error()},cancel:function(){extra.cancel()}})},function(){})},location=function(params,extra){cmp.lbs.getLocationInfo({success:function(result){ajax({type:"POST",data:result,url:serverIp()+"/seeyon/rest/cmplbs/save",success:function(ret){extra.success(result,ret.value)},error:function(){}})},error:function(){extra.error()}})},showLocation=function(params){cmp.lbs.showLocationInfo({lbsUrl:serverIp()+"/seeyon/rest/cmplbs/"+params.valueId,success:function(result){}})},imagesBrowser=function(urls,index){var imgsObj=[];urls.forEach(function(v){imgsObj.push({small:v,big:v.split("&showType=small")[0]})}),cmp.sliders.addNew(imgsObj),cmp.sliders.detect(index)},_readFile=function(id,filePath,fileName,lastModified){cmp.dialog.loading(),cmp.att.read({path:filePath,filename:fileName,extData:{fileId:id,lastModified:lastModified,origin:cmp.origin},success:function(result){cmp.dialog.loading(!1)},error:function(e){cmp.dialog.loading(!1),cmp.notification.alert("\u6587\u4ef6\u4e0d\u5b58\u5728",function(){cmp.dialog.loading(!1)},"\u63d0\u793a","\u786e\u5b9a")}})},filesBrowser=function(params){console.log(params);var fileName=params.filename,fileId=params.fileId,lastModified=params.lastModified||params.createDate||params.createdate,suffix=fileName.substr(fileName.lastIndexOf(".")+1,fileName.length),suffixMap={wps:"doc",et:"xls"},downFileName="";if(fileName){downFileName=fileName;var dotIndex=downFileName.lastIndexOf(".");if(-1!=dotIndex){var pureName=downFileName.substring(0,dotIndex),fileSuffix=downFileName.substring(dotIndex+1);for(var subType in suffixMap)if(fileSuffix.toLowerCase()==subType){downFileName=pureName+"."+suffixMap[subType];break}}downFileName="?fileName="+downFileName}var filePath=cmp.origin+"/rest/attachment/file/"+fileId+downFileName;if(cmp.system.filePermission()){var items=[{key:"save",name:"\u4fdd\u5b58"}];cmp.att.canSee(suffix)&&items.unshift({key:"see",name:"\u67e5\u770b"}),cmp.dialog.actionSheet(items,"\u53d6\u6d88",function(item){"see"==item.key?(filePath=cmp.origin+"/rest/attachment/file/"+fileId+downFileName,cmp.att.canPlay(suffix)?_playFile(fileId,filePath,fileName,lastModified):_readFile(fileId,filePath,fileName,lastModified)):"save"==item.key&&(cmp.dialog.loading(),filePath=encodeURI(encodeURI(filePath)),cmp.att.download({url:filePath,title:fileName,extData:{lastModified:lastModified,fileId:fileId,origin:cmp.origin},progress:function(result){cmp.dialog.loading(!1)},success:function(result){var msg="";msg=/jpg|jpeg|bmp|png/gi.test(suffix)?"\u6587\u4ef6\u5df2\u4e0b\u8f7d\u5230\u624b\u673a\u76f8\u518c\uff0c\u8bf7\u5230\u76f8\u518c\u67e5\u770b":"\u6587\u4ef6\u5df2\u4e0b\u8f7d\u5230\u624b\u673a\uff0c\u8bf7\u5230\u79bb\u7ebf\u6587\u6863\u67e5\u770b",cmp.notification.alert(msg,function(){cmp.dialog.loading(!1)},"\u63d0\u793a","\u786e\u5b9a")},error:function(e){cmp.notification.alert("\u6587\u4ef6\u4e0d\u5b58\u5728",function(){cmp.dialog.loading(!1)},"\u63d0\u793a","\u786e\u5b9a")}}))},function(){})}else if(cmp.att.canDownload4Wechat(suffix)){var id=params.fileId,filePath="";filePath=cmp.origin+"/rest/attachment/file/"+id+downFileName,cmp.att.download({url:filePath,title:fileName})}else toast("\u5fae\u534f\u540c\u4e0d\u652f\u6301\u9644\u4ef6\u4e0b\u8f7d!","center",1500,0)},relationDoc=function(params,extra){var fillbackData=[],id=params.id+params.recordId||"";params.attachmentInfo.attachmentInfos.forEach(function(v){var tempFill={category:"1",createdate:v.createdate,description:v.description,extraMap:{},fileUrl:v.fileUrl,genesisId:v.genesisId,icon:"",id:v.id,mimeType:v.mimeType,new:!0,officeTransformEnable:"disable",remoteSource:"",size:"0",sort:v.sort,reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,type:v.mimeType,v:v.v};fillbackData.push(tempFill)}),cmp.accDoc(id,{fillbackData:fillbackData,callback:function(result){extra.success(JSON.parse(result))},closeCallback:function(){}})},mark=function(params,extra){cmp.lbs.markLocation({success:function(result){ajax({type:"POST",data:result,url:serverIp()+"/seeyon/rest/cmplbs/save",success:function(ret){extra.success(result,ret.value)},error:function(){}})},error:function(){extra.error()}})},photoLocation=function(params,extra){cmp.lbs.takePicture({userName:cmp.member.name,uploadPicUrl:""+serverIp()+FILE_URL,serverDateUrl:serverIp()+"/seeyon/rest/cmplbs/servertime",location:"",success:function(ret){ajax({type:"POST",data:ret,url:serverIp()+"/seeyon/rest/cmplbs/save",success:function(r){params.uploadState=[],params.value=[],params.uploadState.push(!1),params.value.push(null),extra.success(ret.listAttachment[0],ret.lbsAddr,r.value,0)},error:function(){}})},error:function(){extra.error()},cancel:function(){}})},scanQRCode=function(callback){if(!cmp.platform.CMPShell)return toast("\u5fae\u534f\u540c\u4e0d\u652f\u6301\u4e8c\u7ef4\u7801\u626b\u7801!","center",1500,0);cmp.barcode.scan({success:function(result){callback(null,result)},error:function(){console.log(err),"18005"!==String(err.code)&&callback({message:"barcode scan error!"})}})}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"f",function(){return registerHandler}),__webpack_require__.d(__webpack_exports__,"l",function(){return loadForm}),__webpack_require__.d(__webpack_exports__,"e",function(){return saveForm}),__webpack_require__.d(__webpack_exports__,"d",function(){return calculateForm}),__webpack_require__.d(__webpack_exports__,"c",function(){return mutateFormson}),__webpack_require__.d(__webpack_exports__,"a",function(){return fetchRelationList}),__webpack_require__.d(__webpack_exports__,"b",function(){return fetchRelationFillData}),__webpack_require__.d(__webpack_exports__,"j",function(){return mutateAttachment}),__webpack_require__.d(__webpack_exports__,"g",function(){return removeServerCache}),__webpack_require__.d(__webpack_exports__,"h",function(){return autoAggregate}),__webpack_require__.d(__webpack_exports__,"i",function(){return decodeBarCode}),__webpack_require__.d(__webpack_exports__,"k",function(){return getProtectedData});var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__(204),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_2__utils_index__=__webpack_require__(21),codeMap={2006:"\u60a8\u65e0\u6743\u9650\u64cd\u4f5c\uff0c\u8bf7\u8054\u7cfb\u5e94\u7528\u7ba1\u7406\u5458\uff01",2008:"\u6570\u636e\u72b6\u6001\u4e3a\u9501\u5b9a",2010:"\u5f53\u524d\u9875\u9762\u56e0\u4e3a\u957f\u65f6\u95f4\u672a\u64cd\u4f5c\uff0c\u7f13\u5b58\u5df2\u7ecf\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\uff01",2011:"\u8868\u5355\u6570\u636e\u5df2\u7ecf\u88ab\u5220\u9664"},handlers={},registerHandler=function(name,cb){handlers[name]=cb},sendHandler=function(name,payload){handlers[name]&&handlers[name](payload)},serviceCreator=function(options){var deferred=new __WEBPACK_IMPORTED_MODULE_2__utils_index__.c;return __WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.k(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},options,{success:function(response){var data=response.data;if(data&&data.code&&codeMap[data.code])return sendHandler("error",codeMap[data.code]);deferred.resolve(response)},error:function(err){return deferred.reject(err)}})),deferred},loadForm=function(data){return serviceCreator({url:"rest/cap4/form/createOrEdit",data:data})},saveForm=function(data){return serviceCreator({url:"rest/cap4/form/saveOrUpdate",data:data})},calculateForm=function(data){var deferred=new __WEBPACK_IMPORTED_MODULE_2__utils_index__.c;return serviceCreator({url:"rest/cap4/form/calculate",data:data}).then(function(response){var data=response.data;data&&"2000"!==data.code?(__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.e({type:"warning",title:"\u63d0\u793a\u4fe1\u606f",text:data.message||"unknow error",buttons:["\u786e\u5b9a"],callback:function(){}}),deferred.reject(response)):deferred.resolve(response)},function(err){return deferred.reject(err)}),deferred},mutateFormson=function(data){var deferred=new __WEBPACK_IMPORTED_MODULE_2__utils_index__.c;return serviceCreator({url:"rest/cap4/form/addOrDelDataSubBean",data:data}).then(function(response){var data=response.data;data&&"2000"!==data.code?(__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.e({type:"warning",title:"\u63d0\u793a\u4fe1\u606f",text:data.message||"unknow error",buttons:["\u786e\u5b9a"],callback:function(){}}),deferred.reject(response)):deferred.resolve(response)},function(err){return deferred.reject(err)}),deferred},fetchRelationList=function(data){return serviceCreator({url:"rest/cap4/form/getFormRelationDatas",data:data})},fetchRelationFillData=function(data){var deferred=new __WEBPACK_IMPORTED_MODULE_2__utils_index__.c;return serviceCreator({url:"rest/cap4/form/dealSelectedRelationData",data:data}).then(function(response){var data=response.data;data&&"2000"!==data.code?(__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.e({type:"warning",title:"\u63d0\u793a\u4fe1\u606f",text:data.message||"unknow error",buttons:["\u786e\u5b9a"],callback:function(){}}),deferred.reject(response)):deferred.resolve(response)},function(err){return deferred.reject(err)}),deferred},mutateAttachment=function(data){return serviceCreator({url:"rest/cap4/form/addOrDelAttachment",data:data})},removeServerCache=function(data){return serviceCreator({type:"GET",url:"rest/cap4/form/removeSessionFormCache/"+data})},autoAggregate=function(data){return serviceCreator({url:"rest/cap4/form/refreshSubData",data:data})},decodeBarCode=function(data){return serviceCreator({url:"rest/capBarcode/decodeBarCode",data:data})},getProtectedData=function(data){return serviceCreator({url:"rest/cap4/form/getiSignatureProtectedData",data:data})}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _assign=__webpack_require__(238),_assign2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_assign);exports.default=_assign2.default||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _from=__webpack_require__(225),_from2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_from);exports.default=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return(0,_from2.default)(arr)}},function(module,__webpack_exports__,__webpack_require__){"use strict";var fieldTypes={input:["text","number","textarea"],normal:["text","textarea","date","datetime","maplocate"],checkbox:["checkbox"],enums:["select","radio","imageradio","imageselect"],enumsRadio:["radio","imageradio"],file:["image","attachment","document","mapphoto"],organize:["member","multimember","post","multipost","department","multidepartment","account","multiaccount","level","multilevel"],auxiliary:["suiLogo","suiLabel","suiLineGap","suiStatic"],map:["maplocate","mapmarked","mapphoto"],flow:["flowdealoption"]};__webpack_exports__.a=fieldTypes},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__=__webpack_require__(202);__webpack_exports__.a=function(data){switch(data.inputType){case"image":data.attachmentInfo.attachmentInfos.length?("[object String]"===Object.prototype.toString.call(data.value)&&(data.value=[],data.uploadState=[]),data.attachmentInfo.attachmentInfos.forEach(function(v){var attachInfo={id:v.id,fileUrl:v.fileUrl,size:v.size,createdate:v.createdate,filename:v.filename},url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/fileUpload.do?method=showRTE&fileId="+attachInfo.fileUrl+"&createDate="+attachInfo.createdate+"&type=image&showType=small";data.value.push(url),data.uploadState.push(!0)})):(data.value=[],data.uploadState=[]);break;case"document":case"attachment":data.attachmentInfo.attachmentInfos.length?("[object String]"===Object.prototype.toString.call(data.value)&&(data.value=[]),data.attachmentInfo.attachmentInfos.forEach(function(v){var files={name:v.filename,size:v.size,type:v.mimeType};data.value.push(files)})):data.value=[];break;case"member":case"multimember":case"department":case"multidepartment":case"account":case"multiaccount":case"level":case"multilevel":case"post":case"multipost":if(data.valueId){var names=data.showValue,ids=data.valueId,result="";ids&&ids.split(",").forEach(function(v,index){var r=v;-1!==v.indexOf("|")&&(r=v.split("|")[0]),""!==result&&(result+=","),result+=r+"|"+names.split(",")[index]}),data.value=result}break;case"radio":case"select":case"imageradio":case"imageselect":data.value=data.valueId?data.valueId:data.value,data.enums.forEach(function(v){v.url&&-1===v.url.indexOf("http")&&(v.url=""+__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+v.url)});break;case"text":"DECIMAL"===data.fieldType&&data.valueId&&(data.value=data.valueId);break;case"mapmarked":data.value={text:data.showValue||"",url:""};break;case"mapphoto":data.attachmentInfo.attachmentInfos.length?("[object String]"===Object.prototype.toString.call(data.value)&&(data.value=[],data.uploadState=[]),data.attachmentInfo.attachmentInfos.forEach(function(v){var attachInfo={id:v.id,fileUrl:v.fileUrl,size:v.size,createdate:v.createdate,filename:v.filename,subReference:v.subReference},val={url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/fileUpload.do?method=showRTE&fileId="+attachInfo.fileUrl+"&createDate="+attachInfo.createdate+"&type=image&showType=small",location:data.showValue};data.value.push(val),data.uploadState.push(!0)})):(data.value=[],data.uploadState=[]);break;case"logo":data.attrs.src&&-1===data.attrs.src.indexOf("http")&&(data.attrs.src=""+__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+data.attrs.src);break;case"date":data.value&&data.value.includes(" ")&&(data.value=data.value.split(" ")[0],data.showValue=data.value);break;case"datetime":data.value&&(data.value.includes(" ")||-1!==data.value.indexOf("*")||(data.value+=" 00:00",data.showValue=data.value));break;case"flowdealoption":data.value&&data.value.includes("@signet_host@")&&(data.value=data.value.replace(/@signet_host@/g,__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon"),data.showValue=data.value)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_vue__=__webpack_require__(6);__webpack_exports__.a=new __WEBPACK_IMPORTED_MODULE_0_vue__.default},function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)(140)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={name:"footers",props:["type","bg","checked"],methods:{handleCheckAll:function(){this.$emit("toggleCheck",!this.checked)},saveFormData:function(type){this.$emit("saveFormData",type,!1)}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={systemType:function(){var u=navigator.userAgent,result=void 0;return u.indexOf("Android")>-1||u.indexOf("Adr")>-1?result="android":u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(result=u.includes("iPhoneX")?"iphoneX":"ios"),result},systemTime:function(){var date=new Date,dateArr=[date.getFullYear(),date.getMonth()+1,date.getDate(),date.getHours(),date.getMinutes()];return dateArr.forEach(function(v){v>0&&v<10&&(v="0"+v)}),dateArr[0]+"-"+dateArr[1]+"-"+dateArr[2]+" "+dateArr[3]+":"+dateArr[4]}}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _defineProperty=__webpack_require__(213),_defineProperty2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_defineProperty);exports.default=function(obj,key,value){return key in obj?(0,_defineProperty2.default)(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}},function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)(136)},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_slicedToArray__=__webpack_require__(209),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_slicedToArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_slicedToArray__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_2__business_utils_calculate_js__=__webpack_require__(221),__WEBPACK_IMPORTED_MODULE_3__assets_js_api__=__webpack_require__(43);__webpack_exports__.a={methods:{allFormCalculate:function(callback){var params={id:"",isInCalculate:"1"};this.calculate(params,0,callback)},calculate:function(params,extra,callback){var _this=this;if(callback||this.$nextTick(function(){return _this.refreshScroll()}),!this._skipCalculate){var payload={tableName:extra?extra.tableName:this.dbData.data.tableInfo.formmain.tableName,recordId:extra&&extra.recordId||"",isMaster:!extra,fieldInfo:params};if(console.log(payload),__WEBPACK_IMPORTED_MODULE_3__assets_js_api__.b.$emit("fieldChanged",payload),"1"===params.isInCalculate){extra=extra||{};var content=this.dbData.data.content,request={formMasterDataId:content.contentDataId,formId:content.contentTemplateId,rightId:content.rightId,fieldName:params.id,fromRecordId:extra.recordId||"",formSonTableName:extra.tableName||"",mergeData:this._buildSaveRequestParams("save",!0)};console.log("=== calculating ==="),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__business_utils_calculate_js__.a)(params,request,function(data){_this._manipulateForm(data.tableData),callback&&callback()})}}},analysisCalcResult:function(data){var _this2=this,_dbData=this.dbData,formmains=_dbData.formmains,formsons=_dbData.formsons;__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(data).forEach(function(v){var updated=data[v];if(-1===v.indexOf("_"))__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(formmains).forEach(function(val){var formmain=formmains[val];__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(formmains[val]).forEach(function(value){if(value===v){var field=formmain[value];field&&_this2._mergeToField(field,updated)}})});else{if(-1!==v.indexOf("formson"))return void __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(formsons).forEach(function(val){var formson=formsons[val];v===formson.tableName&&(formson.auth.add=updated.add,formson.auth.delete=updated.delete)});var _v$split=v.split("_"),_v$split2=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_slicedToArray___default()(_v$split,2),fname=_v$split2[0],recordId=_v$split2[1];__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(formsons).forEach(function(val){formsons[val].records.forEach(function(record){if(record&&record.recordId===recordId){var field=record.lists[fname];field&&_this2._mergeToField(field,updated)}})})}})},setCalculateLock:function(){var _this3=this;console.log(">>> locked calculate"),this._skipCalculate=!0,this.$nextTick(function(){_this3._skipCalculate=!1,console.log("unlocked calculate <<<")})}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_3__business_utils_special_js__=__webpack_require__(207),__WEBPACK_IMPORTED_MODULE_4__business_utils_service__=__webpack_require__(203);__webpack_exports__.a={methods:{copyFliterValue:function(fieldInfo,attachmentInfo){var isCustomField=fieldInfo.isCustomField,inputType=fieldInfo.inputType;(isCustomField||inputType.match(/^(flowdealoption|linenumber|document|attachment|image|maplocate|mapphoto|mapmarked)$/))&&(fieldInfo.value="",fieldInfo.valueId="",fieldInfo.showValue="",fieldInfo.attachmentInfo&&attachmentInfo&&(fieldInfo.attachmentInfo.attachmentInfos=[],fieldInfo.attachmentInfo.baseAttachmentInfo=attachmentInfo.baseAttachmentInfo,fieldInfo.value=[],fieldInfo.uploadState=[])),isCustomField&&(fieldInfo.customValue="")},getNewFormsonData:function(tbName,data,allDone,isAutoFill){var xform=this.dbData,rIds=[],relationParams={},toMasterDataIds={};data.forEach(function(v1){rIds.push(v1.newRecordId||""),v1.newRecordId&&(toMasterDataIds[v1.newRecordId]=v1.dataId,relationParams[v1.newRecordId]={},v1.relationData&&__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(v1.relationData).forEach(function(v2){relationParams[v1.newRecordId][v2]={value:v1.relationData[v2].value}}));var keyId=v1.newRecordId?v1.fromRelationAttr+"_"+v1.newRecordId:v1.fromRelationAttr,obj={keyId:keyId,fieldName:v1.fromRelationAttr,toMasterDataId:v1.dataId,toSubDataId:v1.subDataId,toFormId:v1.toFormId,formType:v1.toFormType,fromSubDataId:v1.newRecordId};xform.relationSelector[keyId]=obj});var _getFirstRecordId=this.getFirstRecordId(tbName,isAutoFill),firstRecordId=_getFirstRecordId.firstRecordId,firstIndex=_getFirstRecordId.firstIndex,_frontTableName=_getFirstRecordId._frontTableName;if(!_frontTableName)return allDone();var preRecordId=this.getPreRecordId(this.dbData.formsons[_frontTableName].records,this._relationParam.curIndexMap[_frontTableName]),params={preRecordId:preRecordId,firstRecordId:firstRecordId,formMasterId:xform.data.content.contentDataId,formId:xform.data.content.contentTemplateId,tableName:tbName,recordIds:rIds,type:"add",rightId:xform.data.content.rightId,relationParams:relationParams};this.createFormson(tbName,params,_frontTableName,firstIndex,allDone,isAutoFill,data)},getLastIndex:function(records){for(var index=0,i=0;i<records.length;i++)records[i]&&(index=i);return index+1},createFormson:function(tbName,params,_frontTableName,firstIndex,allDone,isAutoFill,relationData){var _this=this;__WEBPACK_IMPORTED_MODULE_4__business_utils_service__.c(params).then(function(result){var records=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.b)(!0,_this.dbData.formsons[_frontTableName].records),lastIndex=_this.getLastIndex(records),isDelNull=!1;result.data.data.forEach(function(value,count){var initData=_this.initFormSonFieldDatas(_frontTableName);initData.listsIndex.forEach(function(v){var recordItem=initData.lists[v];value.dataSubInfos[v]&&recordItem&&(recordItem.recordId=value.recordId,_this._mergeToField(recordItem,value.dataSubInfos[v]),_this.mixFormsonData(recordItem,relationData,v,value.recordId))}),initData.recordId=value.recordId;var data=_this.dbData.formsons[_frontTableName].records,isFirstNull=result.data.firstIsNull,recordData=initData,relationParams=_this._relationParam,curIndex=relationParams.curIndexMap[_frontTableName];if(void 0!==curIndex)data.splice(curIndex+1+count,0,recordData);else if(console.log("isFirstNull",isFirstNull,isDelNull,lastIndex),"1"!==isFirstNull)console.log("del first record:",firstIndex,recordData),data.splice(lastIndex+count,0,recordData);else{if(!isDelNull){var record=data.splice(firstIndex,1)[0];if(isDelNull=!0,record)for(var i in _this.dbData.relationSelector){var relation=_this.dbData.relationSelector[i];relation.fromSubDataId===record.recordId&&delete _this.dbData.relationSelector[i]}}data.splice(lastIndex+count-1,0,recordData)}}),isAutoFill?allDone&&allDone():_this.allFormCalculate(function(){allDone&&allDone()})},function(err){__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.h("\u64cd\u4f5c\u5931\u8d25","center",1500,0)})},mixFormsonData:function(recordItem,relationData,fieldId,recordId){for(var i=0;i<relationData.length;i++){var relationRecord=relationData[i].relationData;for(var j in relationRecord)fieldId==j&&relationData[i].newRecordId==recordId&&recordItem.recordId==relationData[i].newRecordId&&(console.log("merge",relationRecord[j].showValue),this._mergeToField(recordItem,relationRecord[j]),recordItem.relationData&&(recordItem.relationData.toMasterDataId=relationData[i].dataId))}},fillBackRelationValue:function(oldData,newData,index){return newData[index].relationDataList.forEach(function(v){oldData.lists[v]&&(oldData.lists[v].valueId=newData[index].relationData[v].value,oldData.lists[v].showValue=newData[index].relationData[v].showValue,oldData.lists[v].value=newData[index].relationData[v].showValue2,newData[index].relationData[v].attachmentInfo&&(oldData.lists[v].attachmentInfo=newData[index].relationData[v].attachmentInfo),newData[index].relationData[v].enums&&(oldData.lists[v].enums=newData[index].relationData[v].enums),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__business_utils_special_js__.a)(oldData.lists[v]))}),oldData},initFormSonFieldDatas:function(_frontTableName){return _frontTableName?__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.b)(!0,this.dbData.formsons[_frontTableName].templateRecord):this._isRelation?__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.b)(!0,this.dbData.formsons[this._relationParam.frontTableName].templateRecord):__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.b)(!0,this.dbData.formsons[this.frontTableName].templateRecord)},getFirstRecordId:function(tbName,isAutoFill){var _frontTableName=this._isRelation?this._relationParam.frontTableName:this.frontTableName;isAutoFill&&(_frontTableName=this.getFrontTbNameAndSetParams(tbName));for(var formson=this.dbData.formsons[_frontTableName],data=formson?formson.records:[],i=0;i<data.length;i++)if(data[i])return{firstRecordId:data[i].recordId,firstIndex:i,_frontTableName:_frontTableName};return{firstIndex:-1,firstRecordId:"",_frontTableName:_frontTableName}},getFrontTbNameAndSetParams:function(tbName){var formsonsData=this.dbData.formsons;for(var name in formsonsData)if(formsonsData[name].tableName==tbName)return this._relationParam.frontTableName=name,name;return""}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray__=__webpack_require__(205),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_2__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_3__business_utils_service__=__webpack_require__(203);__webpack_exports__.a={methods:{getFillRelationData:function(params){return __WEBPACK_IMPORTED_MODULE_3__business_utils_service__.b(params)},getRelationParams:function(params){var _dbData=this.dbData,formsons=_dbData.formsons,data=_dbData.data,_relationParam=this._relationParam,curIndexMap=(_relationParam.formType,_relationParam.frontTableName,_relationParam.curIndexMap),selectRecordIds={},payload={relationShipId:params.relationShipId,fromRightId:data.content.rightId,fromDataId:params.fromDataId,selectDatas:params.result,fromRecordId:params.fromRecordId,selectRecordIds:selectRecordIds};return __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(curIndexMap).forEach(function(name){var index=curIndexMap[name],formson=formsons[name];"number"!=typeof index&&(index="");var record=formson.records[index];record&&(selectRecordIds[formson.tableName]=record.recordId)}),payload},getLength:function(obj){var ccount=0;for(var i in obj)ccount++;return ccount},relationFillbackFormmain:function(params){var _this=this;console.log("relationFillbackFormmain",params);var deferred=new __WEBPACK_IMPORTED_MODULE_2__utils_index__.c;if(!params.result.length)return deferred.resolve(),deferred;var curIndexMap=this._relationParam.curIndexMap,pkg=this.getRelationParams(params);return this.getFillRelationData(pkg).then(function(res){var _res$data=res.data,data=(_res$data.code,_res$data.data);console.log(pkg),console.log(res),_this._manipulateForm(data.tableData,{record:function(action,payload){console.log([action,payload]);var table=payload.table,records=payload.records,frontTableName=table.frontTableName,activeIndex=curIndexMap[frontTableName],lastIndex=_this.getLastIndex(table.records);if("add"===action)if(console.log([activeIndex,lastIndex]),void 0===activeIndex){var _table$records;(_table$records=table.records).splice.apply(_table$records,[lastIndex,0].concat(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default()(records)))}else{var _table$records2;(_table$records2=table.records).splice.apply(_table$records2,[activeIndex+1,0].concat(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default()(records)))}}},function(){console.log("done")}),deferred.resolve()},function(err){console.log("error:",err)}),deferred},formsonToRelation:function(params,extra){var data=this.dbData,payload={title:"\u5173\u8054\u5217\u8868",type:"browse",formType:"formson",params:params,content:{formMasterId:data.data.content.contentDataId,formId:data.data.content.contentTemplateId,rightId:data.data.content.rightId},recordId:params.recordId,selectedMasterDataId:this.selectedMasterDataId,DBKey:this._buildStoreKey(),tbName:extra.tableName,frontTableName:extra.frontTableName,curIndex:extra.curIndex,curIndexMap:this.curIndexMap};this.dbData.formsonData=void 0,this.openWebView("relation",payload)},relationFillbackFormson:function(params){var _this2=this,deferred=new __WEBPACK_IMPORTED_MODULE_2__utils_index__.c,pkg=this.getRelationParams(params);return this.getFillRelationData(pkg).then(function(res){var _res$data2=res.data,data=(_res$data2.code,_res$data2.data);_this2._manipulateForm(data.tableData,{record:function(action,payload){console.log([action,payload])}}),deferred.resolve()}),deferred},getDBFormsonData:function(){for(var frontTableName=this._relationParam.frontTableName,recordId=this._relationParam.recordId,data=this.dbData.formsons[frontTableName].records,i=0;i<data.length;i++)if(data[i]&&data[i].recordId==recordId)return data[i]}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray__=__webpack_require__(209),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray__),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_3__business_utils_getSaveParams_js__=__webpack_require__(222),__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__=__webpack_require__(206),__WEBPACK_IMPORTED_MODULE_5__business_utils_service__=__webpack_require__(203),VALIDATE_CODE_MAP={2001:"",2004:"",2005:"",2006:"\u60a8\u65e0\u6743\u9650\u64cd\u4f5c\uff0c\u8bf7\u8054\u7cfb\u5e94\u7528\u7ba1\u7406\u5458\uff01",2007:"",2008:"\u6570\u636e\u72b6\u6001\u4e3a\u9501\u5b9a",2010:"\u5f53\u524d\u9875\u9762\u56e0\u4e3a\u957f\u65f6\u95f4\u672a\u64cd\u4f5c\uff0c\u7f13\u5b58\u5df2\u7ecf\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\uff01",2011:"\u8868\u5355\u6570\u636e\u5df2\u7ecf\u88ab\u5220\u9664"};__webpack_exports__.a={methods:{saveToServer:function(type,presubmit,callback,performer,moduleType,isReserved,contentOpts){var _this=this;if(this._isUnflow&&!presubmit){if(!this._validateFields())return}else if(performer&&"1"===performer.checkNull&&!this._validateFields(performer.failed))return;!presubmit&&this._isUnflow&&__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.d("\u4fdd\u5b58\u4e2d...");var pageParams=this.dbData.pageParams;pageParams.templateId&&"-1"===this.dbData.data.content.moduleTemplateId&&(this.dbData.data.content.moduleTemplateId=pageParams.templateId);var payload=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__business_utils_getSaveParams_js__.a)(pageParams.params.operateType,type,presubmit,performer,moduleType,this,contentOpts);__WEBPACK_IMPORTED_MODULE_5__business_utils_service__.e(payload).then(function(result){var _result$data=result.data,code=_result$data.code,data=_result$data.data;if("2000"===code){var snInfo=data.snInfo,foundSn=snInfo&&snInfo.length>0,messages=[];snInfo&&snInfo.forEach(function(item){messages.push("\u5df2\u5728"+item.display+"\u751f\u6210\u6d41\u6c34\u53f7:"+item.snmu)}),!presubmit&&_this._isUnflow&&_this.triggerListRefresh(),setTimeout(function(){presubmit?callback(payload):_this._isUnflow&&foundSn&&__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.e({type:"success",title:"\u63d0\u793a\u4fe1\u606f",text:messages.join(","),buttons:["\u786e\u5b9a"],callback:function(){"save"===type&&__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.f()}}),_this._isUnflow&&("save"!==type||!presubmit&&foundSn?"saveNew"===type?_this.loadFormData("saveNew",pageParams.params,0,!0):"saveCopy"===type&&(_this.dbData.data.content.contentDataId=data.formMasterId,_this.loadFormData("saveCopy",pageParams.params,0,!0)):isReserved?(__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),presubmit||__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.h("\u4fdd\u5b58\u6210\u529f","center",1500,1)):_this.closeWebView())},1e3),performer&&performer.success&&(data.snInfo=messages.length?messages.join("<br />"):"",data.isCAP4=!0,performer.success(data))}else{if(__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),("1"===payload.content.needCheckRule||"1"===payload.content.needDataUnique)&&(_this._validateData(result.data,type,!1,callback,performer),result.data&&result.data.data&&result.data.data.tableData)){var _data=result.data.data;_this._dropTableRecords(_data.clearTables),_this._manipulateForm(_data.tableData)}"2002"!==code&&performer&&performer.failed&&performer.failed()}},function(err){presubmit||(__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.h("\u4fdd\u5b58\u5931\u8d25","center",1500,0))})},_validateData:function(){for(var _this2=this,_len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var _args=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray___default()(args,5),result=_args[0],type=_args[1],isPrev=_args[2],callback=_args[3],performer=_args[4],buttonMap={cancel:"\u53d6\u6d88",sure:"\u786e\u5b9a",go:"\u7ee7\u7eed"},text="",buttons=[buttonMap.sure],fields=void 0,cb=function(){};if(!isPrev){if("2002"===result.code){var ret=JSON.parse(result.data.validateResult);text=ret.ruleError,fields=ret.fields,1===ret.forceCheck?cb=function(){return performer&&performer.failed()}:(buttons=[buttonMap.go,buttonMap.cancel],cb=function(index){0===index?_this2.saveToServer(type,isPrev,callback,performer,_this2.dbData.pageParams.params.moduleType,!1,{needCheckRule:"0"}):1===index&&performer&&performer.failed()})}else"2003"===result.code?(text=result.data.validateDataUnique.msg,fields=result.data.validateDataUnique.uniqueField):text="2009"===result.code?result.data[__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(result.data)[0]]:VALIDATE_CODE_MAP[result.code]||"";var invalidData=this._invalidateFields(fields),isInComment=location.href.indexOf("/details/comment.html")>-1;text&&__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.e({type:"warning",title:"",text:text,buttons:buttons,callback:function(index){isInComment?_this2.dbData.invalidation={type:invalidData.type,fieldName:invalidData.fieldName,tableName:invalidData.tableName}:_this2._consumeInvalidation(invalidData),cb(index)}})}},consumeInvalidation:function(invalidation){location.href.indexOf("/details/comment.html")>-1||this._consumeInvalidation(invalidation)},_consumeInvalidation:function(invalidation){var fieldName=invalidation.fieldName,type=invalidation.type,tableName=invalidation.tableName,table="formson"===type&&this.dbData.formsons[tableName],id="formain"===type?"master|"+fieldName:table.tableName+"|"+table.records[0].recordId+"|"+fieldName,el=document.getElementById(id);el&&this.scaleScroll.scrollToElement(el,300)},_validateFields:function(cb){var _dbData=this.dbData,formmains=_dbData.formmains,formsons=_dbData.formsons,win={title:"\u63d0\u793a\u6d88\u606f",sure:"\u786e\u5b9a",text:"\u4e0d\u80fd\u4e3a\u7a7a!"},result=!0,field=void 0;for(var p1 in formmains)if(formmains.hasOwnProperty(p1))for(var p2 in formmains[p1])if(formmains[p1].hasOwnProperty(p2)){var obj=formmains[p1][p2];if("1"===obj.isNotNull){if((obj.isAttachment||__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.file.includes(obj.inputType))&&0===obj.attachmentInfo.attachmentInfos.length){field=obj;break}if((__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.map.includes(obj.inputType)||__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.organize.includes(obj.inputType))&&""===obj.valueId){field=obj;break}if(__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.enumsRadio.includes(obj.inputType)&&"0"===obj.value){field=obj;break}if(!obj.value){field=obj;break}}}if(!field)for(var _p in formsons)if(formsons.hasOwnProperty(_p))for(var i=0,r=formsons[_p].records;i<r.length;++i){var record=formsons[_p].records[i];if(record)for(var _p2 in record.lists)if(record.lists.hasOwnProperty(_p2)){var _obj=record.lists[_p2];if("1"===_obj.isNotNull){if((_obj.isAttachment||__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.file.includes(_obj.inputType))&&0===_obj.attachmentInfo.attachmentInfos.length){field=_obj;break}if((__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.map.includes(_obj.inputType)||__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.organize.includes(_obj.inputType))&&""===_obj.valueId){field=_obj;break}if(__WEBPACK_IMPORTED_MODULE_4__business_utils_field_types_js__.a.enumsRadio.includes(_obj.inputType)&&"0"===_obj.value){field=_obj;break}if(!_obj.value){field=_obj;break}}}}return field&&(__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.e({type:"warning",title:win.title,text:""+field.display+win.text,buttons:[win.sure],callback:function(){return cb&&cb()}}),result=!1),result},_invalidateFields:function(fields){var _this3=this,_dbData2=this.dbData,formmains=_dbData2.formmains,formsons=_dbData2.formsons,mains=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formmains),subs=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formsons),invalid={isDataInvalid:"1"},masterFields=[],detailFields=[],result={};return fields.forEach(function(fieldName){for(var i=0,l=mains.length;i<l;++i){var formmain=formmains[mains[i]];if(formmain.hasOwnProperty(fieldName))return masterFields.push(fieldName),result.type||(result.type="formain",result.fieldName=fieldName,result.table=formmain),_this3._setField(formmain[fieldName],invalid)}for(var _i=0,_l=subs.length;_i<_l;++_i){var formson=formsons[subs[_i]];if(formson.fieldInfo.hasOwnProperty(fieldName))return detailFields.push(fieldName),result.type||(result.type="formson",result.fieldName=fieldName,result.tableName=formson.frontTableName,result.table=formson),formson.records.forEach(function(record){record&&_this3._setField(record.lists[fieldName],invalid)})}}),result},setFormsons:function(data){var formsons=this.dbData.formsons;return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formsons).some(function(v){if(formsons[v].tableName===data.tableName){var found={};return formsons[v].records.forEach(function(formson){found[formson.recordId]=!0}),found[data.fData.recordId]?formsons[v].records.some(function(vl){if(vl.recordId===data.fData.recordId)return vl.lists=data.fData.lists,!0}):formsons[v].records.push({recordId:data.fData.recordId,lists:data.fData.lists,listsIndex:data.fData.listsIndex}),!0}}),this.dbData},_buildSaveRequestParams:function(type,presubmit,performer){var _dbData$pageParams$pa=this.dbData.pageParams.params,operateType=_dbData$pageParams$pa.operateType,moduleType=_dbData$pageParams$pa.moduleType;return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__business_utils_getSaveParams_js__.a)(operateType,type,presubmit,performer,moduleType,this)},triggerListRefresh:function(){var params={type:this.type};"new"!==this.type&&(params.params=this.dbData.pageParams.params,params.formmainsData=this.dbData.formmains),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.l({type:"com.seeyon.m3.FormSaveSuccess",data:params})}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__business_utils_store__=__webpack_require__(223),__WEBPACK_IMPORTED_MODULE_1__business_mixins_store_manipulate__=__webpack_require__(220);__webpack_exports__.a={mixins:[__WEBPACK_IMPORTED_MODULE_1__business_mixins_store_manipulate__.a],methods:{saveToStore:function(opts){this._isFormmain&&this.saveIscrollRecord();var storeKey=this._buildStoreKey(opts),storeData=this._buildStoreData();return __WEBPACK_IMPORTED_MODULE_0__business_utils_store__.a.save(storeKey,storeData)},getFromStore:function(opts){var _this=this,consume=arguments.length>1&&void 0!==arguments[1]&&arguments[1],storeKey=this._buildStoreKey(opts);return __WEBPACK_IMPORTED_MODULE_0__business_utils_store__.a.get(storeKey,!0).then(function(data){return consume&&_this.clearFromStore(opts),{type:data.type,pageParams:data.pageParams,viewIndex:data.viewIndex,data:data.data,formmains:data.formmains,formsons:data.formsons,flowParam:data.flowParam,relationSelector:data.relationSelector,bSroll:data.bSroll,cFormSon:data.cFormSon,contentScrollState:data.contentScrollState,sentChangeViewEvent:data.sentChangeViewEvent,backupData:data.backupData,formsonData:data.formsonData,selection:data.selection,scrollY:data.scrollY,scrollX:data.scrollX,scrollScale:data.scrollScale,invalidation:data.invalidation}})},clearFromStore:function(opts){console.log("clearFromStore:");var storeKey=this._buildStoreKey(opts);return __WEBPACK_IMPORTED_MODULE_0__business_utils_store__.a.remove(storeKey)},_buildStoreKey:function(opts){if(this.DBKey)return this.DBKey;opts=opts||this._formainParam&&this._formainParam.params||this._formsonParam&&this._formsonParam.params||this._relationParam&&this._relationParam.params||this.dbData.pageParams.params;var _opts=opts;return _opts.moduleId+"_"+_opts.rightId+"_"+_opts.operateType},_buildStoreData:function(){var data=this.dbData;return{type:data.type,pageParams:data.pageParams,viewIndex:data.viewIndex,data:data.data,formmains:data.formmains,formsons:data.formsons,flowParam:data.flowParam,relationSelector:data.relationSelector,bSroll:data.bSroll,cFormSon:data.cFormSon,backupData:data.backupData,formsonData:data.formsonData,selection:data.selection,scrollY:data.scrollY,scrollX:data.scrollX,scrollScale:data.scrollScale,invalidation:data.invalidation}}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_2__business_utils_special__=__webpack_require__(207),__WEBPACK_IMPORTED_MODULE_3__business_utils_service__=__webpack_require__(203),__WEBPACK_IMPORTED_MODULE_4__utils_bridge__=__webpack_require__(202);__webpack_exports__.a={created:function(){var _this=this;__WEBPACK_IMPORTED_MODULE_3__business_utils_service__.f("error",function(reason){__WEBPACK_IMPORTED_MODULE_4__utils_bridge__.e({type:"warning",title:"\u63d0\u793a\u6d88\u606f",text:reason,buttons:["\u8fd4\u56de"],callback:function(){return _this._isFormmain?_this.closeWebView():_this._isFormson?_this.cancelSave():_this._isRelation?_this.closeWebView("back"):void cmp.href.back()}})})},methods:{getBaseStyles:function(defaultSkin){if(!defaultSkin)return{};if(this._baseInfo)return this._baseInfo;var defaultBg="",fBg="";return defaultSkin.view.bgUrl?(defaultBg=__WEBPACK_IMPORTED_MODULE_4__utils_bridge__.a()+"/seeyon/common/cap4/design/"+defaultSkin.view.bgUrl.substr(2,defaultSkin.view.bgUrl.length-2),fBg=-1===defaultSkin.view.bgUrl.indexOf("/seeyon")?defaultSkin.view.bgColor+" url("+defaultBg+") no-repeat center center":defaultSkin.view.bgColor+" url("+__WEBPACK_IMPORTED_MODULE_4__utils_bridge__.a()+defaultSkin.view.bgUrl+") no-repeat center center"):fBg=defaultSkin.view.bgColor,this._baseInfo={formHeaderBg:""+defaultSkin.head.backgroundColor,formHeaderColor:""+defaultSkin.head.color,formNavBg:defaultSkin.nav?""+defaultSkin.nav.backgroundColor:"",formFooterBg:defaultSkin.nav?""+defaultSkin.nav.backgroundColor:"",formFooterColor:"",formBg:fBg,fieldLine:"1px solid "+defaultSkin.divider.backgroundColor,fieldBg:""+defaultSkin.widget.box.backgroundColor,fieldTitleDefaultColor:""+defaultSkin.widget.label.color,fieldValueDefaultColor:""+defaultSkin.widget.body.color,isNotNullBg:""+defaultSkin.required.backgroundColor,placeholderColor:""+defaultSkin.widget.placeholder.color,formsonTiTleBorder:"1px solid "+defaultSkin.formson.head.borderColor,formsonArrowColor:""+defaultSkin.formson.arrow.color,formsonBg:""+defaultSkin.formson.snap.box.backgroundColor,formsonBorder:"1px solid "+defaultSkin.formson.snap.box.borderColor,formsonTitle:""+defaultSkin.formson.snap.label.color,formsonValue:""+defaultSkin.formson.snap.body.color}},getPreRecordId:function(data,index){for(void 0===index&&(index=data.length-1);index>-1;){if(data[index])return data[index].recordId;index--}return"-1"},_setField:function(field,data){return this._mergeToField(field,data)},_mergeToField:function(field,data){__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(data).forEach(function(fieldName){var value=data[fieldName];"value"===fieldName?field.valueId=value:"showValue2"===fieldName?field.value=value:"relationInfo"===fieldName?field.relation=value:"[object Object]"===toString.call(field[fieldName])?__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.a)(field[fieldName],value):field[fieldName]=value}),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__business_utils_special__.a)(field)},_getFormainField:function(fieldName){var formmains=this.dbData.formmains;return formmains[__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formmains)[0]][fieldName]||null},_getFormsonField:function(fieldName,tableName,recordId){var record=this._getRecordByTableAndId(tableName,recordId);return record?record.lists[fieldName]:null},_getFormsonByName:function(tableName){for(var formson,formsons=this.dbData.formsons,names=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formsons),i=0,l=names.length;i<l;++i)if(formson=formsons[names[i]],formson.tableName===tableName)return formson},_getRecordByTableAndId:function(tableName,recordId){for(var record,formson=this._getFormsonByName(tableName),records=formson.records,i=0,l=records.length;i<l;++i)if((record=records[i])&&record.recordId===recordId)return record},setRelationSelector:function(relationRecords){if(relationRecords&&relationRecords.length){var relationSelector=this.dbData.relationSelector;relationRecords.forEach(function(v){v.keyId=v.fieldName,v.fromSubDataId&&(v.keyId=v.fieldName+"_"+v.fromSubDataId),relationSelector[v.keyId]=v})}},_deleteRelation:function(keys){var relationSelector=this.dbData.relationSelector;Array.isArray(keys)||(keys=[keys]),keys.forEach(function(key){delete relationSelector[key]})},_deleteRelationByRecordId:function(recordId){var _this2=this;if(Array.isArray(recordId))return recordId.forEach(function(id){_this2._deleteRelationByRecordId(id)});var relationSelector=this.dbData.relationSelector,search="_"+recordId;__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(relationSelector).forEach(function(key){key.indexOf(search)>-1&&delete relationSelector[key]})},_buildRelationRightId:function(pcView,phoneView){return pcView=pcView||"",phoneView=phoneView||"","0"===pcView&&(pcView=""),"0"===phoneView&&(phoneView=""),pcView?phoneView?pcView+"_"+phoneView:pcView:phoneView}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof__=__webpack_require__(45),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_defineProperty__=__webpack_require__(212),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_defineProperty___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_defineProperty__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_toConsumableArray__=__webpack_require__(205),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_toConsumableArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_toConsumableArray__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_4__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_5__assets_js_api__=__webpack_require__(43);__webpack_exports__.a={methods:{_dropTableRecords:function(mutations){if(mutations&&!(!mutations.length>0)){var formsons=this.dbData.formsons;mutations.forEach(function(name){var formson=formsons[name];formson&&formson.records instanceof Array&&formson.records.splice(0)})}},_manipulateForm:function(mutations,plugin,callback){var _this=this,_dbData=this.dbData,formmains=_dbData.formmains,formsons=_dbData.formsons,formsonMap={};__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(formsons).forEach(function(name){var formson=formsons[name];formsonMap[formson.tableName]=formson}),plugin=plugin||{},__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(mutations||{}).forEach(function(name){var mutation=mutations[name];0===name.indexOf("formmain_")?_this._manipulateFormain(name,formmains[name],mutation,plugin):_this._manipulateFormson(name,formsonMap[name],mutation,plugin)}),callback&&callback(),__WEBPACK_IMPORTED_MODULE_5__assets_js_api__.b.$emit("updated"),this.setCalculateLock()},_manipulateFormain:function(tableName,table,mutation,plugin){var _this2=this;if(!table)return console.warn('formain "'+tableName+'" not found');var fieldPlugin=plugin.field;__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(mutation).forEach(function(action){if("update"===action){var fieldset=mutation[action];__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(fieldset).forEach(function(fieldName){var source=fieldset[fieldName];if("relationRecords"!==fieldName){var target=table[fieldName];if(!target||!source)return;_this2._setField(target,source),fieldPlugin&&fieldPlugin(target)}else _this2.setRelationSelector(source)})}})},_manipulateFormson:function(tableName,table,mutation,plugin){var _this3=this;if(!table)return console.warn('formson "'+tableName+'" not found');__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(mutation).forEach(function(action){var recordset=mutation[action];"add"===action?_this3._addRecord(table,recordset,plugin):"delete"===action?_this3._deleteRecord(table,recordset,plugin):"update"===action&&_this3._updateRecord(table,recordset,plugin)})},_addRecord:function(table,recordset,plugin){var _this4=this;Array.isArray(recordset)||(recordset=[recordset]);var recordPlugin=plugin.record,fieldPlugin=plugin.field,records=table.records,templateRecord=table.templateRecord,ignores=["recordId","relationRecords"],relations=[];recordset=recordset.map(function(fieldset){var record=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__utils_index__.b)(!0,templateRecord);return record.recordId=fieldset.recordId,__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(fieldset).forEach(function(name){if(!(ignores.indexOf(name)>-1)){var target=record.lists[name],source=fieldset[name];target&&source&&(target.recordId=record.recordId,_this4._setField(target,source),fieldPlugin&&fieldPlugin(target))}}),fieldset.relationRecords&&relations.push.apply(relations,__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_toConsumableArray___default()(fieldset.relationRecords)),record}),recordPlugin?recordPlugin("add",{table:table,records:recordset}):records.push.apply(records,__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_toConsumableArray___default()(recordset)),this.setRelationSelector(relations)},_deleteRecord:function(table,idsOrIndexes,plugin){var _this5=this,recordPlugin=plugin.record,records=table.records,deleted=[];if(Array.isArray(idsOrIndexes)||(idsOrIndexes=[idsOrIndexes]),"number"==typeof idsOrIndexes[0])idsOrIndexes.sort(function(a,b){return a>b?-1:1}),idsOrIndexes.forEach(function(index){var record=records[index];record&&(deleted.unshift(record),records.splice(index,1))});else for(var record,size=idsOrIndexes.length,i=0;size>0&&i<records.length;++i)(record=records[i])&&idsOrIndexes.indexOf(record.recordId)>-1&&(deleted.push(record),records.splice(i--,1),size--);deleted.forEach(function(record){_this5._deleteRelationByRecordId(record.recordId)}),recordPlugin&&recordPlugin("delete",{table:table,records:deleted})},_updateRecord:function(table,recordId,data,plugin){var _this6=this,records=table.records,ignores=["recordId","relationRecords"],recordMap={},updated=[],relations=[],recordset=void 0,recordPlugin=void 0,fieldPlugin=void 0;"string"==typeof recordId&&data?recordset=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_defineProperty___default()({},recordId,data):"object"===(void 0===recordId?"undefined":__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof___default()(recordId))&&recordId&&(recordset=recordId,plugin=data),recordPlugin=plugin.record,fieldPlugin=plugin.field,Array.isArray(recordset)&&(recordset=recordset.reduce(function(map,record){map[record.recordId]=record},{})),records.forEach(function(record){record&&(recordMap[record.recordId]=record)}),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(recordset).forEach(function(recordId){var fieldset=recordset[recordId],record=recordMap[recordId];record&&(updated.push(record),fieldset.relationRecords&&relations.push.apply(relations,__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_toConsumableArray___default()(fieldset.relationRecords)),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_object_keys___default()(fieldset).forEach(function(name){if(!(ignores.indexOf(name)>-1)){var target=record.lists[name],source=fieldset[name];target&&source&&(_this6._setField(target,source),fieldPlugin&&fieldPlugin(target))}}))}),recordPlugin&&recordPlugin("update",{table:table,records:updated}),this.setRelationSelector(relations)}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__=__webpack_require__(227),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator__=__webpack_require__(226),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator__),__WEBPACK_IMPORTED_MODULE_2__business_utils_service__=__webpack_require__(203),_this=this,calculate=function(){var _ref=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.mark(function _callee(data,request,callback){var ret;return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,__WEBPACK_IMPORTED_MODULE_2__business_utils_service__.d(request).then(function(result){return result.data.data});case 2:ret=_context.sent,callback(ret);case 4:case"end":return _context.stop()}},_callee,_this)}));return function(_x,_x2,_x3){return _ref.apply(this,arguments)}}();__webpack_exports__.a=calculate},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends__=__webpack_require__(204),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__=__webpack_require__(206),getSaveParams=function(operateType,type,isPrev,mainbodyArgs,moduleType,_this,contentOpts){var _this$dbData=_this.dbData,data=_this$dbData.data,formmains=_this$dbData.formmains,formsons=_this$dbData.formsons,relationSelector=_this$dbData.relationSelector,params={content:__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends___default()({},data.content),relationRecords:data.relationRecords,attachments:[],customFields:{}};switch(params.content.isMerge=isPrev?"1":"0",type){case"save":params.content.saveType="1";break;case"saveNew":params.content.saveType="2";break;case"saveCopy":params.content.saveType="3"}mainbodyArgs&&"saveAsTemplate"===mainbodyArgs.optType&&(params.content.saveType="4"),contentOpts&&(params.content=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends___default()({},params.content,contentOpts)),params[data.tableInfo.formmain.tableName]={},__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formmains[data.tableInfo.formmain.tableName]).forEach(function(v){if(-1===__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.auxiliary.indexOf(formmains[data.tableInfo.formmain.tableName][v].ctrlType)){params[data.tableInfo.formmain.tableName][v]=formmains[data.tableInfo.formmain.tableName][v].value||"";var obj=formmains[data.tableInfo.formmain.tableName][v];obj.isCustomField&&obj.hasOwnProperty("customValue")&&(params.customFields[obj.id]=obj.customValue||""),-1!==__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.file.indexOf(obj.inputType)||obj.attachmentInfo&&obj.attachmentInfo.attachmentInfos&&obj.attachmentInfo.attachmentInfos.length?(obj.attachmentInfo.attachmentInfos.length?(obj.attachmentInfo.attachmentInfos.forEach(function(val){var attach={reference:obj.attachmentInfo.baseAttachmentInfo.reference,category:obj.attachmentInfo.baseAttachmentInfo.category,mimeType:"document"!==obj.attachmentInfo.baseAttachmentInfo.mimeType?obj.attachmentInfo.baseAttachmentInfo.mimeType:val.mimeType,subReference:"mapphoto"!==obj.type?obj.attachmentInfo.baseAttachmentInfo.subReference:val.subReference,type:obj.attachmentInfo.baseAttachmentInfo.type,genesisId:val.genesisId,description:val.description,sort:val.sort,id:val.id,fileUrl:val.fileUrl,size:val.size,createdate:val.createdate,filename:val.filename};params.attachments.push(attach)}),"mapphoto"!==obj.type&&(obj.valueId=obj.attachmentInfo.baseAttachmentInfo.subReference)):obj.valueId="",params[data.tableInfo.formmain.tableName][v]=obj.valueId):-1!==__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.map.indexOf(obj.inputType)?params[data.tableInfo.formmain.tableName][v]=obj.valueId:-1!==__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.organize.indexOf(obj.inputType)?params[data.tableInfo.formmain.tableName][v]=obj.valueId:-1!==__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.flow.indexOf(obj.inputType)&&(params[data.tableInfo.formmain.tableName][v]=obj.valueId)}}),console.log("formsons"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formsons).forEach(function(v){params[formsons[v].tableName]=[],formsons[v].records.forEach(function(val){if(val){var tempObj={id:val.recordId},fsonLists=val.lists;for(var props in fsonLists)Object.prototype.hasOwnProperty.call(fsonLists,props)&&-1===__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.auxiliary.indexOf(fsonLists[props].ctrlType)&&function(){tempObj[props]=fsonLists[props].value||"";var obj=fsonLists[props];obj.isCustomField&&obj.hasOwnProperty("customValue")&&(params.customFields[props+"_"+val.recordId]=obj.customValue||""),obj.isAttachment?(obj.attachmentInfo.attachmentInfos.length?(obj.attachmentInfo.attachmentInfos.forEach(function(value){var attach={reference:obj.attachmentInfo.baseAttachmentInfo.reference,category:obj.attachmentInfo.baseAttachmentInfo.category,mimeType:"document"!==obj.attachmentInfo.baseAttachmentInfo.mimeType?obj.attachmentInfo.baseAttachmentInfo.mimeType:value.mimeType,subReference:"mapphoto"!==obj.type?obj.attachmentInfo.baseAttachmentInfo.subReference:value.subReference,type:obj.attachmentInfo.baseAttachmentInfo.type,genesisId:value.genesisId,description:value.description,sort:value.sort,id:value.id,fileUrl:value.fileUrl,size:value.size,createdate:value.createdate,filename:value.filename};params.attachments.push(attach)}),"mapphoto"!==obj.type&&(obj.valueId=obj.attachmentInfo.baseAttachmentInfo.subReference)):obj.valueId="",tempObj[props]=obj.valueId):-1!==__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.map.indexOf(obj.inputType)?tempObj[props]=obj.valueId:-1!==__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.organize.indexOf(obj.inputType)?tempObj[props]=obj.valueId:-1!==__WEBPACK_IMPORTED_MODULE_2__business_utils_field_types_js__.a.flow.indexOf(obj.inputType)&&(tempObj[props]=obj.valueId)}();params[formsons[v].tableName].push(tempObj)}})});for(var props in relationSelector)relationSelector.hasOwnProperty(props)&&function(){var rs=params.relationRecords,keyArr=[];if(rs.forEach(function(v){keyArr.push(v.keyId)}),-1===keyArr.indexOf(props))params.relationRecords.push(relationSelector[props]);else for(var i=0,l=rs.length;i<l;i++)if(rs[i].keyId===props){params.relationRecords.splice(i,1,relationSelector[props]);break}}();params.content.operateType=operateType;var formsonNumThreshold=_this.dbData.data.content.formsonNumThreshold;return console.log("formsonNumThreshold",formsonNumThreshold),formsonNumThreshold&&(params[data.tableInfo.formmain.tableName]={},__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formsons).forEach(function(v){params[formsons[v].tableName]=[]})),params};__webpack_exports__.a=getSaveParams},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__(44),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1__utils_index__=__webpack_require__(21),store={save:function(cacheKey,cacheData){var deferred=new __WEBPACK_IMPORTED_MODULE_1__utils_index__.c;return cacheData=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.b)(!0,cacheData),cmp.storageDB.save(cacheKey,cacheData,function(result){console.log("cache.save:",cacheKey,cacheData,result),result.success?deferred.resolve(result):deferred.reject()}),deferred},get:function(cacheKey){var deferred=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],new __WEBPACK_IMPORTED_MODULE_1__utils_index__.c);return cmp.storageDB.get(cacheKey,function(result){if(console.log("cache.get:",cacheKey,result),result.success&&result.data){if(!result.data)return deferred.reject();deferred.resolve(JSON.parse(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(result.data)))}else deferred.reject()}),deferred},remove:function(cacheKey){var deferred=new __WEBPACK_IMPORTED_MODULE_1__utils_index__.c;return cmp.storageDB.delete(cacheKey,function(result){console.log("cache.remove:done",cacheKey),result.success?deferred.resolve(result):deferred.reject()}),deferred}};__webpack_exports__.a=store},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",function(){return _on}),__webpack_require__.d(__webpack_exports__,"a",function(){return _emit});var __WEBPACK_IMPORTED_MODULE_0_vue__=__webpack_require__(6),hub=new __WEBPACK_IMPORTED_MODULE_0_vue__.default,_on=function(){var _arguments=arguments;return cmp.platform.CMPShell?(_on=function(evtName,handle){cmp.webViewListener.add({type:evtName}),document.addEventListener(evtName,handle)})(arguments[0],arguments[1]):(_on=function(){return hub.$on.apply(hub,_arguments)})(arguments)},_emit=function(){var _arguments2=arguments;return cmp.platform.CMPShell?(_emit=function(evtName,data){cmp.webViewListener.fire({type:evtName,data:data.data})})(arguments[0],arguments[1]):(_emit=function(){return hub.$emit.apply(hub,_arguments2)})(arguments)}},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(228),__esModule:!0}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _promise=__webpack_require__(46),_promise2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_promise);exports.default=function(fn){return function(){var gen=fn.apply(this,arguments);return new _promise2.default(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return _promise2.default.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}return step("next")})}}},function(module,exports,__webpack_require__){module.exports=__webpack_require__(232)},function(module,exports,__webpack_require__){__webpack_require__(23),__webpack_require__(230),module.exports=__webpack_require__(4).Array.from},function(module,exports,__webpack_require__){"use strict";var $defineProperty=__webpack_require__(8),createDesc=__webpack_require__(22);module.exports=function(object,index,value){index in object?$defineProperty.f(object,index,createDesc(0,value)):object[index]=value}},function(module,exports,__webpack_require__){"use strict";var ctx=__webpack_require__(10),$export=__webpack_require__(7),toObject=__webpack_require__(237),call=__webpack_require__(48),isArrayIter=__webpack_require__(47),toLength=__webpack_require__(51),createProperty=__webpack_require__(229),getIterFn=__webpack_require__(52);$export($export.S+$export.F*!__webpack_require__(49)(function(iter){Array.from(iter)}),"Array",{from:function(arrayLike){var length,result,step,iterator,O=toObject(arrayLike),C="function"==typeof this?this:Array,aLen=arguments.length,mapfn=aLen>1?arguments[1]:void 0,mapping=void 0!==mapfn,index=0,iterFn=getIterFn(O);if(mapping&&(mapfn=ctx(mapfn,aLen>2?arguments[2]:void 0,2)),void 0==iterFn||C==Array&&isArrayIter(iterFn))for(length=toLength(O.length),result=new C(length);length>index;index++)createProperty(result,index,mapping?mapfn(O[index],index):O[index]);else for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++)createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],!0):step.value);return result.length=index,result}})},function(module,exports){},function(module,exports,__webpack_require__){var g=function(){return this}()||Function("return this")(),hadRuntime=g.regeneratorRuntime&&Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime")>=0,oldRuntime=hadRuntime&&g.regeneratorRuntime;if(g.regeneratorRuntime=void 0,module.exports=__webpack_require__(50),hadRuntime)g.regeneratorRuntime=oldRuntime;else try{delete g.regeneratorRuntime}catch(e){g.regeneratorRuntime=void 0}},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(231)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_footers_vue__=__webpack_require__(210),__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_13_7_3_vue_loader_lib_template_compiler_index_id_data_v_56e17a2c_hasScoped_false_transformToRequire_video_src_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_template_index_0_footers_vue__=__webpack_require__(236),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_footers_vue__.a,__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_13_7_3_vue_loader_lib_template_compiler_index_id_data_v_56e17a2c_hasScoped_false_transformToRequire_video_src_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_template_index_0_footers_vue__.a,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(269)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_toolbar_vue__=__webpack_require__(247),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_toolbar_vue__.a,null,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(273)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_table_vue__=__webpack_require__(250),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_table_vue__.a,null,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return"new"===_vm.type||"edit"===_vm.type||"sure"===_vm.type||"sure-checkable"===_vm.type?_c("section",{staticClass:"cap4-footers",style:{background:_vm.bg}},["new"===_vm.type?_c("div",{staticClass:"cap4-footers__display is-justify"},[_c("div",{staticClass:"cap4-footers__btn",domProps:{textContent:_vm._s(_vm.$t("foot.saveNew"))},on:{tap:function($event){_vm.saveFormData("saveNew")}}}),_vm._v(" "),_c("div",{staticClass:"cap4-footers__btn",domProps:{textContent:_vm._s(_vm.$t("foot.saveCopy"))},on:{tap:function($event){_vm.saveFormData("saveCopy")}}}),_vm._v(" "),_c("div",{staticClass:"cap4-footers__btn",domProps:{textContent:_vm._s(_vm.$t("foot.save"))},on:{tap:function($event){_vm.saveFormData("save")}}})]):_vm._e(),_vm._v(" "),"edit"===_vm.type?_c("div",{staticClass:"cap4-footers__display is-alone"},[_c("div",{staticClass:"cap4-footers__btn",domProps:{textContent:_vm._s(_vm.$t("foot.save"))},on:{tap:function($event){_vm.saveFormData("save")}}})]):_vm._e(),_vm._v(" "),_vm.type.indexOf("sure")>-1?_c("div",{staticClass:"cap4-footers__display",class:"sure"===_vm.type?"is-alone":"is-alone-checkable"},["sure"!==_vm.type?_c("div",{staticClass:"cap4-footers__checker",on:{tap:_vm.handleCheckAll}},[_vm._v(_vm._s(_vm.checked?"\u53d6\u6d88\u5168\u9009":"\u5168\u9009"))]):_vm._e(),_vm._v(" "),_c("div",{staticClass:"cap4-footers__btn",domProps:{textContent:_vm._s(_vm.$t("foot.sure"))},on:{tap:function($event){_vm.saveFormData("sure")}}})]):_vm._e()]):_vm._e()},staticRenderFns=[],esExports={render:render,staticRenderFns:staticRenderFns};__webpack_exports__.a=esExports},function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)(22)},function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)(3)},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__(204),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_toConsumableArray__=__webpack_require__(205),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_toConsumableArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_toConsumableArray__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify__=__webpack_require__(44),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_defineProperty__=__webpack_require__(212),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_defineProperty___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_defineProperty__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_slicedToArray__=__webpack_require__(209),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_slicedToArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_slicedToArray__),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_6_vue__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_7_form_widget__=__webpack_require__(53),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__=__webpack_require__(208),__WEBPACK_IMPORTED_MODULE_9__components_navbar_navbar_vue__=__webpack_require__(280),__WEBPACK_IMPORTED_MODULE_10__components_footers_footers_vue__=__webpack_require__(233),__WEBPACK_IMPORTED_MODULE_11__components_formson_tablist_vue__=__webpack_require__(254),__WEBPACK_IMPORTED_MODULE_12__components_formson_toolbar_vue__=__webpack_require__(234),__WEBPACK_IMPORTED_MODULE_13__components_table_table_vue__=__webpack_require__(235),__WEBPACK_IMPORTED_MODULE_14__components_formson_tab_formson_vue__=__webpack_require__(278),__WEBPACK_IMPORTED_MODULE_15__components_formson_tile_formson_vue__=__webpack_require__(279),__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__=__webpack_require__(259),__WEBPACK_IMPORTED_MODULE_18__components_custom_custom_vue__=__webpack_require__(252),__WEBPACK_IMPORTED_MODULE_19__mixins_form_load__=__webpack_require__(256),__WEBPACK_IMPORTED_MODULE_20__mixins_form_store__=__webpack_require__(218),__WEBPACK_IMPORTED_MODULE_21__business_mixins_form_save__=__webpack_require__(217),__WEBPACK_IMPORTED_MODULE_22__business_mixins_form_calculate__=__webpack_require__(214),__WEBPACK_IMPORTED_MODULE_23__business_mixins_form_hub__=__webpack_require__(251),__WEBPACK_IMPORTED_MODULE_24__business_mixins_form_external__=__webpack_require__(255),__WEBPACK_IMPORTED_MODULE_25__business_mixins_form_formson__=__webpack_require__(215),__WEBPACK_IMPORTED_MODULE_26__business_mixins_formmain_event__=__webpack_require__(257),__WEBPACK_IMPORTED_MODULE_27__business_mixins_form_relation_js__=__webpack_require__(216),__WEBPACK_IMPORTED_MODULE_28__business_mixins_formson_operation_js__=__webpack_require__(258),__WEBPACK_IMPORTED_MODULE_29__business_mixins_form_util__=__webpack_require__(219),__WEBPACK_IMPORTED_MODULE_30__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_31__business_utils_service__=__webpack_require__(203),__WEBPACK_IMPORTED_MODULE_32__utils_tools_js__=__webpack_require__(211),__WEBPACK_IMPORTED_MODULE_33__assets_js_api__=__webpack_require__(43),__WEBPACK_IMPORTED_MODULE_34__utils_dragger_js__=__webpack_require__(263);__WEBPACK_IMPORTED_MODULE_6_vue__.default.use(__WEBPACK_IMPORTED_MODULE_7_form_widget__.default),__WEBPACK_IMPORTED_MODULE_6_vue__.default.use(__WEBPACK_IMPORTED_MODULE_7_form_widget__.Cap4Eg),__WEBPACK_IMPORTED_MODULE_6_vue__.default.use(__WEBPACK_IMPORTED_MODULE_7_form_widget__.Cap4SelectContentImage),__WEBPACK_IMPORTED_MODULE_6_vue__.default.use(__WEBPACK_IMPORTED_MODULE_7_form_widget__.Cap4SelectContent),__WEBPACK_IMPORTED_MODULE_6_vue__.default.use(__WEBPACK_IMPORTED_MODULE_7_form_widget__.Cap4BaseActionsheet),__WEBPACK_IMPORTED_MODULE_6_vue__.default.use(__WEBPACK_IMPORTED_MODULE_7_form_widget__.Cap4BaseBrowserSupport),__webpack_exports__.a={name:"FormBody",mixins:[__WEBPACK_IMPORTED_MODULE_19__mixins_form_load__.a,__WEBPACK_IMPORTED_MODULE_20__mixins_form_store__.a,__WEBPACK_IMPORTED_MODULE_21__business_mixins_form_save__.a,__WEBPACK_IMPORTED_MODULE_24__business_mixins_form_external__.a,__WEBPACK_IMPORTED_MODULE_25__business_mixins_form_formson__.a,__WEBPACK_IMPORTED_MODULE_22__business_mixins_form_calculate__.a,__WEBPACK_IMPORTED_MODULE_26__business_mixins_formmain_event__.a,__WEBPACK_IMPORTED_MODULE_23__business_mixins_form_hub__.a,__WEBPACK_IMPORTED_MODULE_28__business_mixins_formson_operation_js__.a,__WEBPACK_IMPORTED_MODULE_27__business_mixins_form_relation_js__.a,__WEBPACK_IMPORTED_MODULE_29__business_mixins_form_util__.a],components:{Navbar:__WEBPACK_IMPORTED_MODULE_9__components_navbar_navbar_vue__.a,BetterTablist:__WEBPACK_IMPORTED_MODULE_11__components_formson_tablist_vue__.a,BetterToolbar:__WEBPACK_IMPORTED_MODULE_12__components_formson_toolbar_vue__.a,BetterTable:__WEBPACK_IMPORTED_MODULE_13__components_table_table_vue__.a,BetterTabFormson:__WEBPACK_IMPORTED_MODULE_14__components_formson_tab_formson_vue__.a,Footers:__WEBPACK_IMPORTED_MODULE_10__components_footers_footers_vue__.a,CustomPrefix:__WEBPACK_IMPORTED_MODULE_18__components_custom_custom_vue__.a},directives:{dragger:__WEBPACK_IMPORTED_MODULE_34__utils_dragger_js__.a},data:function(){return{type:"",formStore:{},dbData:{data:{},formmains:{},formsons:{},flowParam:{},relationSelector:{},pageParams:{},viewIndex:"0",formsonData:null,formsonDisplay:"default",selection:{tab:"",records:{}}},printFlag:!1,isDataReady:!1,data:{},formmains:{},formsons:{},bSroll:null,cFormSon:"",contentScrollState:!0,sentChangeViewEvent:null,backupData:{copyMergeData:{},copyFormmains:{},copyFormsons:{}}}},computed:{currentFormData:function(){return{rawData:this.dbData.data,formmains:this.dbData.formmains,formsons:this.dbData.formsons}},currentFormMeta:function(){return{tableCategory:"formmain",tableName:__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_keys___default()(this.dbData.formmains)[0]}}},watch:{dbData:function(){var _this=this;this.$nextTick(function(){var isInitial=!_this._isInited;_this._isInited=!0,_this.initScaleScroll();var _dbData=_this.dbData,invalidation=_dbData.invalidation,isInComment=(_dbData.data,location.href.indexOf("/details/comment.html")>-1);_this.dbData.invalidation=null,console.log(invalidation),!isInComment&&invalidation&&setTimeout(function(){return _this.consumeInvalidation(invalidation)},100),isInitial&&(__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_33__assets_js_api__.c)(_this),_this.emitForm("rendered",{metadata:_this.dbData.data})),_this.emitForm("updated")}),!this._isFlow&&__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.b(function(){document.title=_this.dbData.data.formInfo.formName})}},created:function(){var _this2=this,query=__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.m()||{},forward=__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.c()||{},params=forward.params;this._isInited=!1,this._isFormmain=!0,this._isPreview=!!query.formId,this._isUnflow=!!params&&(!params.moduleType||"42"===params.moduleType),this._isFlow=!this._isUnflow,this._formainQuery=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_30__utils_index__.b)(!0,query),this._formainParam=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_30__utils_index__.b)(!0,forward),this._operateMap={0:"new",1:"edit",2:"browse"},this._skipCalculate=!1,this._mover={reposition:function(){if(void 0!==_this2._mover.vw&&_this2.$refs.formSwitcher){var _mover=__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_slicedToArray___default()(_this2._mover,2),x=_mover[0],y=_mover[1],vw=window.innerWidth,vh=window.innerHeight;_this2._mover.vw=vw,_this2._mover.vh=vh,_this2._mover.x=x=Math.min(x,vw-54),_this2._mover.y=x=Math.min(y,vh-54),_this2.$refs.formSwitcher.style.cssText="top:"+y+"px;left:"+x+"px"}}},this.dbData.pageParams=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_30__utils_index__.b)(!0,forward),this.curIndexMap={},window.xform=this},beforeUpdate:function(){console.time("[Patch]")},updated:function(){console.timeEnd("[Patch]")},mounted:function(){var _this3=this;this.browserSupport(),this.initFormmainEvent(),this.addEventListener(),this.loadForm(),cmp.event.orientationChange(function(){_this3._mover.reposition(),_this3.$refs.qrScan&&_this3.$refs.qrScan.reposition&&_this3.$refs.qrScan.reposition()})},destroyed:function(){this._mover.detachMove&&this._mover.detachMove(),this._mover.detachEnd&&this._mover.detachEnd()},render:function(){console.time("[Render]");var rendered=this.renderFrame();return console.timeEnd("[Render]"),rendered},methods:{refreshScroll:function(isCompareHei){var _this4=this;isCompareHei=void 0==isCompareHei||isCompareHei,clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(function(){var curScrollHeight=_this4.scrollDOM.offsetHeight;isCompareHei&&_this4.scrollHei==curScrollHeight||(_this4.scrollHei=curScrollHeight,setTimeout(function(){console.log("refreshScroll"),_this4.scaleScroll.refresh()},0))},300)},browserSupport:function(){return!!navigator.userAgent.includes("WebKit")||(this.$cap4BrowserSupport({text:"\u60a8\u7684\u6d4f\u89c8\u5668\u6682\u4e0d\u652f\u6301<br>\u5efa\u8bae\u5728Google Chrome\u6d4f\u89c8\u5668\u4e0b\u8bbf\u95ee"}),!1)},setStyles:function(type,arr){var result=void 0,w=0;switch(type){case"wrapper":if(!this.dbData.data.viewInfo)return;result={width:this.dbData.data.viewInfo.viewContent.styles.width+"px"};break;case"field":result={};break;case"table":arr.forEach(function(v){w+=Number(v)}),result={width:w+"px"};break;case"tableCon":if(!this.dbData.data.viewInfo)return;result={width:this.dbData.data.viewInfo.viewContent.styles.width+"px",overflow:"auto"}}return result},getBaseStyles:function(){return{}},changeView:function(id,index){var _this5=this,params=this.dbData.pageParams.params;__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.d("\u6570\u636e\u52a0\u8f7d\u4e2d..."),this.saveToServer("save",!0,function(){params.currentRightId=id,_this5.dbData.viewIndex=index,_this5.dbData.selection={tab:"",records:{}},_this5.dbData.scrollX=0,_this5.dbData.scrollY=0,_this5.dbData.scrollScale=0,_this5.loadFormData("init",params,function(){__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.g()},!0),_this5.sentChangeViewEvent&&_this5.sentChangeViewEvent({index:index})},null,params.moduleType,!0,{needCheckRule:"0",needDataUnique:"0",needSn:"0"})},removeSessionFormCache:function(state){var content=this.dbData.data.content,storeKey=this._buildStoreKey();if(sessionStorage.removeItem(storeKey),!content&&state)return __WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.f();var cb=function(){return state&&__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.f()};__WEBPACK_IMPORTED_MODULE_31__business_utils_service__.g(content.contentDataId).then(cb,cb)},initScaleScroll:function(){var _this6=this,formBodyDom=document.querySelectorAll(".cap4-formBody__index");if(0!=formBodyDom.length){var scale=formBodyDom[0].offsetWidth/document.getElementById("scrollWapper").offsetWidth;if(scale=scale>1?1:scale,isFinite(scale)){if(this.scrollDOM=document.getElementById("scrollWapper"),this.scaleScroll=__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.n(".cap4-formBody__wrapper",__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_defineProperty___default()({zoom:!0,scrollX:!0,scrollY:!0,disableTouch:!1,mouseWheel:!0,zoomMin:scale,wheelAction:!0,useTransition:!1,HWCompositing:!1,zoomMax:1,startZoom:scale,preventDefaultException:{tagName:/^(INPUT|SPAN|IMG|A|TEXTAREA|SELECT|BUTTON|I|B)$/}},"wheelAction","zoom")),this.dbData.scrollScale){var _dbData2=this.dbData,scrollX=_dbData2.scrollX,scrollY=_dbData2.scrollY,scrollScale=_dbData2.scrollScale;this.scaleScroll.zoom(scrollScale,scrollX,scrollY,0),this.scaleScroll.scrollTo(scrollX,scrollY,0)}else this.$nextTick(function(){return _this6.refreshScroll()});if(window.demoScroll=this.scaleScroll,this.scrollHei=document.getElementById("scrollWapper").offsetHeight,this.onDetailPageScroll){var _y=0,handleStart=function(e){_y=e.touches[0].pageY},handleMove=function(e){var curY=e.touches[0].pageY,directionY=curY-_y>0?-1:1;_this6.scaleScroll.y!=_this6.scaleScroll.maxScrollY&&_this6.scaleScroll.y!=_this6.scaleScroll.y||_this6.onDetailPageScroll(_y-curY,directionY)};this.scrollDOM.removeEventListener("touchstart",handleStart),this.scrollDOM.removeEventListener("touchmove",handleMove),this.scrollDOM.addEventListener("touchstart",handleStart),this.scrollDOM.addEventListener("touchmove",handleMove)}}}},saveIscrollRecord:function(){if(this.scaleScroll){var _scaleScroll=this.scaleScroll,x=_scaleScroll.x,y=_scaleScroll.y,scale=_scaleScroll.scale;this.dbData.scrollX=x,this.dbData.scrollY=y,this.dbData.scrollScale=scale}},initFormsonVisibleItem:function(){return{}},renderFrame:function(){var h=this.$createElement;return this._formsonTabInited=!1,this.isDataReady?h("section",{attrs:{id:"cap4Form"},class:"cap4-formBody__index",style:{background:"",backgroundSize:"cover"}},[this.renderHeader(),this.renderNavbar(),this.renderWrapper(),this.renderFooter(),this.renderQRCode()]):""},renderQRCode:function(){var h=this.$createElement;if(!this._isPreview&&this.dbData.data.content.allowQRScan)return h("div",{class:"icon CAP cap-icon-saoyisao form-qr-scan",ref:"qrScan",on:{tap:this.scanQRCode},directives:[{name:"dragger",value:!0}]})},renderHeader:function(){var h=this.$createElement;if(!(this._isPreview||this._isFlow||parseInt(this.dbData.data.viewInfo.phoneViewCount)<1))return h("div",{class:"icon CAP cap-icon-switch-light-form form-switcher",ref:"formSwitcher",on:{tap:this.switchForm,touchstart:this.onSwitcherTouch}})},renderNavbar:function(){var h=this.$createElement;if(this.dbData.data.views){if(this.dbData.data.views.length<=1)return"";var baseInfo=this.getBaseStyles();return h(__WEBPACK_IMPORTED_MODULE_9__components_navbar_navbar_vue__.a,{attrs:{indexParam:this.dbData.viewIndex,type:this.type,data:this.dbData.data.views,bg:baseInfo.formFooterBg,color:baseInfo.fieldTitleDefaultColor,border:baseInfo.fieldLine},on:{changeView:this.changeView}})}},renderWrapper:function(){var h=this.$createElement;return h("div",{class:"cap4-formBody__wrapper",ref:"wrapper",style:{overflow:"hidden"}},[h("div",{attrs:{id:"scrollWapper"}},[this.renderEg(),this.renderContainer()])])},renderEg:function(){var h=this.$createElement;if("1"===this.dbData.data.formInfo.isEg)return h("div",{class:"cap4-formBody__eg"},[h(__WEBPACK_IMPORTED_MODULE_7_form_widget__.Cap4Eg,{attrs:{fontSize:35,arrowSize:50,type:1}})])},renderContainer:function(){var _this7=this,h=this.$createElement,_dbData3=this.dbData,formmains=_dbData3.formmains,data=(_dbData3.pageParams,_dbData3.data),viewIndex=_dbData3.viewIndex,selection=_dbData3.selection,viewInfo=data.viewInfo,tableInfo=data.tableInfo,viewContent=viewInfo.viewContent,elements=viewContent.children||[];viewContent.repeatTableDisplay;return h("div",{attrs:{id:"cap4-zoom-wrapper"},class:"cap4-formBody__container"},[elements.map(function(item){if("ctrl"===item.nodeType)return _this7.renderLonly(item,formmains[tableInfo.formmain.tableName][item.id]);if("table"===item.nodeType){if(item.isMaster)return _this7.renderMainTable(item);var model="true"===_this7.printFlag?"default":_this7.dbData.data.viewInfo.viewContent.repeatTableDisplay;if("default"==model)return h(__WEBPACK_IMPORTED_MODULE_15__components_formson_tile_formson_vue__.a,{key:"view_"+viewIndex+"_"+item.tableName,attrs:{type:_this7.type,dbData:_this7.dbData,initTableName:item.tableName,initRecordIndex:-1},on:{selectRecord:_this7.handleSelectRecord}});if("tab"!=model||_this7._formsonTabInited)return;_this7._formsonTabInited=!0;var initTableName=selection.tab||item.tableName;return h(__WEBPACK_IMPORTED_MODULE_14__components_formson_tab_formson_vue__.a,{key:"view_"+viewIndex+"_"+item.tableName,attrs:{type:_this7.type,dbData:_this7.dbData,initTableName:initTableName,initRecordIndex:-1},on:{switchTab:_this7.handleSwitchTab,selectRecord:_this7.handleSelectRecord}})}})])},renderFooter:function(){var h=this.$createElement;if(this._isUnflow){var baseInfo=this.getBaseStyles();return h(__WEBPACK_IMPORTED_MODULE_10__components_footers_footers_vue__.a,{attrs:{type:this.type,bg:baseInfo.formNavBg},on:{saveFormData:this.saveToServer}})}},renderMainTable:function(item){var h=this.$createElement,dbData=this.dbData;return h(__WEBPACK_IMPORTED_MODULE_13__components_table_table_vue__.a,{attrs:{type:this.type,formStore:dbData,layout:item,binding:dbData.formmains[dbData.data.tableInfo.formmain.tableName]}})},renderLonly:function(item,data){return(0,this.$createElement)("div",{attrs:{id:"master|"+item.id},class:"cap4-formmain__lonly",style:{width:this.dbData.data.viewInfo.viewContent.styles.width+"px"}},[this.renderComponents(item,data)])},renderComponents:function(item,data){var h=this.$createElement;switch(item.ctrlType){case"suiStatic":return h("section",{style:data.extra},[h("pre",[data.display])]);case"suiLabel":return h("cap4-link",{attrs:{data:data},on:{linkEvent:this.linkUrl}});case"suiLogo":return h("cap4-link-image",{attrs:{data:data},on:{linkImageEvent:this.linkImageUrl,imageLoad:this.imageLoadEvent}});case"suiLineGap":return h("cap4-interval",{attrs:{data:data}});case"suiCustomControl":return h("custom-prefix",{attrs:{data:data,formdata:this.currentFormData,formDetails:this.currentFormMeta,formStore:this.dbData},on:{externalManipulateForm:this.externalManipulateFormEvent,externalCallApi:this.externalCallApiEvent,externalFillNormalField:this.externalFillNormalEvent,externalFillAttachField:this.externalFillAttachEvent}});default:switch(data.inputType){case"text":if("VARCHAR"===data.fieldType)return h("cap4-text",{attrs:{data:data},on:{inputFocus:this.inputFocusEvent,inputBlur:this.inputBlurEvent,calculate:this.calculateEvent,relation:this.relationEvent,linkEvent:this.linkUrl}});if("DECIMAL"===data.fieldType)return h("cap4-number",{attrs:{data:data},on:{inputFocus:this.inputFocusEvent,inputBlur:this.inputBlurEvent,calculate:this.calculateEvent,relation:this.relationEvent}});break;case"textarea":return h("cap4-textarea",{attrs:{data:data},on:{inputFocus:this.inputFocusEvent,inputBlur:this.inputBlurEvent,calculate:this.calculateEvent,relation:this.relationEvent,textAreaAddContent:this.textareaAppendEvent,linkEvent:this.linkUrl}});case"checkbox":return h("cap4-checkbox",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent}});case"radio":return h("cap4-radio",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent}});case"date":return h("cap4-date",{attrs:{"data-xx":"test",data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectTime:this.timeEvent}});case"datetime":return h("cap4-datetime",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectTime:this.timeEvent}});case"select":return h("cap4-select",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectEvent:this.selectEvent}});case"member":case"multimember":return h("cap4-choose-people",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"post":case"multipost":return h("cap4-choose-post",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"department":case"multidepartment":return h("cap4-choose-department",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"account":case"multiaccount":return h("cap4-choose-company",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"level":case"multilevel":return h("cap4-choose-duty",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"image":return h("cap4-images",{attrs:{data:data},on:{calculate:this.calculateEvent,imagesEvent:this.imagesEvent,imageLoad:this.imageLoadEvent}});case"attachment":return h("cap4-attachment",{attrs:{data:data},on:{calculate:this.calculateEvent,attachmentEvent:this.attachmentEvent}});case"maplocate":return h("cap4-location",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,locationEvent:__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.a}});case"mapphoto":return h("cap4-photo-location",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,photoEvent:this.photoEvent,imageLoad:this.imageLoadEvent}});case"mapmarked":return h("cap4-location-mark",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,markEvent:this.markEvent}});case"document":return h("cap4-relation-doc",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,documentEvent:this.documentEvent}});case"imageradio":return h("cap4-radio-image",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent}});case"imageselect":return h("cap4-select-image",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectImageEvent:this.selectImageEvent}});case"flowdealoption":return h("cap4-flow",{attrs:{data:data},on:{calculate:this.calculateEvent}})}}},onSwitcherTouch:function(e){var _this8=this,evt=e.changedTouches[0];e.preventDefault(),this._mover.x1=evt.clientX,this._mover.y1=evt.clientY,this._mover.vw=window.innerWidth,this._mover.vh=window.innerHeight,void 0===this._mover.x&&(this._mover.x=this._mover.vw-10-44,this._mover.y=60),this._mover.detachMove=this._nativeBind(document,"touchmove",function(e){var evt=e.changedTouches[0],dx=evt.clientX-_this8._mover.x1,dy=evt.clientY-_this8._mover.y1;if(e.preventDefault(),!_this8._mover.running){if(Math.sqrt(dx*dx+dy*dy)<5)return;_this8._mover.running=!0}var x=_this8._mover.x+dx,y=_this8._mover.y+dy;x=Math.min(x,_this8._mover.vw-54),y=Math.min(y,_this8._mover.vh-54),x=Math.max(10,x),y=Math.max(10,y),_this8._mover.x2=x,_this8._mover.y2=y,_this8.$refs.formSwitcher.style.cssText="top:"+y+"px;left:"+x+"px"}),this._mover.detachEnd=this._nativeBind(document,"touchend",function(e){_this8._mover.running&&(_this8._mover.x=_this8._mover.x2,_this8._mover.y=_this8._mover.y2,_this8._mover.running=!1),_this8._mover.detachMove(),_this8._mover.detachEnd(),_this8._mover.detachMove=_this8._mover.detachEnd=null})},_nativeBind:function(el,name,cb){return el.addEventListener(name,cb,!1),function(){return el.removeEventListener(name,cb,!1)}},handleKeyboardUp:function(){var _this9=this;this._keyboardTimer&&clearTimeout(this._keyboardTimer),this._keyboardTimer=setTimeout(function(){console.log("keyboard up"),_this9._keyboardTimer=null,_this9.refreshScroll(!1)},400)},handleKeyboardDown:function(){var _this10=this;this._keyboardTimer&&clearTimeout(this._keyboardTimer),this._keyboardTimer=setTimeout(function(){console.log("keyborad down"),_this10._keyboardTimer=null,_this10.refreshScroll(!1),_this10.$refs.wrapper.scrollTop=0,_this10.$refs.wrapper.scrollLeft=0},400)},addEventListener:function(){var _this11=this;__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("refreshScroll",function(){_this11.refreshScroll()}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("inputFocus",function(evt){_this11.handleKeyboardUp(evt)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("inputBlur",function(evt){_this11.handleKeyboardDown(evt)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("time",function(type,params){_this11.handleTimeEvent(type,params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("organize",function(type,params){_this11.handleOrganizeEvent(type,params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("images",function(type,params,index){_this11.handleImagesEvent(type,params,index)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("imageLoad",function(url,params){_this11.handleImageLoad(url,params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("attachments",function(type,params,index){_this11.handleAttachmentEvent(type,params,index)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("loaction",function(type,params){_this11.handleLocationEvent(type,params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("locationMark",function(type,params){_this11.handleMarkEvent(type,params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("photoLocation",function(type,params,index){_this11.handlePhotoLocation(type,params,index)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("relationDoc",function(type,params,index){_this11.handleDocumentEvent(type,params,index)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("linkUrl",function(params){_this11.handleLinkUrl(params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("linkImageUrl",function(params){_this11.handleLinkImageUrl(params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("formsonOpera",function(extra){_this11.formsonOpera(extra)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("textareaAppend",function(type,params){_this11.handleTextareaAppend(type,params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("imagesBrowser",function(urls,index){_this11.handleImagesBrowser(urls,index)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("filesBrowser",function(files,index){_this11.handleFilesBrowser(files,index)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("selectEvent",function(params){_this11.handleSelectEvent(params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("selectImageEvent",function(params){_this11.handleSelectImageEvent(params)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("calculate",function(params,extra){console.log("\u8ba1\u7b97\u516c\u5f0f",params,extra),_this11.calculate(params,extra)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("relation",function(type,params,extra){console.log("relation",type,JSON.parse(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify___default()(params)));var opts="string"==typeof type?{type:type}:type;_this11.relation(opts,params,extra)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("externalFillNormalEvent",function(payload,cb){_this11.handleExternalFillNormalField(payload,cb)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("externalFillAttachEvent",function(payload,cb){_this11.handleExternalFillAttachField(payload,cb)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("externalCallApiEvent",function(payload){_this11.handleExternalCallApi(payload)}),__WEBPACK_IMPORTED_MODULE_8__utils_eventBus__.a.$on("externalManipulateFormEvent",function(payload){_this11.handleExternalManipulateForm(payload)})},handleTimeEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.b(type,params)},handleOrganizeEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.c(type,params)},handleImagesEvent:function(type,params,index){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.d({type:type,params:params,index:index,formData:this.dbData.data})},handleImageLoad:function(url,params){this.refreshScroll()},handleAttachmentEvent:function(type,params,index){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.e({type:type,params:params,index:index,formData:this.dbData.data})},handleLocationEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.a(type,params)},handleMarkEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.f(type,params)},handlePhotoLocation:function(type,params,index){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.g({type:type,params:params,index:index,formData:this.dbData.data})},handleDocumentEvent:function(type,params,index){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.h({type:type,params:params,index:index,formData:this.dbData.data})},handleLinkUrl:function(params){var _params$attrs=params.attrs,linkable=_params$attrs.linkable,linkUrl=_params$attrs.linkUrl;linkable&&linkUrl&&__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.o(linkUrl)},handleLinkImageUrl:function(params){this.handleLinkUrl(params)},handleTextareaAppend:function(params){var that=this,currentUser=this.dbData.data.user?this.dbData.data.user.name:"",currentTime=function(){return __WEBPACK_IMPORTED_MODULE_32__utils_tools_js__.a.systemTime()},base="["+currentUser+" "+currentTime()+"]";__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"prompt",subType:4,title:"\u8bf7\u8f93\u5165\u60a8\u8981\u8ffd\u52a0\u7684\u5185\u5bb9",placeholder:"",defaultValue:"",buttons:["\u53d6\u6d88","\u786e\u5b9a"],callback:function(index,val){if(1===index){var baseSize=base.length,maxLength=Number(params.fieldLength)-params.value.length-baseSize,obj={type:"correct",data:val};"LONGTEXT"!==params.fieldType&&(maxLength<=0?(obj.type="error_01",obj.data="\u8d85\u8fc7\u5b57\u6bb5\u6700\u5927\u957f\u5ea6\uff0c\u5df2\u7ecf\u65e0\u6cd5\u7ee7\u7eed\u8ffd\u52a0\u6587\u5b57\u4e86\uff01"):val.length>maxLength&&(obj.type="error_02",obj.data="\u8ffd\u52a0\u6587\u672c\u6700\u5927\u957f\u5ea6\uff1a"+3*maxLength+"\uff01\uff08\u4e2d\u82f1\u6587\u3001\u6570\u5b57\u5b57\u7b26\u90fd\u5360\u636e\u4e09\u4e2a\u5b57\u7b26\u7684\u957f\u5ea6\uff09")),"error_01"===obj.type||"error_02"===obj.type?__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"alert",title:"\u63d0\u793a\u6d88\u606f",text:obj.data,buttons:["\u786e\u5b9a"]}):(__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"close"}),""!==params.value&&(params.value+="\r\n"),params.value+=obj.data+"\r\n\t["+currentUser+" "+currentTime()+"]",params.value=params.value.replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,""),that.refreshScroll())}else __WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"close"})}})},handleImagesBrowser:function(urls,index){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.i(urls,index)},handleFilesBrowser:function(files,index){__WEBPACK_IMPORTED_MODULE_17__business_utils_native_js__.j(files,index)},relation:function(opts,params,extra){var _this12=this,DBKey=this._buildStoreKey(),type=opts.type,throughType=opts.throughType,content=this.dbData.data.content;if(console.log("relation",type,params),"formAggregate"===type){var msg="3"===params.param.type?"\u60a8\u786e\u8ba4\u8981"+params.param.buttonName+"\u5f53\u524d\u660e\u7ec6\u8868\u5417\uff1f":params.param.buttonName+"\u5c06\u5220\u9664\u660e\u7ec6\u8868"+params.tableDisplay+"\u7684\u6570\u636e\u5e76\u91cd\u65b0\u586b\u5165\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u7ee7\u7eed\uff1f";return void __WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"warning",title:"\u63d0\u793a\u6d88\u606f",text:msg,buttons:["\u53d6\u6d88","\u786e\u5b9a"],callback:function(index){if(1===index){var request={relationShipId:params.param.relationShipId,formMasterId:content.contentDataId,formId:content.contentTemplateId,rightId:content.rightId,mergeData:_this12._buildSaveRequestParams("save",!0)};__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.d("\u5904\u7406\u4e2d..."),__WEBPACK_IMPORTED_MODULE_31__business_utils_service__.h(request).then(function(res){__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.g();var _res$data=res.data,data=(_res$data.code,_res$data.data);data&&_this12._manipulateForm(data.tableData,{record:function(action,payload){var table=payload.table,records=payload.records;if("add"===action){var _table$records;table.records.splice(0),(_table$records=table.records).push.apply(_table$records,__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_toConsumableArray___default()(records))}}})},function(err){__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u64cd\u4f5c\u5931\u8d25","center",1500,0)})}}})}if("formInsert"!==type){if("formson"==params.formType&&params.recordId){if("icon"===type)if(params.relation.mainSelector){var _relationSelector=this.dbData.relationSelector[params.relation.mainSelector],_mainName="";if(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_keys___default()(this.dbData.formmains).forEach(function(m){_mainName=_this12.dbData.formmains[m][params.relation.mainSelector]?_this12.dbData.formmains[m][params.relation.mainSelector].display:params.relation.mainSelectorDisplay}),!_relationSelector)return void __WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u8bf7\u5148\u9009\u62e9"+_mainName+"\uff01","center",1500,0);this.selectedMasterDataId=_relationSelector.toMasterDataId,this.selectedMasterDataId?(console.log("formsonToRelation",params),this.formsonToRelation(params,extra)):__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u8bf7\u5148\u9009\u62e9"+_mainName+"\uff01","center",1500,0)}else console.log("formsonToRelation",params),this.formsonToRelation(params,extra);else if("value"===type){var id=params.id,recordId=params.recordId,relation=params.relation,relationData=params.relationData,triggerData=params.triggerData,pid=recordId?id+"_"+recordId:id,rightId=void 0,moduleId=void 0,moduleType=void 0,payload=void 0;"relation"===throughType?(rightId="default_form_cap3"===relation.toVersion?relation.pcView:this._buildRelationRightId(relation.pcView,relation.phoneView),moduleId=relationData.toMasterDataId||this.dbData.relationSelector[pid].toMasterDataId,moduleType="6"===relation.toFormType?"42":relation.toFormType):"trigger"===throughType&&(rightId=this._buildRelationRightId(triggerData.pcView,triggerData.phoneView),moduleId=triggerData.toMasterDataId,moduleType="6"===triggerData.toFormType?"42":triggerData.toFormType),"1"===moduleType?(payload={summaryId:moduleId,operationId:rightId,openFrom:"formRelation"},window.summaryBO&&window.summaryBO.summary&&(payload.baseObjectId=window.summaryBO.summary.id,payload.baseApp="1")):payload="default_form_cap3"===relation.toVersion?{rightId:rightId,moduleType:moduleType,moduleId:moduleId,contentAllId:moduleId,showType:"browse",viewState:"2",version:"cap3"}:{formType:"formmain",type:"browse",params:{rightId:rightId,moduleId:moduleId,moduleType:moduleType,operateType:"2"}},moduleType?__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.i(payload):__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"warning",title:"",text:"\u8be5\u6761\u6570\u636e\u88ab\u5220\u9664",buttons:["\u786e\u5b9a"]})}}else if("icon"===type){var data={title:"\u5173\u8054\u5217\u8868",type:"browse",formType:"formmain",params:params,content:this.dbData.data.content,mergeData:this._buildSaveRequestParams("save",!0),DBKey:DBKey,curIndexMap:this.curIndexMap};this.openWebView("relation",data)}else if("value"===type){var _id=params.id,_relation=params.relation,_relationData=params.relationData,_triggerData=params.triggerData,_rightId=void 0,_moduleId=void 0,_moduleType=void 0,_payload=void 0;"relation"===throughType?(_rightId="default_form_cap3"===_relation.toVersion?_relation.pcView:this._buildRelationRightId(_relation.pcView,_relation.phoneView),_moduleId=_relationData.toMasterDataId||this.dbData.relationSelector[_id].toMasterDataId,_moduleType="6"===_relation.toFormType?"42":_relation.toFormType):"trigger"===throughType&&(_rightId=this._buildRelationRightId(_triggerData.pcView,_triggerData.phoneView),_moduleId=_triggerData.toMasterDataId,_moduleType="6"===_triggerData.toFormType?"42":_triggerData.toFormType),"1"===_moduleType?(_payload={summaryId:_moduleId,operationId:_rightId,openFrom:"formRelation"},window.summaryBO&&window.summaryBO.summary&&(_payload.baseObjectId=window.summaryBO.summary.id,_payload.baseApp="1")):_payload="default_form_cap3"===_relation.toVersion?{rightId:_rightId,moduleType:_moduleType,moduleId:_moduleId,contentAllId:_moduleId,showType:"browse",viewState:"2",version:"cap3"}:{formType:"formmain",type:"browse",params:{rightId:_rightId,moduleId:_moduleId,moduleType:_moduleType,operateType:"2"}},_moduleType?__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.i(_payload):__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"warning",title:"",text:"\u8be5\u6761\u6570\u636e\u88ab\u5220\u9664",buttons:["\u786e\u5b9a"]})}}else{var fieldInfo=params.fieldInfo;if(fieldInfo.relationInfo.mainSelector){var relationSelector=this.dbData.relationSelector[fieldInfo.relationInfo.mainSelector],mainName=fieldInfo.relationInfo.mainSelectorDisplay;if(!relationSelector)return void __WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u8bf7\u5148\u9009\u62e9"+mainName+"\uff01","center",1500,0);var selectedMasterDataId=relationSelector.toMasterDataId;selectedMasterDataId?this.openWebView("relation",{title:"\u5173\u8054\u5217\u8868",type:"browse",formType:"formInsert",params:fieldInfo,content:this.dbData.data.content,tbName:params.tableName,frontTableName:extra.frontTableName,selectedMasterDataId:selectedMasterDataId,DBKey:this._buildStoreKey(),curIndex:extra.curIndex,curIndexMap:this.curIndexMap}):__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u8bf7\u5148\u9009\u62e9"+mainName+"\uff01","center",1500,0)}else this.openWebView("relation",{title:"\u5173\u8054\u5217\u8868",type:"browse",formType:"formInsert",params:fieldInfo,content:this.dbData.data.content,tbName:params.tableName,frontTableName:extra.frontTableName,DBKey:this._buildStoreKey(),curIndex:extra.curIndex,curIndexMap:this.curIndexMap})}},handleSelectImageEvent:function(params){var _this13=this;this.contentScrollState=!1;var sI=this.$cap4Selection({type:params.attrs.imgEnumFormat,data:params.enums,value:params.value,callback:function(type,result){if("complete"===type){if(!result)return sI.close(),void(_this13.contentScrollState=!0);params.value=result.id}sI.close(),_this13.contentScrollState=!0}})},handleSelectEvent:function(params){var _this14=this;this.contentScrollState=!1;var sI=this.$cap4Select({data:params.enums,value:params.value,callback:function(type,result){if("complete"===type){if(!result)return sI.close(),void(_this14.contentScrollState=!0);params.value=result.id}sI.close(),_this14.contentScrollState=!0}})},showListButton:function(data){var _this15=this,buttons=["\u590d\u5236\u5f53\u524d\u884c","\u5220\u9664\u5f53\u524d\u884c","\u5220\u9664\u5168\u90e8"];"0"===data.auth.add&&"1"===data.auth.delete?buttons=["\u5220\u9664\u5f53\u524d\u884c","\u5220\u9664\u5168\u90e8"]:"1"===data.auth.add&&"0"===data.auth.delete&&(buttons=["\u590d\u5236\u5f53\u524d\u884c"]),this.contentScrollState=!1;var action=this.$cap4Actionsheet({title:"",buttons:buttons,callback:function(index){if("0"===data.auth.add&&"1"===data.auth.delete);else if("1"===data.auth.add&&"0"===data.auth.delete)0===index&&_this15.copyFormson(data);else switch(index){case 0:_this15.copyFormson(data);break;case 1:_this15.deleteFormson(data);break;case 2:_this15.deleteAllFormson(data)}action.close(),_this15.contentScrollState=!0}})},handleSwitchTab:function(tableName){var _this16=this,selection=this.dbData.selection;selection.tab=tableName,selection.records={},this.$nextTick(function(){return _this16.refreshScroll(!1)})},handleSelectRecord:function(tableName,recordIndex){var _dbData4=this.dbData,formsonDisplay=_dbData4.formsonDisplay,selection=_dbData4.selection;selection.tab="default"===formsonDisplay?"":tableName,selection.records[tableName]=recordIndex},formsonEvent:function(params){switch(console.log("formsonEvent",params),params.type){case"showListButton":this.showListButton(params.params);break;case"toScrollElement":this.toScrollElement(params.tableName);break;case"switch":case"addMore":break;case"imagesBrowser":this.imagesBrowserEvent(params.urls,0);break;case"new":this.addFormson(params.tableName,params.fieldInfo);break;case"view":this.viewFormson(params.recordId,params.tableName,params.lists,params.listsIndex,params.auth)}},addFormson:function(tbName,fieldInfo){var _this17=this,relations=[],tempArr=[];for(var props in fieldInfo)fieldInfo.hasOwnProperty(props)&&fieldInfo[props].relationInfo&&"1"===fieldInfo[props].relationInfo.fillInRow&&(relations.push(fieldInfo),tempArr.unshift({name:"insert",showName:"\u63d2\u5165"+fieldInfo[props].display,tbName:tbName,fieldInfo:fieldInfo[props]}));if(relations.length){var params={state:!0,data:[{name:"new",showName:"\u65b0\u5efa\u660e\u7ec6",tbName:tbName}].concat(tempArr)},buttons=[];params.data.forEach(function(v){buttons.push(v.showName)}),this.contentScrollState=!1;var action=this.$cap4Actionsheet({title:"",buttons:buttons,callback:function(index){if(-1===index)return action.close(),void(_this17.contentScrollState=!0);if(0===index)return action.close(),_this17.contentScrollState=!0,void _this17.newFormson(params.data[index].tbName);if(params.data[index].fieldInfo.relationInfo.mainSelector){var _fieldInfo=params.data[index].fieldInfo,relationSelector=_this17.dbData.relationSelector[_fieldInfo.relationInfo.mainSelector],mainName="";if(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_keys___default()(_this17.dbData.formmains).forEach(function(m){mainName=_this17.dbData.formmains[m][_fieldInfo.relationInfo.mainSelector].display}),!relationSelector)return void __WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u8bf7\u5148\u9009\u62e9"+mainName+"\uff01","center",1500,0);var selectedMasterDataId=relationSelector.toMasterDataId;selectedMasterDataId?_this17.openWebView("relation",{title:"\u5173\u8054\u5217\u8868",type:"browse",formType:"formInsert",params:_fieldInfo,content:_this17.dbData.data.content,tbName:params.data[index].tbName,selectedMasterDataId:selectedMasterDataId,DBKey:_this17._buildStoreKey()}):__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u8bf7\u5148\u9009\u62e9"+mainName+"\uff01","center",1500,0)}else _this17.openWebView("relation",{title:"\u5173\u8054\u5217\u8868",type:"browse",formType:"formInsert",params:params.data[index].fieldInfo,content:_this17.dbData.data.content,tbName:params.data[index].tbName,DBKey:_this17._buildStoreKey()});action.close(),_this17.contentScrollState=!0}})}else this.newFormson(tbName)},viewFormson:function(recordId,tbName,lists,listsIndex,auth){var formsonInitData=this.initFormSonFieldDatas(tbName);formsonInitData.recordId=recordId,formsonInitData.fields=lists,formsonInitData.listsIndex=listsIndex;var data={title:this.getFormsonTitlte(tbName),type:"browse"!==this.type?"edit":"browse",tableName:tbName,params:{formMasterId:this.dbData.data.content.contentDataId,formId:this.dbData.data.content.contentTemplateId,rightId:this.dbData.data.content.rightId},formsonInitData:formsonInitData,relationSelector:this.dbData.relationSelector,skinDefault:this.dbData.data.viewInfo.viewContent.skin.defs,formmains:this.dbData.formmains};this.openWebView("formson",data)},getFormsonTitlte:function(tbName){var _this18=this,title="";return __WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_keys___default()(this.dbData.formsons).map(function(v){return _this18.dbData.formsons[v].tableName===tbName&&(title=_this18.dbData.formsons[v].display),""}),title},toScrollElement:function(ele){var _this19=this;this.$nextTick(function(){document.getElementById(ele+"_father").children[0].style.cssText="",_this19.bScroll.scrollToElement("#"+ele+"_father",500,!0,0)})},closeWebView:function(type){var _this20=this,done=function(){_this20.clearFromStore(),_this20.removeSessionFormCache(!0)};"close"===type?__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"warning",title:"",text:"\u60a8\u786e\u8ba4\u8981\u5173\u95ed\u5417\uff1f",buttons:["\u53d6\u6d88","\u786e\u5b9a"],callback:function(index){return 1===index&&done()}}):done()},openWebView:function(route,data,type){__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.j(route,data,type)},scanQRCode:function(){var _this21=this;__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.p(function(err,result){if(err)return __WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"alert",title:"",text:"\u626b\u63cf\u4e8c\u7ef4\u7801\u5931\u8d25",buttons:["\u786e\u5b9a"]});var data=null;try{data=JSON.parse(result.text)}catch(e){}data&&"cap4form"===data.codeType?_this21.saveToServer("save",!0,function(){__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.d("\u626b\u7801\u4e2d...");var params={formId:_this21.dbData.data.content.contentTemplateId,dataId:_this21.dbData.data.content.contentDataId,moduleId:_this21.dbData.data.content.moduleId,rightId:_this21.dbData.data.content.rightId,recordId:"0",tableName:"",content:result.text};__WEBPACK_IMPORTED_MODULE_31__business_utils_service__.i(params).then(function(res){var _res$data2=res.data,data=(_res$data2.code,_res$data2.data);__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.g(),res.data.success?_this21._manipulateForm(data.tableData,{record:function(action,payload){var table=payload.table,records=payload.records,frontTableName=table.frontTableName,activeIndex=_this21.curIndexMap[frontTableName],lastIndex=_this21.getLastIndex(table.records);if("add"===action)if(console.log([activeIndex,lastIndex]),void 0===activeIndex){var _table$records2;(_table$records2=table.records).splice.apply(_table$records2,[lastIndex,0].concat(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_toConsumableArray___default()(records)))}else{var _table$records3;(_table$records3=table.records).splice.apply(_table$records3,[activeIndex+1,0].concat(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_toConsumableArray___default()(records)))}}},function(){_this21.allFormCalculate()}):__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"alert",title:"",text:res.data.msg||"\u4e8c\u7ef4\u7801\u89e3\u7801\u5931\u8d25",buttons:["\u786e\u5b9a"]})},function(err){__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h(err.message||"\u4e8c\u7ef4\u7801\u89e3\u7801\u5931\u8d25","center",1500,0)})},null,_this21.dbData.pageParams.params.moduleType,!0,{needCheckRule:"0",needDataUnique:"0",needSn:"0"}):__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.h("\u6682\u4e0d\u652f\u6301\u6b64\u7c7b\u578b\u4e8c\u7ef4\u7801","center",1500,0)})},switchForm:function(){var _this22=this,dbData=this.dbData,_formainParam=this._formainParam,data=dbData.data,viewIndex=dbData.viewIndex,pageParams=dbData.pageParams,phoneView=parseInt(data.viewInfo.phoneViewCount)<1,done=function(){var url=__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.q.base+"/htmls/native/form/index.html",param=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},_formainParam,{formMasterId:dbData.data.content.contentDataId,indexParam:viewIndex,switchFrom:"origin"});_this22.clearFromStore(),cmp.href.go(url,param)};this.assertEmptyView(!1,phoneView)||(__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.d("\u4fdd\u5b58\u4e2d..."),this.saveToServer("save",!0,done,null,pageParams.params.moduleType,!0,{needCheckRule:"0",needDataUnique:"0",needSn:"0"}))},assertEmptyView:function(isPC,isEmpty,doCheck){var _this23=this,data=this.dbData.data||{},name=isPC?"\u7535\u8111":"\u79fb\u52a8";return isEmpty&&__WEBPACK_IMPORTED_MODULE_16__utils_bridge_js__.e({type:"warning",title:"",text:"\u5f53\u524d\u8868\u5355\u6ca1\u6709\u914d\u7f6e"+name+"\u7aef\u89c6\u56fe/\u5185\u5bb9\uff0c\u4e0d\u80fd\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c",buttons:["\u786e\u5b9a"],callback:function(){if(doCheck){var isMultiView=data.views&&data.views.length>1;!isMultiView&&_this23._isUnflow?_this23.switchForm():isMultiView||_this23.closeWebView()}}}),isEmpty},emitForm:function(name,payload){__WEBPACK_IMPORTED_MODULE_33__assets_js_api__.b.$emit(name,payload),"rendered"!==name&&"updated"!==name&&__WEBPACK_IMPORTED_MODULE_33__assets_js_api__.b.$emit("updated",payload)}}}},,,function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__js_adaptation__=__webpack_require__(262),__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__=__webpack_require__(202),rloaded=/^(complete|loaded)$/,identifier="";__webpack_exports__.a={name:"CustomWidget",data:function(){var _data=this.data,id=_data.id,recordId=_data.recordId,formStore=this.formStore,viewIndex=formStore.viewIndex,_ref=formStore.data.content||{},contentDataId=_ref.contentDataId,channelId=recordId?""+id+recordId:""+id;return{widgetUid:contentDataId+"_"+viewIndex+"_"+channelId,channelId:channelId,message:{}}},props:["data","formdata","formDetails","formStore"],computed:{tableInfo:function(){return this.data.recordId?this.formDetails:{tableCategory:"formmain"}}},created:function(){this._customEvents=[]},mounted:function(){var _this=this;cmp.ready(function(){return _this.$nextTick(function(){return _this.load()})})},destroyed:function(){this._unbindEvents()},watch:{"$props.data":{handler:function(value){var _this2=this,channelId=this.channelId,widgetUid=this.widgetUid,formStore=this.formStore,_data2=this.data,id=_data2.id,recordId=_data2.recordId,viewIndex=formStore.viewIndex,_ref2=formStore.data.content||{},contentDataId=_ref2.contentDataId,newChannelId=recordId?""+id+recordId:""+id,newWidgetUid=contentDataId+"_"+viewIndex+"_"+newChannelId,source=this.data.customFieldInfo.mbInjectionInfo||{},scopeName=source.nameSpace;newWidgetUid!==widgetUid?(this.widgetUid=newWidgetUid,this.channelId=newChannelId,this.$nextTick(function(){window[scopeName]&&window[scopeName].destroy&&window[scopeName].destroy(channelId),_this2.load()})):__WEBPACK_IMPORTED_MODULE_0__js_adaptation__.a.ObserverEvent.trigger("Event"+channelId,value)},deep:!0}},methods:{load:function(){var source=this.data.customFieldInfo.mbInjectionInfo||{},wxpath=source.weixinpath||"collaboration",urlPrefix=cmp.platform.CMPShell?source.path:"/seeyon/m3/apps/v5/"+wxpath+"/",sourceUrl=urlPrefix+source.jsUri,entryName=source.initMethod;identifier=source.nameSpace;var scopeName=source.nameSpace,_data3=this.data,recordId=(_data3.id,_data3.recordId),uniqueId=this.channelId;__WEBPACK_IMPORTED_MODULE_0__js_adaptation__.a.adaptation({messageData:this.data,privateMessage:{recordsId:recordId,id:uniqueId},modifyFeld:["attachmentInfo","attrs","auth","ctrlBorderStyle","ctrlTitleStyle","ctrlType","customFieldInfo","digitNum","display","enums","extra","fieldLength","fieldType","formType","formatType","id","inputType","isInCalculate","isInCondition","isNotNull","placeHolder","radioAlignType","recordId","relation","showValue","type","value","valueId","customValue"],parentObject:this,formdata:this.formdata}),this._bindEvents(),this._doLoad(sourceUrl,urlPrefix,uniqueId,entryName,scopeName)},customEvent:function(){var newObj=__WEBPACK_IMPORTED_MODULE_0__js_adaptation__.a.parentGetData(this.data.id);this.$emit("modifyprops",newObj)},_bindEvents:function(){var _this3=this,channelId=this.channelId;this._unbindEvents(),this._listen("openPageMobile"+channelId,function(payload){__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.j(payload.subUrl,{title:"\u67e5\u8be2",appId:payload.appId})}),this._listen("externalManipulateForm",function(payload){payload.privateId||console.warn("\u5fc5\u987b\u5305\u542bprivateId"),payload.privateId===channelId&&_this3.$emit("externalManipulateForm",payload)}),this._listen("externalCallApi",function(payload){payload.privateId||console.warn("\u5fc5\u987b\u5305\u542bprivateId"),payload.privateId===channelId&&_this3.$emit("externalCallApi",payload.data)}),this._listen("externalFillNormalField",function(payload){payload.privateId||console.warn("\u5fc5\u987b\u5305\u542bprivateId"),payload.privateId===channelId&&_this3.$emit("externalFillNormalField",payload.data)}),this._listen("externalFillAttachField",function(payload){payload.privateId||console.warn("\u5fc5\u987b\u5305\u542bprivateId"),payload.privateId===channelId&&_this3.$emit("externalFillAttachField",payload.data)})},_unbindEvents:function(){for(;this._events.length;){var detach=this._customEvents.shift();detach&&detach()}},_listen:function(name,cb){__WEBPACK_IMPORTED_MODULE_0__js_adaptation__.a.ObserverEvent.listen(name,cb);var detach=function(){__WEBPACK_IMPORTED_MODULE_0__js_adaptation__.a.ObserverEvent.remove(name,cb)};return this._customEvents.push(detach),detach},_doCreate:function(urlPrefix,privateId,entryName,scopeName){window[scopeName]&&window[scopeName][entryName]?window[scopeName][entryName]({adaptation:__WEBPACK_IMPORTED_MODULE_0__js_adaptation__.a,urlPrefix:urlPrefix,url_prefix:urlPrefix,privateId:privateId,getData:__WEBPACK_IMPORTED_MODULE_0__js_adaptation__.a.childrenGetData(privateId),formMessage:this.tableInfo}):console.warn('"'+scopeName+'" not registered nor "'+scopeName+"."+entryName+'" not implemented yet.')},_doLoad:function(sourceUrl,urlPrefix,privateId,entryName,scopeName){var _this4=this;if(window[scopeName]&&window[scopeName][entryName])return this._doCreate(urlPrefix,privateId,entryName,scopeName);var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.src=sourceUrl,script.async=!0,head.appendChild(script),script.onerror=function(e){script.onload=script.onreadystatechange=script.onerror=null,console.warn('failed to load custom widget resource "'+sourceUrl+'"'+scopeName+'".')},script.onload=script.onreadystatechange=function(e){("load"===e.type||rloaded.exec(script.readyState))&&(script.onload=script.onreadystatechange=script.onerror=null,_this4._doCreate(urlPrefix,privateId,entryName,scopeName))}}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={name:"ScrollPane",data:function(){return{scrollX:0,maxScroll:0,overflow:!1,leftEdge:!0,rightEdge:!0}},render:function(){var h=arguments[0],overflow=this.overflow,scrollX=this.scrollX,leftEdge=this.leftEdge,rightEdge=this.rightEdge,translateX="translateX("+scrollX+"px)",listStyle={transform:translateX,"-webkit-transform":translateX,"-moz-transform":translateX,"-o-transform":translateX,"-ms-transform":translateX},larrowCls=["CAP cap-icon-zuojiantou"],rarrowCls=["CAP cap-icon-youjiantou"];return leftEdge||larrowCls.push("active"),rightEdge||rarrowCls.push("active"),h("div",{class:"form-scrollpane"},[h("div",{class:"pane",ref:"pane"},[h("div",{class:"pane-inner",ref:"content",style:listStyle},[this.$slots.default])]),h("div",{class:"arrows"},[overflow&&h("i",{class:larrowCls,on:{tap:this.onScrollLeft}}),overflow&&h("i",{class:rarrowCls,on:{tap:this.onScrollRight}})])])},mounted:function(){var _this=this;this.$nextTick(function(){return _this.updateLayout()})},updated:function(){var _this2=this;this.$nextTick(function(){return _this2.updateLayout()})},methods:{onScrollLeft:function(){var x=this.scrollX+50;this.scrollX=x>=0?0:x,this.updateScroll()},onScrollRight:function(){var maxScroll=this.maxScroll,x=this.scrollX-50;this.scrollX=x<-maxScroll?-maxScroll:x,this.updateScroll()},scrollToElement:function(el){var right=el.offsetWidth+el.offsetLeft,x=this.$refs.pane.clientWidth-right;this.updateLayout(),x<-this.maxScroll&&(x=-this.maxScroll),x>=0&&(x=0),this.scrollX=x,this.updateScroll()},updateScroll:function(){var overflow=this.overflow,scrollX=this.scrollX,maxScroll=this.maxScroll;this.leftEdge=!overflow||0===scrollX,this.rightEdge=!overflow||scrollX===-maxScroll},updateLayout:function(){var _$refs=this.$refs,pane=_$refs.pane,content=_$refs.content,clientWidth=pane.clientWidth,offsetWidth=content.offsetWidth;this.maxScroll=Math.max(0,offsetWidth-clientWidth),this.overflow=this.maxScroll>0,this.updateScroll()}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__=__webpack_require__(208),__WEBPACK_IMPORTED_MODULE_2__components_formson_tablist_vue__=__webpack_require__(254),__WEBPACK_IMPORTED_MODULE_3__components_formson_toolbar_vue__=__webpack_require__(234),__WEBPACK_IMPORTED_MODULE_4__components_table_table_vue__=__webpack_require__(235);__webpack_exports__.a={name:"TabFormson",props:["type","dbData","initTableName","initRecordIndex"],components:{BetterTablist:__WEBPACK_IMPORTED_MODULE_2__components_formson_tablist_vue__.a,BetterToolbar:__WEBPACK_IMPORTED_MODULE_3__components_formson_toolbar_vue__.a,BetterTable:__WEBPACK_IMPORTED_MODULE_4__components_table_table_vue__.a},data:function(){return{lineStyle:{},tabs:[],buttons:[],layout:"",binding:"",selectedTable:"",selectedRecord:-1,layoutWidth:800}},watch:{dbData:function(){this._initialize(this.selectedTable)}},created:function(){this._buttons=[{text:"\u63d2\u5165\u884c",url:null,fontText:"cap-icon-jiahao",color:"#1F85EC",action:"insert",requiredAuth:"add"},{text:"\u590d\u5236\u884c",url:null,fontText:"cap-icon-fuzhi",color:"#1F85EC",action:"copy",requiredAuth:"add"},{text:"\u5220\u9664\u884c",url:null,fontText:"cap-icon-shanchu",color:"#FF5E5E",action:"delete",requiredAuth:"delete"},{text:"\u5220\u9664\u5168\u90e8",url:null,fontText:"cap-icon-shanchuquanbu",color:"#FF5E5E",action:"deleteAll",requiredAuth:"delete"}],this._initialize(this.initTableName)},render:function(){var h=arguments[0],dbData=this.dbData,type=this.type,tabs=this.tabs,selectedTable=this.selectedTable,layout=this.layout,binding=this.binding,buttons=this.buttons,layoutWidth=this.layoutWidth,lineStyle=this.lineStyle,auth=binding.auth,toolbar=auth&&("1"===auth.add||"1"===auth.delete);return h("section",{class:"tab-formson",style:{width:layoutWidth+"px"}},[h(__WEBPACK_IMPORTED_MODULE_2__components_formson_tablist_vue__.a,{style:lineStyle,attrs:{tabs:tabs,selected:selectedTable},on:{switchTab:this.onSwitchTab}}),toolbar&&h(__WEBPACK_IMPORTED_MODULE_3__components_formson_toolbar_vue__.a,{style:lineStyle,attrs:{buttons:buttons},on:{clickButton:this.onClickButton}}),h(__WEBPACK_IMPORTED_MODULE_4__components_table_table_vue__.a,{ref:"table",attrs:{type:type,formStore:dbData,layout:layout,binding:binding},on:{selectRecord:this.onSelectRecord}})])},methods:{onSwitchTab:function(tab){tab.frontName!==this.selectedTable&&(this._initialize(tab.frontName),this.$emit("switchTab",tab.frontName))},onClickButton:function(btn){var _this=this,action=btn.action,dbData=this.dbData,layout=this.layout,binding=this.binding,selectedTable=this.selectedTable,selectedRecord=this.selectedRecord,records=dbData.formsons[selectedTable].records,table=this.$refs.table,index=-1===selectedRecord?void 0:selectedRecord;if("insert"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("InsertFormsonEvent",{cb:function(){-1!==selectedRecord?records.splice(selectedRecord+1,0,null):records.push(null)}});else if("delete"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("deleteFormsonEvent",{index:index,frontTableName:selectedTable,cb:function(){_this.fillNullRows(),table.selectNone()}});else if("deleteAll"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("deleteAllFormsonEvent",{frontTableName:selectedTable,defaultRows:layout.defaultRows,cb:function(){_this.fillNullRows(),table.selectNone()}});else if("copy"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("copyFormsonEvent",{frontTableName:selectedTable,index:index,cb:function(){}});else if("addButton"===action){var params={type:"formInsert",recordId:"",tableName:binding.tableName,clickType:"formInsert",fieldInfo:btn.fieldInfo},extra={frontTableName:selectedTable,curIndex:index};__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("relation","formInsert",params,extra)}else"aggregate"===action&&__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("relation","formAggregate",{type:"aggregate",tableName:binding.tableName,frontTableName:binding.frontTableName,tableDisplay:binding.display,param:btn.param})},onSelectRecord:function(newIndex,lastIndex){var selectedTable=this.selectedTable,binding=this.binding,record=binding.records[newIndex];this.selectedRecord=newIndex,this.$emit("selectRecord",selectedTable,newIndex),__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("setCurIndexToFormmain",{curIndex:-1===newIndex?"":newIndex,frontTableName:selectedTable}),-1!==newIndex&&(record||__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("newFormsonEvent",{index:newIndex,frontTableName:selectedTable,tableName:binding.tableName}))},fillNullRows:function(){var selectedTable=this.selectedTable,dbData=this.dbData,layout=this.layout,data=(this.$refs.table,dbData.formsons[selectedTable].records),defaultRows=layout.defaultRows;if(defaultRows>data.length)for(var i=data.length;i<defaultRows;i++)data.push(null)},_initialize:function(tableName){var _this2=this,dbData=this.dbData,formsons=dbData.formsons,formson=formsons[tableName],fieldInfo=formson.fieldInfo,auth=formson.auth,viewContent=dbData.data.viewInfo.viewContent,_dbData$data$relation=dbData.data.relationButtons,relationButtons=void 0===_dbData$data$relation?{}:_dbData$data$relation;this.selectedTable=tableName,this.selectedRecord=-1,this.tabs=[],__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(formsons).forEach(function(name){_this2.tabs.push({frontName:name,tableName:formsons[name].tableName,display:formsons[name].display})}),this.buttons=this._buttons.filter(function(button){return"1"===auth[button.requiredAuth]}),"1"===auth.add&&__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(fieldInfo).forEach(function(name){var field=fieldInfo[name];field.relationInfo&&"1"===field.relationInfo.fillInRow&&_this2.buttons.splice(1,0,{text:""+field.relationInfo.buttonName,url:null,fontText:"cap-icon-charuwupin",color:"#00ACCB",action:"addButton",fieldInfo:field})});var buttons=relationButtons[formson.tableName];buttons&&"1"===auth.add&&buttons.forEach(function(button){_this2.buttons.push({action:"aggregate",text:button.buttonName,url:null,fontText:"cap-icon-charuwupin",color:"#00ACCB",tableName:formson.tableName,param:button})}),this.layout=viewContent.children.filter(function(el){return el.tableName===tableName})[0];var actualWidth=this.layout.colWidths.reduce(function(a,b){return a+b},0),cellStyle=this.layout.cells[0].style||{};this.layoutWidth=Math.max(viewContent.styles.width,actualWidth),this.lineStyle={borderTop:cellStyle.borderTop,borderLeft:cellStyle.borderLeft,borderRight:cellStyle.borderRight},this.binding=formson}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__components_formson_scrollpane_vue__=__webpack_require__(253);__webpack_exports__.a={name:"FormsonTablist",props:["tabs","selected"],components:{ScrollPane:__WEBPACK_IMPORTED_MODULE_0__components_formson_scrollpane_vue__.a},watch:{selected:function(){var _this=this;this.$nextTick(function(){var pane=_this.$refs.pane,el=pane.$el.querySelector("[data-tab="+_this.selected+"]");pane.scrollToElement(el)})}},render:function(){var _this2=this,h=arguments[0],tabs=this.tabs,selected=this.selected;return h(__WEBPACK_IMPORTED_MODULE_0__components_formson_scrollpane_vue__.a,{ref:"pane",class:"formson-tablist"},[tabs.map(function(item){var cls=["tab-item"];return item.frontName===selected&&cls.push("active"),h("div",{key:item.frontName,attrs:{"data-tab":item.frontName},class:cls,on:{tap:function(){return _this2.onSwitch(item)}}},[item.display])})])},methods:{onSwitch:function(item){this.selected!==item.frontName&&this.$emit("switchTab",item)}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__=__webpack_require__(208),__WEBPACK_IMPORTED_MODULE_2__components_formson_toolbar_vue__=__webpack_require__(234),__WEBPACK_IMPORTED_MODULE_3__components_table_table_vue__=__webpack_require__(235);__webpack_exports__.a={name:"TileFormson",props:["type","dbData","initTableName"],components:{BetterToolbar:__WEBPACK_IMPORTED_MODULE_2__components_formson_toolbar_vue__.a,BetterTable:__WEBPACK_IMPORTED_MODULE_3__components_table_table_vue__.a},data:function(){return{lineStyle:{},buttons:[],layout:"",binding:"",selectedTable:"",selectedRecord:-1}},watch:{dbData:function(){this._initialize(this.selectedTable)}},created:function(){this._buttons=[{text:"\u63d2\u5165\u884c",url:null,fontText:"cap-icon-jiahao",color:"#1F85EC",action:"insert",requiredAuth:"add"},{text:"\u590d\u5236\u884c",url:null,fontText:"cap-icon-fuzhi",color:"#1F85EC",action:"copy",requiredAuth:"add"},{text:"\u5220\u9664\u884c",url:null,fontText:"cap-icon-shanchu",color:"#FF5E5E",action:"delete",requiredAuth:"delete"},{text:"\u5220\u9664\u5168\u90e8",url:null,fontText:"cap-icon-shanchuquanbu",color:"#FF5E5E",action:"deleteAll",requiredAuth:"delete"}],this._initialize(this.initTableName)},render:function(){var h=arguments[0],dbData=this.dbData,type=this.type,layout=this.layout,binding=this.binding,buttons=this.buttons,layoutWidth=this.layoutWidth,lineStyle=this.lineStyle,auth=binding.auth;return h("section",{class:"tile-formson",style:{width:layoutWidth+"px"}},[auth&&("1"===auth.add||"1"===auth.delete)&&h(__WEBPACK_IMPORTED_MODULE_2__components_formson_toolbar_vue__.a,{style:lineStyle,attrs:{buttons:buttons},on:{clickButton:this.onClickButton}}),h(__WEBPACK_IMPORTED_MODULE_3__components_table_table_vue__.a,{ref:"table",attrs:{type:type,formStore:dbData,layout:layout,binding:binding},on:{selectRecord:this.onSelectRecord}})])},methods:{onClickButton:function(btn){var _this=this,action=btn.action,dbData=this.dbData,layout=this.layout,binding=this.binding,selectedTable=this.selectedTable,selectedRecord=this.selectedRecord,records=dbData.formsons[selectedTable].records,table=this.$refs.table,index=-1===selectedRecord?void 0:selectedRecord;if("insert"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("InsertFormsonEvent",{cb:function(){-1!==selectedRecord?records.splice(selectedRecord+1,0,null):records.push(null)}});else if("delete"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("deleteFormsonEvent",{index:index,frontTableName:selectedTable,defaultRows:layout.defaultRows,cb:function(){_this.fillNullRows(),table.selectNone()}});else if("deleteAll"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("deleteAllFormsonEvent",{frontTableName:selectedTable,defaultRows:layout.defaultRows,cb:function(){_this.fillNullRows(),table.selectNone()}});else if("copy"===action)__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("copyFormsonEvent",{frontTableName:selectedTable,index:index,cb:function(){}});else if("addButton"===action){var params={type:"formInsert",recordId:"",tableName:binding.tableName,clickType:"formInsert",fieldInfo:btn.fieldInfo},extra={frontTableName:selectedTable,curIndex:index};__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("relation","formInsert",params,extra)}else"aggregate"===action&&__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("relation","formAggregate",{type:"aggregate",tableName:binding.tableName,frontTableName:binding.frontTableName,tableDisplay:binding.display,param:btn.param})},onSelectRecord:function(newIndex,lastIndex){var selectedTable=this.selectedTable,binding=this.binding,record=binding.records[newIndex];this.selectedRecord=newIndex,this.$emit("selectRecord",selectedTable,newIndex),__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("setCurIndexToFormmain",{curIndex:-1===newIndex?"":newIndex,frontTableName:selectedTable}),-1!==newIndex&&(record||__WEBPACK_IMPORTED_MODULE_1__utils_eventBus__.a.$emit("newFormsonEvent",{index:newIndex,frontTableName:selectedTable,tableName:binding.tableName}))},fillNullRows:function(){var selectedTable=this.selectedTable,dbData=this.dbData,layout=this.layout,data=(this.$refs.table,dbData.formsons[selectedTable].records),defaultRows=layout.defaultRows;if(console.log("fillnull:",data.length,defaultRows),defaultRows>data.length)for(var i=data.length;i<defaultRows;i++)data.push(null)},_initialize:function(tableName){var _this2=this,dbData=this.dbData,formsons=dbData.formsons,formson=formsons[tableName],fieldInfo=formson.fieldInfo,auth=formson.auth,viewContent=dbData.data.viewInfo.viewContent,_dbData$data$relation=dbData.data.relationButtons,relationButtons=void 0===_dbData$data$relation?{}:_dbData$data$relation;this.selectedTable=tableName,this.selectedRecord=-1,this.buttons=this._buttons.filter(function(button){return"1"===auth[button.requiredAuth]}),"1"===auth.add&&__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(fieldInfo).forEach(function(name){var field=fieldInfo[name];field.relationInfo&&"1"===field.relationInfo.fillInRow&&_this2.buttons.splice(1,0,{text:""+field.relationInfo.buttonName,url:null,fontText:"cap-icon-charuwupin",color:"#00ACCB",action:"addButton",fieldInfo:field})});var buttons=relationButtons[formson.tableName];buttons&&"1"===auth.add&&buttons.forEach(function(button){_this2.buttons.push({action:"aggregate",text:button.buttonName,url:null,fontText:"cap-icon-charuwupin",color:"#00ACCB",tableName:formson.tableName,param:button})}),this.layout=viewContent.children.filter(function(el){return el.tableName===tableName})[0];var actualWidth=this.layout.colWidths.reduce(function(a,b){return a+b},0),cellStyle=this.layout.cells[0].style||{};this.layoutWidth=Math.max(viewContent.styles.width,actualWidth),this.lineStyle={borderTop:cellStyle.borderTop,borderLeft:cellStyle.borderLeft,borderRight:cellStyle.borderRight},this.binding=formson}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__components_formson_scrollpane_vue__=__webpack_require__(253);__webpack_exports__.a={name:"FormsonToolbar",props:["buttons"],components:{ScrollPane:__WEBPACK_IMPORTED_MODULE_0__components_formson_scrollpane_vue__.a},render:function(){var _this=this,h=arguments[0],buttons=this.buttons;return h(__WEBPACK_IMPORTED_MODULE_0__components_formson_scrollpane_vue__.a,{class:"formson-toolbar"},[h("div",{class:"buttons"},[buttons.map(function(btn){var icon=void 0;return icon=btn.url?h("img",{attrs:{width:14,height:14,src:btn.url}}):h("i",{class:["CAP",btn.fontText],style:{color:btn.color}}),h("div",{key:btn.text,class:"ui-btn",on:{tap:function(){return _this.onClick(btn)}}},[h("div",{class:"ui-btn-inner"},[h("span",{class:"ui-btn-icon"},[icon]),btn.text])])})])])},methods:{onClick:function(btn){this.$emit("clickButton",btn)}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={name:"navbar",props:["indexParam","type","data","bg","color","border"],data:function(){return{activeIndex:Number(this.indexParam)||0}},mounted:function(){},components:{},methods:{changeView:function(rightId,index){this.activeIndex!==index&&(this.activeIndex=index,this.$emit("changeView",rightId,index))}},computed:{}}},,function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__(204),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_2__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_4__components_custom_custom_vue__=(__webpack_require__(202),__webpack_require__(252)),__WEBPACK_IMPORTED_MODULE_5__business_mixins_form_hub__=__webpack_require__(251),__WEBPACK_IMPORTED_MODULE_6__utils_eventBus__=__webpack_require__(208);__webpack_exports__.a={name:"BetterTable",props:["type","formStore","layout","binding"],mixins:[__WEBPACK_IMPORTED_MODULE_5__business_mixins_form_hub__.a],components:{CustomPrefix:__WEBPACK_IMPORTED_MODULE_4__components_custom_custom_vue__.a},data:function(){return this._initialize()},updated:function(){__WEBPACK_IMPORTED_MODULE_6__utils_eventBus__.a.$emit("refreshScroll")},computed:{rows:function(){var layout=this.layout,binding=this.binding,shadow=this.shadow,rstart=(shadow.rowKey,shadow.rstart),rend=shadow.rend,_ref=[layout.row,layout.col],rlen=_ref[0],records=binding.records&&binding.records.slice(0),renderRows=[];if(layout.isMaster)renderRows.push.apply(renderRows,shadow.rows);else{for(var i=0;i<rstart;++i)renderRows.push(shadow.rows[i]);records.forEach(function(record,cursor){for(var _i=rstart;_i<=rend;++_i){var row=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_index__.b)(!0,shadow.rows[_i]);record&&(row.key=record.recordId),row.cursor=cursor,renderRows.push(row)}});for(var _i2=rend+1;_i2<rlen;++_i2)renderRows.push(shadow.rows[_i2])}return renderRows},currentFormData:function(){return{rawData:this.formStore.data,formmains:this.formStore.formmains,formsons:this.formStore.formsons}},currentFormMeta:function(){return{tableCategory:this.layout.isMaster?"formmain":"formson",tableName:this.binding.tableName}}},watch:{layout:function(newLayout,oldLayout){newLayout!==oldLayout&&__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_index__.a)(this,this._initialize())}},created:function(){var defaults=window.__formDesigner&&window.__formDesigner.defaults;this._baseCellStyle=defaults?defaults.cell.style:{},this._baseWidgetStyle=defaults?defaults.widget.style.pc:{}},render:function(){var _this=this,h=arguments[0];console.time("[TableRender]");var formStore=this.formStore,layout=this.layout,cls="cap4-formmain__mTable";this.shadow.isMaster||(cls+=" is-detail-table");var tableName=formStore.formsons[layout.tableName]?formStore.formsons[layout.tableName].tableName:layout.tableName,rendered=h("table",{class:cls,style:{width:this.shadow.width+"px"},on:{tap:this.onRowClick}},[h("colgroup",[h("col",{attrs:{width:"0"}}),this.shadow.colgroup.map(function(width,index){return h("col",{key:"colgroup-"+index,attrs:{width:width}})})]),this.rows.map(function(row,rindex){return _this._renderRow(row,rindex,tableName)})]);return console.timeEnd("[TableRender]"),rendered},methods:{_initialize:function(){return{shadow:this._createShadow(),selectedRow:-1,selectedRecord:-1}},insertRow:function(index){for(var row,shadow=this.shadow,binding=this.binding,rstart=shadow.rstart,rsize=shadow.rsize,rows=shadow.rows,rowKey=shadow.rowKey,pos=(binding.records.length,rstart+rsize*index),i=pos;row=this.rows[i];++i)"number"==typeof row.cursor&&(row.cursor+=1);for(var _i3=0;_i3<rsize;++_i3){var _row=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_index__.b)(!0,rows[rstart+_i3]);_row.key=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_index__.d)(rowKey),_row.cursor=index,this.rows.splice(pos+_i3,0,_row)}},deleteRow:function(index){var _shadow=this.shadow,rstart=_shadow.rstart,rsize=_shadow.rsize,records=this.binding.records,pos=(records.length,rstart+rsize*index);this.rows.splice(pos,rsize);for(var row,i=pos;row=this.rows[i];++i)"number"==typeof row.cursor&&(row.cursor-=1);this.selectRecord(-1,this.selectRecord)},deleteAll:function(){__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_index__.a)(this,this._initialize())},selectNone:function(){this.selectRecord(-1,this.selectedRecord)},selectRecord:function(newRecord,lastRecord){this.selectedRecord=newRecord,this.$emit("selectRecord",newRecord,lastRecord)},onRowClick:function(evt){var auth=this.binding.auth||!1,notSelectFormson=!!auth&&("0"===auth.add&&"0"===auth.delete);if("browse"!==this.type&&!this.layout.isMaster&&!notSelectFormson){for(var el=evt.target;el&&"TR"!==el.nodeName;)el=el.parentNode;var newRow=parseInt(el.getAttribute("data-row")),lastRow=this.selectedRow;if(lastRow!==newRow&&(this.selectedRow=newRow,this.$emit("selectRow",newRow,lastRow)),!this.layout.isMaster){var newRecord=parseInt(el.getAttribute("data-record")),lastRecord=this.selectedRecord;-1!==newRecord&&lastRecord!==newRecord&&this.selectRecord(newRecord,lastRecord)}}},_renderRow:function(row,rindex,tableName){var _this2=this,h=this.$createElement,layout=this.layout,binding=this.binding,cursor=row.cursor,cls=[],index=void 0===cursor?-1:cursor,dataset=layout.isMaster?binding:void 0===cursor?this._masterFields:binding.records[cursor]&&binding.records[cursor].lists;return void 0!==cursor&&dataset&&cls.push("record-active"),index===this.selectedRecord&&-1!==index&&cls.push("record-selected"),h("tr",{key:row.key,attrs:{"data-row":rindex,"data-record":index,height:row.height},class:cls.join(" ")},[h("td",{style:"width:0"}),row.cells.map(function(cell,cindex){return h("td",{key:row.key+"_"+cindex,attrs:{"data-col":cindex,rowspan:cell.rowSpan,colspan:cell.colSpan},style:_this2._createCellStyle(cell,rindex)},[h("div",{class:"cap4-formmain__td"},[_this2._renderChild(cell.children,dataset,index,layout.isMaster,tableName)])])})])},_renderChild:function(children,dataset,lineno,isMaster,tableName){var h=this.$createElement,viewEl=children&&children[0],rnowrap=/suiStatic|suiLinenumber/,data={};return viewEl&&"suiLineNumber"===viewEl.ctrlType?(data=dataset&&dataset[viewEl.id]||{},this._renderComponents(viewEl,data,lineno)):viewEl&&dataset?(data=dataset&&dataset[viewEl.id]||{},rnowrap.test(viewEl.ctrlType)?this._renderComponents(viewEl,data,lineno):h("div",{attrs:{id:isMaster?"master|"+data.id:tableName+"|"+data.recordId+"|"+data.id},style:this._baseWidgetStyle},[this._renderComponents(viewEl,data,lineno)])):void 0},_renderComponents:function(item,data,lineno){var h=this.$createElement;switch(item.ctrlType){case"suiLineNumber":return h("section",{class:"lineno",style:data.extra},[lineno+1]);case"suiStatic":return h("section",{style:data.extra},[h("pre",[data.display])]);case"suiLabel":return h("cap4-link",{attrs:{data:data},on:{linkEvent:this.linkUrl}});case"suiLogo":return h("cap4-link-image",{attrs:{data:data},on:{linkImageEvent:this.linkImageUrl,imageLoad:this.imageLoadEvent}});case"suiLineGap":return h("cap4-interval",{attrs:{data:data}});case"suiCustomControl":return h("custom-prefix",{attrs:{formStore:this.formStore,data:data,formdata:this.currentFormData,formDetails:this.currentFormMeta},on:{externalManipulateForm:this.externalManipulateFormEvent,externalCallApi:this.externalCallApiEvent,externalFillNormalField:this.externalFillNormalEvent,externalFillAttachField:this.externalFillAttachEvent}});default:switch(data.inputType){case"text":if("VARCHAR"===data.fieldType)return h("cap4-text",{attrs:{data:data},on:{inputFocus:this.inputFocusEvent,inputBlur:this.inputBlurEvent,calculate:this.calculateEvent,relation:this.relationEvent,linkEvent:this.linkUrl}});if("DECIMAL"===data.fieldType)return h("cap4-number",{attrs:{data:data},on:{inputFocus:this.inputFocusEvent,inputBlur:this.inputBlurEvent,calculate:this.calculateEvent,relation:this.relationEvent}});break;case"textarea":return h("cap4-textarea",{attrs:{data:data},on:{inputFocus:this.inputFocusEvent,inputBlur:this.inputBlurEvent,calculate:this.calculateEvent,relation:this.relationEvent,textAreaAddContent:this.textareaAppendEvent,linkEvent:this.linkUrl}});case"checkbox":return h("cap4-checkbox",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent}});case"radio":return h("cap4-radio",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent}});case"date":return h("cap4-date",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectTime:this.timeEvent}});case"datetime":return h("cap4-datetime",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectTime:this.timeEvent}});case"select":return h("cap4-select",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectEvent:this.selectEvent}});case"member":case"multimember":return h("cap4-choose-people",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"post":case"multipost":return h("cap4-choose-post",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"department":case"multidepartment":return h("cap4-choose-department",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"account":case"multiaccount":return h("cap4-choose-company",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"level":case"multilevel":return h("cap4-choose-duty",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,chooseOrganize:this.organizeEvent}});case"image":return h("cap4-images",{attrs:{data:data},on:{calculate:this.calculateEvent,imagesEvent:this.imagesEvent,imageLoad:this.imageLoadEvent}});case"attachment":return h("cap4-attachment",{attrs:{data:data},on:{calculate:this.calculateEvent,attachmentEvent:this.attachmentEvent}});case"maplocate":return h("cap4-location",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,locationEvent:this.locationEvent}});case"mapphoto":return h("cap4-photo-location",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,photoEvent:this.photoEvent,imageLoad:this.imageLoadEvent}});case"mapmarked":return h("cap4-location-mark",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,markEvent:this.markEvent}});case"document":return h("cap4-relation-doc",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,documentEvent:this.documentEvent}});case"imageradio":return h("cap4-radio-image",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent}});case"imageselect":return h("cap4-select-image",{attrs:{data:data},on:{calculate:this.calculateEvent,relation:this.relationEvent,selectImageEvent:this.selectImageEvent}});case"flowdealoption":return h("cap4-flow",{attrs:{data:data},on:{calculate:this.calculateEvent}})}}},_createShadow:function(){for(var layout=this.layout,colWidths=(this.binding,layout.colWidths),rowHeights=layout.rowHeights,cells=layout.cells,merges=layout.merges,isMaster=layout.isMaster,repeatStartIndex=layout.repeatStartIndex,repeatEndIndex=layout.repeatEndIndex,_ref2=[layout.row,layout.col],rlen=_ref2[0],clen=_ref2[1],hsize=repeatStartIndex,rsize=repeatEndIndex-repeatStartIndex+1,fsize=rlen-hsize-rsize,rowKey=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_index__.d)("$vrow"),shadow={isMaster:isMaster,rows:[],rowKey:rowKey,colgroup:colWidths.slice(0),width:colWidths.reduce(function(a,b){return a+b},0),rstart:repeatStartIndex,rend:repeatEndIndex,hsize:hsize,rsize:rsize,fsize:fsize},r=0;r<rlen;++r){var vrow={height:rowHeights[r],cells:[]};(r<shadow.rstart||r>shadow.rend)&&(vrow.key=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_index__.d)(rowKey)),shadow.rows.push(vrow);for(var c=0;c<clen;++c)vrow.cells.push({rowSpan:1,colSpan:1,rowIndex:r,cellIndex:c,style:{},merged:!1,visible:!0})}return merges.forEach(function(merge){for(var rowSpan=merge.rowSpan,colSpan=merge.colSpan,r1=merge.startRowIndex,c1=merge.startColIndex,r2=r1+merge.rowSpan,c2=c1+merge.colSpan,_r=r1;_r<r2;++_r)for(var _c=c1;_c<c2;++_c){var cell=shadow.rows[_r].cells[_c];cell.merged=!0,cell.visible=!1,_r===r1&&_c===c1&&(cell.rowSpan=rowSpan,cell.colSpan=colSpan,cell.visible=!0)}}),cells.forEach(function(item){var rowIndex=item.rowIndex,colIndex=item.colIndex,style=item.style,children=item.children,cell=shadow.rows[rowIndex].cells[colIndex];style&&__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(style).length&&(cell.style=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},style)),cell.children=children?children.slice(0):[]}),isMaster||(this._masterFields=this.formStore.formmains[this.formStore.data.tableInfo.formmain.tableName]),shadow},_createCellStyle:function(cell,rowIndex){var userStyle=cell.style;if(!cell.visible)return{display:"none"};var inlineStyle=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},this._baseCellStyle,userStyle);return rowIndex>0&&delete inlineStyle.borderTop,cell.cellIndex>0&&delete inlineStyle.borderLeft,inlineStyle}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__utils_eventBus__=__webpack_require__(208);__webpack_exports__.a={methods:{inputFocusEvent:function(evt){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("inputFocus",evt)},inputBlurEvent:function(evt){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("inputBlur",evt)},timeEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("time",type,params)},organizeEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("organize",type,params)},imagesEvent:function(type,params,index){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("images",type,params,index)},imageLoadEvent:function(url,params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("imageLoad",url,params)},attachmentEvent:function(type,params,index){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("attachments",type,params,index)},locationEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("loaction",type,params)},linkUrl:function(params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("linkUrl",params)},linkImageUrl:function(params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("linkImageUrl",params)},documentEvent:function(type,params,index){console.log("documentEvent",type,params,index),__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("relationDoc",type,params,index)},photoEvent:function(type,params,index){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("photoLocation",type,params,index)},markEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("locationMark",type,params)},relationEvent:function(type,params){var extra=params.recordId?{recordId:params.recordId,frontTableName:this.layout.tableName,tableName:this.binding.tableName}:null;__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("relation",type,params,extra)},calculateEvent:function(params){var extra=params.recordId?{type:"formson",recordId:params.recordId,frontTableName:this.layout.tableName,tableName:this.binding.tableName}:null;__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("calculate",params,extra)},textareaAppendEvent:function(type,params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("textareaAppend",type,params)},imagesBrowserEvent:function(urls,index){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("imagesBrowser",urls,index)},filesBrowserEvent:function(files,index){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("filesBrowser",files,index)},selectImageEvent:function(params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("selectImageEvent",params)},selectEvent:function(params){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("selectEvent",params)},externalManipulateFormEvent:function(payload){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("externalManipulateFormEvent",payload)},externalFillNormalEvent:function(payload,cb){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("externalFillNormalEvent",payload,cb)},externalFillAttachEvent:function(payload,cb){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("externalFillAttachEvent",payload,cb)},externalCallApiEvent:function(payload){__WEBPACK_IMPORTED_MODULE_0__utils_eventBus__.a.$emit("externalCallApiEvent",payload)}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(267)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_custom_vue__=__webpack_require__(242),__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_13_7_3_vue_loader_lib_template_compiler_index_id_data_v_2d723977_hasScoped_true_transformToRequire_video_src_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_template_index_0_custom_vue__=__webpack_require__(284),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_custom_vue__.a,__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_13_7_3_vue_loader_lib_template_compiler_index_id_data_v_2d723977_hasScoped_true_transformToRequire_video_src_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_template_index_0_custom_vue__.a,!1,__vue_styles__,"data-v-2d723977",null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(274)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_scrollpane_vue__=__webpack_require__(243),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_scrollpane_vue__.a,null,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(275)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_tablist_vue__=__webpack_require__(245),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_tablist_vue__.a,null,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof__=__webpack_require__(45),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof__),__WEBPACK_IMPORTED_MODULE_2__business_utils_service__=__webpack_require__(203),__WEBPACK_IMPORTED_MODULE_3__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_4__utils_bridge_js__=__webpack_require__(202);__webpack_exports__.a={methods:{handleExternalManipulateForm:function(payload){var data=payload.data,callback=payload.callback;this._manipulateForm(data,null,function(){return callback&&callback()})},handleExternalCallApi:function(payload){var action=payload.action,callback=payload.callback,validation=payload.validation,cb=function(){return callback&&callback()};"presave"===action?this.saveToServer("save",!0,cb,null,this.dbData.pageParams.params.moduleType,!0,validation):"relayout"===action?this.refreshScroll():console.warn('unknow call "'+action+'"')},handleExternalFillNormalField:function(payload,callback){var _this=this;Array.isArray(payload)?payload.forEach(function(item){return _this._doExternalFillNormalField(item)}):payload&&"object"===(void 0===payload?"undefined":__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default()(payload))&&this._doExternalFillNormalField(payload),!1!==payload.calculate&&this.allFormCalculate(),callback&&callback()},handleExternalFillAttachField:function(payload,callback){var _this2=this,deferreds=[];return Array.isArray(payload)?payload.forEach(function(item){deferreds.push(_this2._doExternalFillAttachField(item))}):payload&&"object"===(void 0===payload?"undefined":__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_typeof___default()(payload))&&deferreds.push(this._doExternalFillAttachField(payload)),!1!==payload.calculate&&this.allFormCalculate(),__WEBPACK_IMPORTED_MODULE_3__utils_index__.c.when(deferreds).then(function(result){callback&&callback(result)})},_doExternalFillNormalField:function(payload){var tableCategory=payload.tableCategory,tableName=payload.tableName,updateData=payload.updateData,updateRecordId=payload.updateRecordId,_dbData=this.dbData,formmains=_dbData.formmains,data=(_dbData.formsons,_dbData.data),targetCtx="formmain"===tableCategory?formmains[data.tableInfo.formmain.tableName]:this._getRecordByTableAndId(tableName,updateRecordId).lists;__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(updateData).forEach(function(fieldName,fieldIndex){var field=targetCtx[fieldName],updated=updateData[fieldName];field&&(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(updated).forEach(function(name,index){var value=updated[name];"value"===name?field.valueId=value:"showValue2"===name?field.value=value:field[name]=value}),targetCtx[fieldName]=field)})},_doExternalFillAttachField:function(payload){var deferred=new __WEBPACK_IMPORTED_MODULE_3__utils_index__.c,tableCategory=payload.tableCategory,tableName=payload.tableName,fieldName=payload.fieldName,handlerMode=payload.handlerMode,updateRecordId=payload.updateRecordId,_dbData2=this.dbData,formmains=(_dbData2.formsons,_dbData2.formmains),data=_dbData2.data,targetCtx="formmain"===tableCategory?formmains[data.tableInfo.formmain.tableName]:this._getRecordByTableAndId(tableName,updateRecordId).lists,field=targetCtx[fieldName],attachData=field&&field.attachmentInfo,fieldAttachments=attachData&&attachData.attachmentInfos,fieldAttachBase=attachData&&attachData.baseAttachmentInfo;if(!fieldAttachments)return deferred.resolve(),deferred;var requestPayload={attachments:[],reference:fieldAttachBase.reference,subReference:fieldAttachBase.subReference,formMasterId:data.content.contentDataId};if("add"===handlerMode){var serverIp=__WEBPACK_IMPORTED_MODULE_4__utils_bridge_js__.a();payload.addAttchmentData.forEach(function(att){requestPayload.attachments.push(att),fieldAttachments.push(att),Array.isArray(field.value)&&("image"===att.type?field.value.push({url:serverIp+"/seeyon/fileUpload.do?method=showRTE&fileId="+att.fileUrl+"&createDate="+att.createdate+"&type=image&showType=small",bigUrl:serverIp+"/seeyon/fileUpload.do?method=showRTE&fileId="+att.fileUrl+"&createDate="+att.createdate+"&type=image&showType=big"}):"attachment"===att.type&&field.value.push({name:att.filename,size:att.size}))}),requestPayload.baseAttachmentInfo=fieldAttachBase}else"delete"===handlerMode&&payload.deleteAttchmentData.forEach(function(att){var index=-1;fieldAttachments.some(function(it,pos){return it.id===att&&(index=pos,!0)})&&(fieldAttachments.splice(index,1),requestPayload.type="delete",requestPayload.attachments.push({id:att}),Array.isArray(field.value)&&field.value.splice(index,1))});return requestPayload.attachments.length?__WEBPACK_IMPORTED_MODULE_2__business_utils_service__.j(requestPayload).then(function(res){return deferred.resolve(res)},function(err){return deferred.reject(err)}):deferred.resolve(),deferred}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__(204),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_2__utils_bridge__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_3__business_utils_field_types__=__webpack_require__(206),__WEBPACK_IMPORTED_MODULE_4__business_utils_special__=__webpack_require__(207),__WEBPACK_IMPORTED_MODULE_5__business_utils_service__=__webpack_require__(203),getAuxilaryUid=function(el,tableName,index){var ctrlType=el.ctrlType||"$";return index=void 0===index?"$":index,"auxiliary_"+ctrlType+"_"+tableName+"_"+index};__webpack_exports__.a={methods:{loadForm:function(){var _this=this;__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.b(function(){_this._isUnflow?_this.loadUnflowForm():_this._isPreview?_this.loadPreviewForm():_this.loadFlowForm()})},loadFlowForm:function(){var _this2=this;cmp.sui||(console.info("unexpected script execute order, \nexpect app.cap4Form.js executes before formmain-chunk.cap4Form.js"),cmp.sui={_readyCallbacks:[],isReady:!1,ready:function(cb){if(cmp.sui.isReady)return cb();cmp.sui._readyCallbacks.push(cb)},fireReady:function(){var callbacks=cmp.sui._readyCallbacks.slice(0);delete cmp.sui._readyCallbacks,delete cmp.sui.fireReady,cmp.sui.isReady=!0,callbacks.forEach(function(cb){return cb&&cb()})}}),cmp.sui.switchForm=function(cb){var dbData=_this2.dbData,data=dbData.data,viewIndex=dbData.viewIndex,pageParams=dbData.pageParams,phoneView=parseInt(data.viewInfo.phoneViewCount)<1,done=function(){_this2.clearFromStore(),cb&&cb({formMasterId:data.content.contentDataId,switchFrom:"origin",indexParam:viewIndex})};_this2.assertEmptyView(!1,phoneView)||(__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.d("\u4fdd\u5b58\u4e2d..."),_this2.saveToServer("save",!0,done,null,pageParams.params.moduleType,!0,{needCheckRule:"0",needDataUnique:"0",needSn:"0"}))},cmp.sui.loadForm=function(options,fn){var rightId=options.rightId,moduleId=options.moduleId,moduleType=options.moduleType,operateType=options.operateType,onChangeViewEvent=options.onChangeViewEvent,dbData=(options.indexParam,_this2.dbData);_this2.sentChangeViewEvent=onChangeViewEvent,_this2.onDetailPageScroll=options.onScroll,_this2.type=_this2._operateMap[operateType],dbData.flowParam=options,dbData.pageParams.params={rightId:rightId,moduleId:moduleId,moduleType:moduleType,operateType:operateType,formTemplateId:""},console.log("loadForm:",options),_this2.loadFormData("init",options,fn)},cmp.sui.loadFormDataFromCache=function(options){console.log("loadFormFromCache:",options);var callback=options.callback;_this2.getFromStore(options).then(function(storeData){_this2.processFormData("init",null,storeData),callback&&callback(!0)},function(){return callback&&callback(!1)})},cmp.sui.submit=function(options,fn,error){var notSaveDB=options.notSaveDB,needCheckRule=options.needCheckRule,needSn=options.needSn,checkNull=options.checkNull,pageParams=_this2.dbData.pageParams,performer={checkNull:checkNull?"1":"0",failed:error,success:fn},contentOpts={isMerge:notSaveDB?"1":"0",needCheckRule:!1===needCheckRule?"0":"1",needSn:needSn?"1":"0"};console.log("submit:",options),_this2.saveToServer("save",notSaveDB,function(){return console.log("form submit successfully")},performer,pageParams.params.moduleType,!1,contentOpts)},cmp.sui.getMainBodyData=function(key){return _this2.dbData.data.content[key]},cmp.sui.isPreventSubmit=function(){return!1},cmp.sui.hasEditRightOfFlowDealOption=function(){return!1},cmp.sui.clearCache=function(options){_this2.clearFromStore(options),_this2.removeSessionFormCache(!1)},cmp.sui.getFormProtectedData=function(useFieldIdAsKey,callback){var payload={formId:_this2.dbData.data.content.contentTemplateId,formMasterDataId:_this2.dbData.data.content.contentDataId,moduleId:_this2.dbData.data.content.moduleId,from:"originalForm",mergeData:_this2.dbData.pageParams.params&&"2"===_this2.dbData.pageParams.params.operateType?{}:_this2._buildSaveRequestParams("save",!0)};__WEBPACK_IMPORTED_MODULE_5__business_utils_service__.k(payload).then(function(res){var data=res.data.data;"function"==typeof callback&&callback(null,data||{})},function(err){"function"==typeof callback&&callback({message:"fetch data error!"},{})})},cmp.sui.fireReady()},loadUnflowForm:function(){this.type=this._formainParam.type,this.loadFormData("init")},loadPreviewForm:function(){var _formainQuery=this._formainQuery,dbData=this.dbData;this.type="new",dbData.pageParams.params={formId:_formainQuery.formId,viewId:_formainQuery.viewId},this.loadFormData("init")},loadFormData:function(type,opts,callback,forceFetch){var _this3=this,pageParams=this.dbData.pageParams;opts=opts||pageParams.params;var _opts=opts,summaryId=_opts.summaryId,storeKey=this._buildStoreKey(opts),isSwitched=!!pageParams.switchFrom,isFresh="1"!==sessionStorage.getItem(storeKey);forceFetch||isSwitched||isFresh?(console.log(["[load from remote]:",forceFetch,isSwitched,isFresh]),this.fetchFormData(type).then(function(res){isFresh&&sessionStorage.setItem(storeKey,"1"),_this3.processFormData(type,res.data,null,summaryId),callback&&callback()},function(err){return callback&&callback()})):this.getFromStore(opts,!0).then(function(storeData){console.log(["[load from store]:"]),_this3.processFormData(type,null,storeData,summaryId),callback&&callback()},function(){console.log(["[fetch data as no store]:",_this3.type]),_this3.fetchFormData(type).then(function(res){_this3.processFormData(type,res.data,null,summaryId),callback&&callback()},function(err){callback&&callback(),console.log("\u8868\u5355\u6570\u636e\u52a0\u8f7d\u5931\u8d25",err)})})},fetchFormData:function(type){var _this4=this,deferred=new __WEBPACK_IMPORTED_MODULE_1__utils_index__.c,_dbData=this.dbData,data=_dbData.data,pageParams=_dbData.pageParams,payload=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},pageParams.params,{from:"originalForm",formMasterId:"saveCopy"===type&&data.content?data.content.contentDataId:"saveNew"===type?"":pageParams.formMasterId||""}),hideLoading=function(){_this4._isUnflow&&"init"!==type&&__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.g()};return function(){_this4._isUnflow&&"init"!==type&&__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.d("\u6570\u636e\u52a0\u8f7d\u4e2d...")}(),deferred.then(hideLoading,function(reason){var message=reason&&reason.message;message||(message="\u8868\u5355\u6570\u636e\u52a0\u8f7d\u51fa\u9519",reason&&reason.code&&(message+="(code="+reason.code+")")),hideLoading(),__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.e({type:"warning",title:"\u63d0\u793a\u4fe1\u606f",text:message,buttons:["\u786e\u5b9a"],callback:function(){return __WEBPACK_IMPORTED_MODULE_2__utils_bridge__.f()}})}),console.time("\u8bf7\u6c42\u8868\u5355\u6570\u636e"),__WEBPACK_IMPORTED_MODULE_5__business_utils_service__.l(payload).then(function(res){console.timeEnd("\u8bf7\u6c42\u8868\u5355\u6570\u636e");var data=res.data;"2000"===data.code?deferred.resolve(data):deferred.reject(data)},function(error){return deferred.reject({code:"error",error:error})}),deferred},processFormData:function(type,data,storeData,summaryId){var _this5=this;if(console.time("[processFormData]"),this.isDataReady=!1,storeData&&!data)this.dbData=storeData;else{var isEmpty=!data.viewInfo.viewContent,initProps={data:data,formsons:{},formmains:{}};if(data.viewInfo.viewContent?data.viewInfo.viewContent=JSON.parse(data.viewInfo.viewContent):data.viewInfo.viewContent={},"saveNew"===type&&(initProps.relationSelector={}),this.dbData=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.a)({},this.dbData,initProps),!isEmpty&&data.viewInfo.viewContent.skin)return __WEBPACK_IMPORTED_MODULE_2__utils_bridge__.e({type:"warning",title:"\u63d0\u793a\u4fe1\u606f",text:"\u8868\u5355\u6570\u636e\u52a0\u8f7d\u51fa\u9519(\u539f\u6837\u8868\u5355\u8fd4\u56de\u4e86\u8f7b\u8868\u5355\u89c6\u56fe)",buttons:["\u786e\u5b9a"],callback:function(){return __WEBPACK_IMPORTED_MODULE_2__utils_bridge__.f()}});this.setRelationSelector(data.relationRecords)}var dbData=this.dbData;if(summaryId&&(dbData.data.content.moduleId=summaryId),this._isFlow&&dbData.data.content&&(dbData.data.content.allowQRScan=dbData.flowParam.allowQRScan),dbData.formsonDisplay="true"===this.printFlag?"default":dbData.data.viewInfo.viewContent.repeatTableDisplay,console.log("processFormData:",data),data){var _dbData$data=dbData.data,tableInfo=_dbData$data.tableInfo,viewInfo=_dbData$data.viewInfo,formmains=dbData.formmains,formsons=dbData.formsons,viewRoot=viewInfo.viewContent.children||[];this.$set(formmains,tableInfo.formmain.tableName,{}),viewRoot.forEach(function(viewEl,viewIndex){"table"!==viewEl.nodeType||viewEl.isMaster?_this5._processFormainRecord(viewIndex,viewEl):(_this5.$set(formsons,viewEl.tableName,{}),tableInfo.formson.forEach(function(tableField){if(tableField.frontTableName===viewEl.tableName){formsons[viewEl.tableName]={state:!0,frontTableName:viewEl.tableName,tableName:tableField.tableName,display:tableField.display,records:[],page:1,auth:viewInfo.authInfo[tableField.tableName],fieldInfo:tableField.fieldInfo},tableField.dataSubLineInfos.forEach(function(record,index){return _this5._processFormsonRecord(index,viewEl,tableField,record)}),formsons[viewEl.tableName].templateRecord=_this5.formatTemplate(formsons[viewEl.tableName].records[0]);var defaultRows=viewEl.defaultRows,records=formsons[viewEl.tableName].records;formsons[viewEl.tableName].records=_this5._setNullRecords(defaultRows,records)}}))}),this.assertEmptyView(!0,0===viewRoot.length,!0)}var _ref=dbData.data.content||{},formsonNumThreshold=_ref.formsonNumThreshold;formsonNumThreshold&&__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.e({type:"alert",title:"",text:"\u5355\u4e2a\u660e\u7ec6\u8868\u5df2\u8d85\u8fc7"+formsonNumThreshold+"\u6761\u6570\u636e\uff0c\u6b64\u8868\u5355\u53ea\u80fd\u6d4f\u89c8\u67e5\u770b\uff0c\u5982\u9700\u8981\u7f16\u8f91\uff0c\u8bf7\u4f7f\u7528\u7535\u8111\u7aef\u64cd\u4f5c",buttons:["\u786e\u5b9a"]}),this.isDataReady=!0,console.timeEnd("[processFormData]")},_processFormainRecord:function(index,viewEl){var _this6=this,_dbData$data2=this.dbData.data,tableInfo=_dbData$data2.tableInfo,viewInfo=_dbData$data2.viewInfo,formmains=this.dbData.formmains,tableName=tableInfo.formmain.tableName;("table"===viewEl.nodeType?viewEl.cells:[viewEl]).forEach(function(item,itemIndex){var childEl=item.children?item.children[0]:item;if(childEl){var isAuxilary=-1!==__WEBPACK_IMPORTED_MODULE_3__business_utils_field_types__.a.auxiliary.indexOf(childEl.ctrlType),elAttr=childEl.attrs||{};isAuxilary&&(childEl.id=getAuxilaryUid(childEl,tableName,index+"-"+itemIndex));var fieldData=tableInfo.formmain.fieldInfo[childEl.id],authData=viewInfo.authInfo[childEl.id],valueAndAuth=void 0,stdData={id:childEl.id,type:childEl.type,ctrlType:childEl.ctrlType,placeHolder:elAttr.placeHolder,ctrlTitleStyle:elAttr.ctrlTitleStyle,ctrlBorderStyle:elAttr.ctrlBorderStyle,radioAlignType:elAttr.radioAlignType,display:childEl.display,extra:childEl.styles,attrs:elAttr,formType:"formmain"};if(!elAttr.src||elAttr.src.startsWith("http")||elAttr.src.startsWith("https")||(elAttr.src=""+__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.a()+elAttr.src),isAuxilary||_this6._isPreview)valueAndAuth={valueId:"",value:"",showValue:"",attachmentInfo:{},enums:fieldData?fieldData.enums:[],isInCalculate:"",isInCondition:"",isAttachment:!!fieldData&&"1"===fieldData.isAttachment,isCustomField:!!fieldData&&"1"===fieldData.isCustomField,formatType:"",inputType:fieldData?fieldData.inputType:"",fieldType:fieldData?fieldData.fieldType:"",digitNum:"",fieldLength:"",relation:"",relationData:"",customFieldInfo:fieldData&&"1"===fieldData.isCustomField?fieldData.customFieldInfo:null,auth:"add",isNotNull:"0",isAuxilary:isAuxilary?"1":"0",isDataInvalid:"0"};else{var fieldLength="text"===fieldData.inputType&&"VARCHAR"===fieldData.fieldType||"textarea"===fieldData.inputType?Math.floor(fieldData.fieldLength/3):fieldData.fieldLength;valueAndAuth={valueId:fieldData.value,value:fieldData.showValue2,showValue:fieldData.showValue,attachmentInfo:fieldData.attachmentInfo,enums:fieldData.enums,isInCalculate:fieldData.isInCalculate,isInCondition:fieldData.isInCondition,isAttachment:"1"===fieldData.isAttachment,isCustomField:"1"===fieldData.isCustomField,formatType:fieldData.formatType,inputType:fieldData.inputType,fieldType:fieldData.fieldType,digitNum:fieldData.digitNum,fieldLength:fieldLength,relation:fieldData.relationInfo||{},relationData:fieldData.relationData||"",triggerData:fieldData.triggerData||"",customFieldInfo:"1"===fieldData.isCustomField?fieldData.customFieldInfo:null,auth:authData.auth,isNotNull:authData.isNotNull,isAuxilary:"0",isDataInvalid:"0"}}__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.a)(stdData,valueAndAuth),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__business_utils_special__.a)(stdData),_this6.$set(formmains[tableName],stdData.id,stdData)}})},_processFormsonRecord:function(index,tableEl,tableField,record){var _this7=this,_dbData$data3=(this.getBaseStyles(),this.dbData.data),viewInfo=_dbData$data3.viewInfo,tableInfo=_dbData$data3.tableInfo,_dbData2=this.dbData,formmains=_dbData2.formmains,formsons=_dbData2.formsons,masterName=tableInfo.formmain.tableName,tableName=tableEl.tableName,repeatStartIndex=tableEl.repeatStartIndex,repeatEndIndex=tableEl.repeatEndIndex,fieldInfo=tableField.fieldInfo,recordId=record.recordId,formson=formsons[tableName],stdRecord={recordId:recordId,listsIndex:[],lists:{}};formson.records.push(stdRecord),tableEl.cells.forEach(function(viewEl,viewIndex){var childEl=viewEl.children&&viewEl.children[0];if(childEl){var elAttr=childEl.attrs||{},isSummary=viewEl.rowIndex>=repeatStartIndex&&viewEl.rowIndex<=repeatEndIndex,isAuxilary=-1!==__WEBPACK_IMPORTED_MODULE_3__business_utils_field_types__.a.auxiliary.indexOf(childEl.ctrlType);isAuxilary&&(childEl.id=getAuxilaryUid(childEl,tableName,viewIndex));var masterField=tableInfo.formmain.fieldInfo[childEl.id],summaryField=fieldInfo[childEl.id],fieldData=summaryField||masterField,recordData=isSummary?record[childEl.id]:masterField,authKey=isSummary?childEl.id+"_"+recordId:childEl.id,authData=viewInfo.authInfo[authKey],valueAndAuth=void 0,stdData={id:childEl.id,type:childEl.type,ctrlType:childEl.ctrlType,placeHolder:elAttr.placeHolder,ctrlTitleStyle:elAttr.ctrlTitleStyle,ctrlBorderStyle:elAttr.ctrlBorderStyle,radioAlignType:elAttr.radioAlignType,display:childEl.display,extra:childEl.styles,attrs:elAttr,formType:"formson",recordId:isSummary?recordId:""};if(!elAttr.src||elAttr.src.startsWith("http")||elAttr.src.startsWith("https")||(elAttr.src=""+__WEBPACK_IMPORTED_MODULE_2__utils_bridge__.a()+elAttr.src),isAuxilary||_this7._isPreview)valueAndAuth={valueId:"",value:"",showValue:"",attachmentInfo:{},enums:recordData?recordData.enums||fieldData.enums:[],isInCalculate:"",isInCondition:"",isAttachment:!!fieldData&&"1"===fieldData.isAttachment,isCustomField:!!fieldData&&"1"===fieldData.isCustomField,formatType:"",inputType:fieldData?fieldData.inputType:"",fieldType:fieldData?fieldData.fieldType:"",fieldLength:"",relation:"",relationData:"",triggerData:"",customFieldInfo:fieldData&&"1"===fieldData.isCustomField?fieldData.customFieldInfo:null,auth:"add",isNotNull:"0",isAuxilary:isAuxilary?"1":"0",isDataInvalid:"0"};else{var fieldLength="text"===fieldData.inputType&&"VARCHAR"===fieldData.fieldType||"textarea"===fieldData.inputType?Math.floor(fieldData.fieldLength/3):fieldData.fieldLength;valueAndAuth={valueId:recordData.value,value:recordData.showValue2,showValue:recordData.showValue,attachmentInfo:recordData.attachmentInfo,enums:recordData.enums||fieldData.enums,isInCalculate:fieldData.isInCalculate,isInCondition:fieldData.isInCondition,isAttachment:"1"===fieldData.isAttachment,isCustomField:"1"===fieldData.isCustomField,formatType:fieldData.formatType,inputType:fieldData.inputType,fieldType:fieldData.fieldType,digitNum:fieldData.digitNum,fieldLength:fieldLength,relation:fieldData.relationInfo||{},relationData:isSummary?recordData.relationData||"":masterField.relationData||"",triggerData:isSummary?recordData.triggerData||"":masterField.triggerData||"",customFieldInfo:"1"===fieldData.isCustomField?fieldData.customFieldInfo:null,auth:authData.auth,isNotNull:authData.isNotNull,isAuxilary:"0",isDataInvalid:"0"}}__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.a)(stdData,valueAndAuth),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__business_utils_special__.a)(stdData),isSummary?(stdRecord.listsIndex.push(stdData.id),_this7.$set(stdRecord.lists,stdData.id,stdData)):_this7.$set(formmains[masterName],stdData.id,stdData)}})},_setNullRecords:function(defaultRows,records){if(records.length>=defaultRows)return records;for(var delta=defaultRows-records.length,i=0;i<delta;i++)records.push(null);return records},formatTemplate:function(data){var record=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__utils_index__.b)(!0,data),lists=record.lists;for(var i in lists)lists[i].value="",lists[i].showValue="",lists[i].valueId="",lists[i].attachmentInfo=lists[i].attachmentInfo&&lists[i].attachmentInfo.attachmentInfos?{attachmentInfos:[],baseAttachmentInfo:lists[i].attachmentInfo.baseAttachmentInfo}:{};return record}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__(204),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_2__utils_hub__=__webpack_require__(224),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__=__webpack_require__(208);__webpack_exports__.a={methods:{initFormmainEvent:function(){var _this=this;__WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.b(function(){_this._isUnflow&&(cmp.backbutton(),cmp.backbutton.push(function(){var type="new"!==_this.type||_this._isPreview?"":"close";_this.closeWebView(type)})),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__.a.$on("setCurIndexToFormmain",function(evt){var curIndex=evt.curIndex,frontTableName=evt.frontTableName;_this.curIndexMap[frontTableName]=curIndex}),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__.a.$on("newFormsonEvent",function(evt){var frontTableName=evt.frontTableName,index=evt.index,tableName=evt.tableName,data=_this.dbData.formsons[frontTableName].records,params={formMasterId:_this.dbData.data.content.contentDataId,formId:_this.dbData.data.content.contentTemplateId,tableName:tableName,recordIds:[""],type:"add",rightId:_this.dbData.data.content.rightId};void 0==data[index]&&_this.newFormson(params,frontTableName,index)}),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__.a.$on("deleteFormsonEvent",function(evt){var frontTableName=evt.frontTableName,index=evt.index;evt.cb;if(void 0==index)return void __WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.h("\u8bf7\u9009\u62e9\u4e00\u6761\u6570\u636e!","center",2e3);_this.deleteFormson(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({recordId:_this.dbData.formsons[frontTableName].records[index].recordId},evt))}),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__.a.$on("refreshScroll",function(e){_this.refreshScroll()}),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__.a.$on("deleteAllFormsonEvent",function(evt){_this.deleteAllFormson(evt)}),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__.a.$on("InsertFormsonEvent",function(evt){var cb=evt.cb;_this.InsertFormson(cb)}),__WEBPACK_IMPORTED_MODULE_3__utils_eventBus__.a.$on("copyFormsonEvent",function(evt){var frontTableName=evt.frontTableName,index=evt.index,cb=evt.cb;if(void 0==index)return void __WEBPACK_IMPORTED_MODULE_1__utils_bridge_js__.h("\u8bf7\u9009\u62e9\u4e00\u6761\u6570\u636e\uff01","center",1500,0);_this.copyFormson({recordId:_this.dbData.formsons[frontTableName].records[index].recordId,frontTableName:frontTableName,index:index,cb:cb})}),__WEBPACK_IMPORTED_MODULE_2__utils_hub__.b("com.seeyon.m3.SYNC_DB_DATA",function(e){var data=e.data,payload=data.data||{},recordType=payload.recordType,recordId=payload.recordId,recordTable=payload.recordTable,frontTable=payload.frontTable,recordEvent=void 0;"formmain"==data.target&&data.DBKey==_this._buildStoreKey()&&_this.getFromStore().then(function(cacheData){_this.dbData=cacheData,_this.setCalculateLock(),"formson"===data.from?recordEvent="edit"===recordType?"recordUpdated":"recordInserted":"relation"===data.from&&(recordEvent="new"===recordType?"recordInserted":""),recordEvent&&_this.emitForm(recordEvent,{recordId:recordId,recordTable:recordTable,frontTable:frontTable})})});var handleRedirect=function(evt){console.log("beforepageredirect:",evt);var data=evt.data||{},done=data.done,location=data.location,cb=function(){return done&&done()};"changeFormType"in data||("server"===location?_this.saveToServer("save",!0,cb,null,_this.dbData.pageParams.params.moduleType,!0,{needCheckRule:"0",needDataUnique:"0",needSn:"0"}):_this.saveToStore().then(cb,cb))};document.addEventListener("beforeviewleave",handleRedirect,!1),document.addEventListener("beforepageredirect",handleRedirect,!1)})}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray__=__webpack_require__(205),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_3__utils_index__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_4__business_utils_service__=__webpack_require__(203);__webpack_exports__.a={methods:{clearRecordData:function(fieldInfo){__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(fieldInfo||{}).forEach(function(fieldId){var info=fieldInfo[fieldId];info&&(info.triggerData="",info.relationData="",info.valueId="",info.showValue="",info.value instanceof Array?info.value.splice(0):info.value="",info.attachmentInfo&&info.attachmentInfo.attachmentInfos instanceof Array&&info.attachmentInfo.attachmentInfos.splice(0),info.isCustomField&&info.customFieldInfo&&(info.customFieldInfo=null))})},deleteFormson:function(extra){var _this=this,_dbData=this.dbData,data=_dbData.data,formsons=_dbData.formsons,frontTableName=extra.frontTableName,cb=(extra.defaultRows,extra.cb);__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.e({type:"warning",title:"\u63d0\u793a\u6d88\u606f",text:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u5f53\u524d\u8bb0\u5f55\u5417\uff1f",buttons:["\u53d6\u6d88","\u786e\u5b9a"],callback:function(index){if(1===index){var params={formMasterId:data.content.contentDataId,formId:data.content.contentTemplateId,tableName:formsons[frontTableName].tableName,recordIds:[extra.recordId],type:"delete",rightId:data.content.rightId,mergeData:_this._buildSaveRequestParams("save",!0)};__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.d("\u5220\u9664\u4e2d..."),__WEBPACK_IMPORTED_MODULE_4__business_utils_service__.c(params).then(function(res){var _res$data=res.data,data=(_res$data.code,_res$data.data);__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),_this._manipulateForm(data.tableData,{record:function(action,payload){console.log([action,payload]);var table=payload.table,records=payload.records;if(table.frontTableName===frontTableName&&"add"===action){var _table$records;(_table$records=table.records).unshift.apply(_table$records,__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default()(records))}}},cb)},function(){__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.h("\u64cd\u4f5c\u5931\u8d25","center",1500,0)})}}})},deleteAllFormson:function(extra){var _this2=this,_dbData2=this.dbData,data=_dbData2.data,formsons=_dbData2.formsons,frontTableName=extra.frontTableName,cb=(extra.defaultRows,extra.cb),recordsObj=this.getRecordIds(frontTableName);__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.e({type:"warning",title:"\u63d0\u793a\u6d88\u606f",text:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u660e\u7ec6\u8868\u7684\u6240\u6709\u8bb0\u5f55\u5417\uff1f",buttons:["\u53d6\u6d88","\u786e\u5b9a"],callback:function(index){if(1===index){var params={formMasterId:data.content.contentDataId,formId:data.content.contentTemplateId,tableName:formsons[frontTableName].tableName,recordIds:recordsObj.ids,type:"delete",rightId:data.content.rightId,mergeData:_this2._buildSaveRequestParams("save",!0)};__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.d("\u5220\u9664\u4e2d..."),__WEBPACK_IMPORTED_MODULE_4__business_utils_service__.c(params).then(function(res){var _res$data2=res.data,data=(_res$data2.code,_res$data2.data);__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),_this2._manipulateForm(data.tableData,{record:function(action,payload){console.log([action,payload]);var table=payload.table,records=payload.records;if(table.frontTableName===frontTableName&&"add"===action){var _table$records2;(_table$records2=table.records).unshift.apply(_table$records2,__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default()(records))}}},cb)},function(err){__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.h("\u64cd\u4f5c\u5931\u8d25","center",1500,0)})}}})},copyFormson:function(extra){var _this3=this,_dbData3=this.dbData,data=_dbData3.data,formsons=_dbData3.formsons,frontTableName=extra.frontTableName,index=extra.index,recordId=extra.recordId,cb=extra.cb,params={formMasterId:data.content.contentDataId,formId:data.content.contentTemplateId,tableName:formsons[frontTableName].tableName,recordIds:[recordId],type:"copy",rightId:data.content.rightId,mergeData:this._buildSaveRequestParams("save",!0)};__WEBPACK_IMPORTED_MODULE_4__business_utils_service__.c(params).then(function(res){var _res$data3=res.data,data=(_res$data3.code,_res$data3.data);_this3._manipulateForm(data.tableData,{record:function(action,payload){console.log([action,payload]);var table=payload.table,records=payload.records;if("add"===action){var _table$records3;(_table$records3=table.records).splice.apply(_table$records3,[index+1,0].concat(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default()(records)))}}},cb)},function(err){__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.h("\u64cd\u4f5c\u5931\u8d25","center",1500,0)})},InsertFormson:function(cb){cb()},doRecordsAppend:function(records,index,newRecords){if(index>=records.length)return records.push.apply(records,__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_toConsumableArray___default()(newRecords));for(var pos=index,i=0;i<(newRecords||[]).length;i++){var newRecord=newRecords[i];records[pos]?records.splice(pos+1,0,newRecord):records.splice(pos,1,newRecord),pos+=1}},newFormson:function(params,frontTableName,index){var _this4=this,formsons=this.dbData.formsons,data=(__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__utils_index__.b)(!0,formsons[frontTableName].templateRecord),formsons[frontTableName].records);params.preRecordId=this.getPreRecordId(data,index),params.mergeData||(params.mergeData=this._buildSaveRequestParams("save",!0)),__WEBPACK_IMPORTED_MODULE_4__business_utils_service__.c(params).then(function(res){var _res$data4=res.data,data=(_res$data4.code,_res$data4.data);_this4._manipulateForm(data.tableData,{record:function(action,payload){console.log([action,payload]);var table=payload.table,records=payload.records;"add"===action&&_this4.doRecordsAppend(table.records,index,records)}})},function(){__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.g(),__WEBPACK_IMPORTED_MODULE_2__utils_bridge_js__.h("\u64cd\u4f5c\u5931\u8d25","center",1500,0)})},checkIsLastRecords:function(frontTableName){for(var records=this.dbData.formsons[frontTableName].records,count=0,i=0;i<records.length;i++)if(null!=records[i]&&count++,2==count)return!1;return!0},getFirstValidRecord:function(frontTableName){for(var records=this.dbData.formsons[frontTableName].records,i=0;i<records.length;i++)if(null!=records[i])return records[i];return null},updataRecordId:function(template,recordId){for(var i in template.lists)template.lists[i].recordId=recordId;return template},getRecordIds:function(frontTableName){for(var records=this.dbData.formsons[frontTableName].records,count=0,index=0,ids=[],firstRecords=void 0,i=0;i<records.length;i++)null!=records[i]&&(0==count++&&(index=i,firstRecords=records[i]),ids.push(records[i].recordId));return{ids:ids,index:index,firstRecords:firstRecords}},cleanRecords:function(frontTableName,defaultRows,recordObj){var records=this.dbData.formsons[frontTableName].records,firstRecords=recordObj.firstRecords;recordObj.index;records.splice(1,records.length-1);for(var i=0;i<defaultRows;i++)0==i?records.splice(0,1,firstRecords):records.push(null)}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"i",function(){return imagesBrowser}),__webpack_require__.d(__webpack_exports__,"j",function(){return filesBrowser}),__webpack_require__.d(__webpack_exports__,"d",function(){return imagesEvent}),__webpack_require__.d(__webpack_exports__,"e",function(){return attachmentEvent}),__webpack_require__.d(__webpack_exports__,"b",function(){return timeEvent}),__webpack_require__.d(__webpack_exports__,"c",function(){return organizeEvent}),__webpack_require__.d(__webpack_exports__,"a",function(){return location}),__webpack_require__.d(__webpack_exports__,"h",function(){return relationDoc}),__webpack_require__.d(__webpack_exports__,"f",function(){return mark}),__webpack_require__.d(__webpack_exports__,"g",function(){return photoLocation});var __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__=__webpack_require__(202),__WEBPACK_IMPORTED_MODULE_1__business_utils_relationDoc__=__webpack_require__(260),imagesBrowser=function(urls,index){__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.r(urls,index)},filesBrowser=function(data){__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.s(data)},imagesEvent=function(options){var type=options.type,params=options.params,index=options.index,formData=options.formData;if("browse"===type)imagesBrowser(params.value,index);else if("upload"===type){var maxSize=params.attachmentInfo.baseAttachmentInfo.maxImgSize;if(params.value.length>=Number(maxSize))return void __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u4f60\u6700\u591a\u53ea\u80fd\u4e0a\u4f20"+maxSize+"\u5f20\u56fe\u7247","center",1500,0);__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.t(params,""+(Number(maxSize)-params.value.length),{success:function(data,index){var attachInfo={id:data.id,fileUrl:data.fileUrl,size:data.size,createdate:data.createdate,filename:data.filename};params.attachmentInfo.attachmentInfos.push(attachInfo);var url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/fileUpload.do?method=showRTE&fileId="+data.fileUrl+"&createDate="+data.createdate+"&type=image&showType=small";params.value.splice(index,1,url),params.uploadState.splice(index,1,!0);var updateParams={attachments:[attachInfo],reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(){},error:function(){}})},error:function(){}})}else if("close"===type){var updateParams={attachments:params.attachmentInfo.attachmentInfos.slice(index,index+1),reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId,type:"delete"};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(result){result.data&&"2000"===result.data.code&&(params.value.splice(index,1),params.uploadState.splice(index,1),params.attachmentInfo.attachmentInfos.splice(index,1))},error:function(){}})}},attachmentEvent=function(options){var type=options.type,params=options.params,index=options.index,formData=options.formData;if("browse"===type){var currentFile=params.attachmentInfo.attachmentInfos[index],data={path:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/fileDownload.do?method=doDownload&fileId="+currentFile.fileUrl+"&createDate="+currentFile.createdate+"&filename="+currentFile.filename+"&v="+currentFile.v,filename:currentFile.filename,fileId:currentFile.fileUrl,lastModified:currentFile.createdate};filesBrowser(data)}else if("upload"===type)__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.u(params,{success:function(files,data){var attachInfo={id:data.id,fileUrl:data.fileUrl,size:data.size,createdate:data.createdate,filename:data.filename,v:data.v};params.attachmentInfo.attachmentInfos.push(attachInfo),params.value.push(files);var updateParams={attachments:[attachInfo],reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(){},error:function(){}})},error:function(){},cancel:function(){}});else if("close"===type){var updateParams={attachments:params.attachmentInfo.attachmentInfos.slice(index,index+1),reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId,type:"delete"};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(result){result.data&&"2000"===result.data.code&&(params.value.splice(index,1),params.attachmentInfo.attachmentInfos.splice(index,1))},error:function(){}})}},timeEvent=function(type,params){"close"===type?params.value="":__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.v(params,function(value){params.value=value})},organizeEvent=function(type,params){if("close"===type)params.value="",params.valueId="",params.showValue="";else if("choose"===type){var ret=[];params.value&&params.value.split(",").forEach(function(v){ret.push({id:v.split("|")[0],name:v.split("|")[1],type:-1===params.type.indexOf("multi")?params.type:params.type.substr(5,params.type.length)})}),__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.w(params,{fillBackData:ret,excludeData:[],callback:function(result){var ids=[],values=[],showValues=[];result.forEach(function(v){values.push(v.id+"|"+v.name),ids.push(""+v.id),showValues.push(v.name)}),params.value=values.join(","),params.valueId=ids.join(","),params.showValue=showValues.join(",")},closeCallback:function(){}})}},location=function(type,params){if(!cmp.platform.CMPShell)return void __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u5fae\u534f\u540c\u4e0d\u652f\u6301\u4f4d\u7f6e\u5b9a\u4f4d!","center",1500,0);var origin=params.placeHolder;"browse"===type?__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.x(params):"get"===type?(params.placeHolder="\u6b63\u5728\u5b9a\u4f4d...",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.y(params,{success:function(value,id){console.log("location",value,id),params.value=value.lbsAddr,params.valueId=id,params.placeHolder=origin},error:function(e){console.log("location-error",e)}})):"close"===type&&(params.value="",params.valueId="",params.placeHolder=origin)},relationDoc=function(options){var type=options.type,params=options.params,index=options.index,formData=options.formData;if("browse"===type){var currentFile=params.attachmentInfo.attachmentInfos[index],baseObjectId=params.attachmentInfo.baseAttachmentInfo.reference,category=params.attachmentInfo.baseAttachmentInfo.category,url=void 0,data=void 0;switch(currentFile.mimeType){case"meeting":data={openFrom:"glwd",meetingId:currentFile.description,baseApp:category,baseObjectId:baseObjectId},url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.meeting+"/html/meetingDetail.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,data,"all");break;case"collaboration":data={openFrom:"glwd",affairId:currentFile.description,baseApp:1,baseObjectId:baseObjectId},window.summaryBO&&window.summaryBO.summary&&(data.baseObjectId=window.summaryBO.summary.id),url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.collaboration+"/html/details/summary.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,data,"all");break;case"edoc":data={listType:"glwd",openFrom:"glwd",summaryId:currentFile.description,baseApp:category,baseObjectId:baseObjectId},url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.edoc+"/html/edocSummary.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,data,"all");break;case"km":case"docFile":__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__business_utils_relationDoc__.a)(currentFile.description,currentFile)}}else if("upload"===type)__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.A(params,{success:function(fileurls){var selectedIdMap={},newSelectedIdMap={};params.attachmentInfo.attachmentInfos.forEach(function(item,index){selectedIdMap[item.fileUrl]=""}),fileurls.forEach(function(v,i){var data=JSON.parse(v);if(selectedIdMap.hasOwnProperty(data.fileUrl))newSelectedIdMap[data.fileUrl]="";else{var fileName="",genesisId="",description="",fileUrl="";switch(data.type){case"collaboration":fileName=data.subject,genesisId=data.startMemberId,description=data.affairId,fileUrl=data.affairId;break;case"edoc":fileName=data.docName||data.secretLevelName,genesisId=data.summary.startUserId,description=data.affairId,fileUrl=data.affairId;break;case"km":case"docFile":fileName=data.docName,genesisId=data.fr_id,description=data.fr_id,fileUrl=data.fr_id,data.type="km";break;case"meeting":break;default:2!==data.type&&"2"!==data.type||(fileName=data.subject,genesisId=data.startMemberId,description=data.summaryId,fileUrl=data.affairId)}newSelectedIdMap[fileUrl]="";var attachInfo={id:data.id||"",fileUrl:fileUrl,size:data.size||"0",createdate:data.createDate||"",filename:fileName,v:data.v||"",mimeType:data.type,genesisId:genesisId,description:description,sort:params.attachmentInfo.attachmentInfos.length+i};params.attachmentInfo.attachmentInfos.push(attachInfo),params.value.push({name:fileName,size:data.size||"0",type:data.type})}});for(var len=params.attachmentInfo.attachmentInfos.length,i=0;i<len;){var item=params.attachmentInfo.attachmentInfos[i];newSelectedIdMap.hasOwnProperty(item.fileUrl)?i++:(params.attachmentInfo.attachmentInfos.splice(i,1),params.value.splice(i,1),len--)}var updateParams={attachments:params.attachmentInfo.attachmentInfos,reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId,subType:"document"};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(){},error:function(){}})},error:function(){},cancel:function(){}});else if("close"===type){var updateParams={attachments:params.attachmentInfo.attachmentInfos.slice(index,index+1),reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId,subType:"document",type:"delete"};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(result){result.data&&"2000"===result.data.code&&(params.value.splice(index,1),params.attachmentInfo.attachmentInfos.splice(index,1))},error:function(){}})}},mark=function(type,params){if(!cmp.platform.CMPShell)return void __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u5fae\u534f\u540c\u4e0d\u652f\u6301\u5730\u56fe\u6807\u6ce8!","center",1500,0);"browse"===type?__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.x(params):"get"===type?__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.B(params,{success:function(value,id){params.value={text:value.lbsAddr,url:""},params.valueId=id},error:function(){}}):"close"===type&&(params.value.text="",params.value.url="",params.valueId="")},photoLocation=function(options){var type=options.type,params=options.params,index=options.index,formData=options.formData;if(!cmp.platform.CMPShell)return void __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u5fae\u534f\u540c\u4e0d\u652f\u6301\u62cd\u7167\u5b9a\u4f4d!","center",1500,0);if("browse"===type)imagesBrowser([params.value[0].url],index);else if("browserLocation"===type)__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.x(params);else if("upload"===type){if(params.value.length&&params.value[0])return void __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.e({type:"warning",title:"\u63d0\u793a\u6d88\u606f",text:"\u7167\u7247\u5df2\u5b58\u5728\uff0c\u662f\u5426\u66f4\u65b0\uff1f",buttons:["\u786e\u5b9a","\u53d6\u6d88"],callback:function(i){0===i&&__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.C(params,{success:function(data,lbsAddr,id,ind){var attachInfo={id:data.id,fileUrl:data.fileUrl,size:data.size,createdate:data.createdate,filename:data.filename,subReference:id};params.attachmentInfo.baseAttachmentInfo.subReference=id;var v={url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/fileUpload.do?method=showRTE&fileId="+data.fileUrl+"&createDate="+data.createdate+"&type=image&showType=small",location:lbsAddr};params.attachmentInfo.attachmentInfos.push(attachInfo),params.value.splice(ind,1,v),params.uploadState.splice(ind,1,!0),params.valueId=id;var updateParams={attachments:[attachInfo],reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(){},error:function(){}})},error:function(){}})}});__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.C(params,{success:function(data,lbsAddr,id,ind){var attachInfo={id:data.id,fileUrl:data.fileUrl,size:data.size,createdate:data.createdate,filename:data.filename,subReference:id};params.attachmentInfo.baseAttachmentInfo.subReference=id;var v={url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/fileUpload.do?method=showRTE&fileId="+data.fileUrl+"&createDate="+data.createdate+"&type=image&showType=small",location:lbsAddr};params.attachmentInfo.attachmentInfos.push(attachInfo),params.value.splice(ind,1,v),params.uploadState.splice(ind,1,!0),params.valueId=id;var updateParams={attachments:[attachInfo],reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(){},error:function(){}})},error:function(){}})}else if("close"===type){var updateParams={attachments:params.attachmentInfo.attachmentInfos.slice(index,index+1),reference:params.attachmentInfo.baseAttachmentInfo.reference,subReference:params.attachmentInfo.baseAttachmentInfo.subReference,baseAttachmentInfo:params.attachmentInfo.baseAttachmentInfo,formMasterId:formData.content.contentDataId,type:"delete"};__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"POST",data:updateParams,url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/cap4/form/addOrDelAttachment",success:function(result){result.data&&"2000"===result.data.code&&(params.value.splice(index,1),params.uploadState.splice(index,1),params.attachmentInfo.attachmentInfos.splice(index,1),params.valueId="")},error:function(){}})}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return docJumpPage});var __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__=__webpack_require__(202),docJumpPage=function(docResourceId,loadParam,att){__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"GET",url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/doc/"+docResourceId+"?option.n_a_s=1",success:function(ret1){var _ref=ret1||{},frType=_ref.frType,pigeonholeType=_ref.pigeonholeType,sourceId=_ref.sourceId;if(void 0===frType)return __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u4e0d\u652f\u6301\u67e5\u770b","center",1500,0);__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"GET",url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/doc/canOppen?drId="+docResourceId+"&frType="+frType+"&entranceType=8&option.n_a_s=1",success:function(ret2){if("1"==ret2)return __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u4e0d\u652f\u6301\u67e5\u770b","center",1500,0);"51"==frType?__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.k({type:"GET",url:__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.a()+"/seeyon/rest/doc/docView?drId="+docResourceId+"&option.n_a_s=1",success:function(ret3){sourceId=ret3.sourceId,docResourceId=ret3.id,frType=ret3.frType,openDoc(sourceId,docResourceId,frType,pigeonholeType,loadParam,att)},error:function(){__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u4e0d\u652f\u6301\u67e5\u770b","center",1500,0)}}):openDoc(sourceId,docResourceId,frType,pigeonholeType,loadParam,att)},error:function(){__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u4e0d\u652f\u6301\u67e5\u770b","center",1500,0)}})},error:function(err){__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u4e0d\u652f\u6301\u67e5\u770b","center",1500,0)}})},openDoc=function(sourceId,docResourceId,frType,pigeonholeType,loadParam,att){var url,att=(loadParam.document||document,att||{});if(1==frType||9==frType){var paramData={openFrom:"docLib",affairId:sourceId,pigeonholeType:pigeonholeType||"",docResId:docResourceId,baseApp:att.category||"",baseObjectId:att.reference||""};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.collaboration+"/html/details/summary.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else if(2==frType){var paramData={listType:"glwd",openFrom:"docLib",summaryId:sourceId,docResId:docResourceId,baseApp:att.category||"",baseObjectId:att.reference||""};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.edoc+"/html/edocSummary.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else if(4==frType){var paramData={listType:"glwd",openFrom:"docLib",meetingId:sourceId,docResId:docResourceId,baseApp:att.category||"",baseObjectId:att.reference||""};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.meeting+"/html/meetingDetail.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else if(5==frType){var paramData={comeFrom:1,newsId:sourceId,pageInfo:loadParam.pageInfo};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.news+"/html/newsView.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else if(6==frType){var paramData={comeFrom:1,bulId:sourceId,pageInfo:loadParam.pageInfo};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.bulletin+"/html/bulView.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else if(7==frType){var paramData={comeFrom:1,inquiryId:sourceId,pageInfo:loadParam.pageInfo};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.inquiry+"/html/inquiryView.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else if(8==frType){var paramData={from:"pigeonhole",bbsId:sourceId,pageInfo:loadParam.pageInfo};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.bbs+"/html/bbsView.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else if(frType>=101&&frType<=122||frType>=21&&frType<=26){var paramData={drId:docResourceId,pageInfo:loadParam.pageInfo,glwd:!0};url=__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.z.doc+"/html/docView.html",__WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.j(url,paramData,"all")}else __WEBPACK_IMPORTED_MODULE_0__utils_bridge_js__.h("\u4e0d\u652f\u6301\u67e5\u770b","center",1500,0)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Event});var Event=function(){return function(){var _listen,_trigger,_remove,_create,_shift=(Array.prototype.slice,Array.prototype.shift),_unshift=Array.prototype.unshift,namespaceCache={},each=function(ary,fn){for(var ret,i=0,l=ary.length;i<l;i++){var n=ary[i];ret=fn.call(n,i,n)}return ret};return _listen=function(key,fn,cache){cache[key]||(cache[key]=[]),cache[key].push(fn)},_remove=function(key,cache,fn){if(cache[key])if(fn)for(var i=cache[key].length;i>=0;i--)cache[key][i]===fn&&cache[key].splice(i,1);else cache[key]=[]},_trigger=function(){var cache=_shift.call(arguments),key=_shift.call(arguments),args=arguments,_self=this,stack=cache[key];if(stack&&stack.length)return each(stack,function(){this.apply(_self,args)})},_create=function(namespace){var namespace=namespace||"default",cache={},offlineStack=[],ret={listen:function(key,fn,last){_listen(key,fn,cache),null!==offlineStack&&("last"===last?offlineStack.length&&offlineStack.pop()():each(offlineStack,function(){this()}),offlineStack=null)},one:function(key,fn,last){_remove(key,cache),this.listen(key,fn,last)},remove:function(key,fn){_remove(key,cache,fn)},trigger:function(){var fn,args,_self=this;return _unshift.call(arguments,cache),args=arguments,fn=function(){return _trigger.apply(_self,args)},offlineStack?offlineStack.push(fn):fn()}};return namespace?namespaceCache[namespace]?namespaceCache[namespace]:namespaceCache[namespace]=ret:ret},{create:_create,one:function(key,fn,last){this.create().one(key,fn,last)},remove:function(key,fn){this.create().remove(key,fn)},listen:function(key,fn,last){this.create().listen(key,fn,last)},trigger:function(){this.create().trigger.apply(this,arguments)}}}()}()},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_define_property__=__webpack_require__(213),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_define_property___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_define_property__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_2__Observer_js__=__webpack_require__(261);__webpack_exports__.a={messageData:{},modifyFeld:{},parentObject:{},privateMessage:{},privateMessageArr:{},messageArr:{},formdata:{},adaptation:function(option){var messageData=option.messageData,privateMessage=option.privateMessage,modifyFeld=option.modifyFeld,parentObject=option.parentObject,message=option.message,formdata=option.formdata;this.messageData[privateMessage.id]=messageData,this.modifyFeld[privateMessage.id]=modifyFeld,this.parentObject[privateMessage.id]=parentObject,this.privateMessage=privateMessage,this.privateMessageArr[privateMessage.id]=privateMessage,this.messageArr[privateMessage.id]=message,this.formdata[privateMessage.id]=formdata},addEventLis:function(obj,callback){__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(obj).map(function(thisItem,thisIndex){var newValue=obj[thisItem];return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_define_property___default()(obj,thisItem,{get:function(){return newValue},set:function(value){newValue=value,callback()}})})},childrenGetData:function(privateId){var modifyFeld=this.modifyFeld,messageData=this.messageData,returnData={};return __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(messageData[privateId]).forEach(function(item,index){-1!==modifyFeld[privateId].indexOf(item)&&(returnData[item]=messageData[privateId][item])}),returnData.formdata=this.formdata[privateId],returnData},childrenSetData:function(callbackObj,privateId){var _this=this;__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(callbackObj).forEach(function(callbackItem,callbackIndex){"formdata"!==callbackItem&&(_this.messageData[privateId][callbackItem]=callbackObj[callbackItem])})},parentGetData:function(privateId){return this.messageData[privateId]},childrenGetPrivateMessage:function(privateId){return this.privateMessageArr[privateId]},sendModifyHeight:function(privateId,num){this.messageArr[privateId].height=num},ObserverEvent:__WEBPACK_IMPORTED_MODULE_2__Observer_js__.a,manipulateForm:function(payload){var privateId=payload.privateId,data=payload.data,callback=payload.callback;this.ObserverEvent.trigger("externalManipulateForm",{privateId:privateId,data:data,callback:callback})},backCallApi:function(name,callback,payload){this.ObserverEvent.trigger("externalCallApi",{privateId:payload.privateId,data:{action:name,callback:callback,validation:payload.validation}})},backfillFormControlData:function(payload,privateId){this.ObserverEvent.trigger("externalFillNormalField",{privateId:privateId,data:payload})},backfillFormAttachment:function(payload,privateId){this.ObserverEvent.trigger("externalFillAttachField",{privateId:privateId,data:payload})}}},function(module,__webpack_exports__,__webpack_require__){"use strict";function _nativeBind(el,name,cb){return el.addEventListener(name,cb,!1),function(){return el.removeEventListener(name,cb,!1)}}var __WEBPACK_IMPORTED_MODULE_0__utils_index__=__webpack_require__(21);__webpack_exports__.a={inserted:function(el){},bind:function(el,binding){var _mover={reposition:function(){if(void 0!==_mover.vw&&el){var styleTextArr=el.style.cssText.split(";");styleTextArr=styleTextArr.filter(function(item){var str=item.trim();return!(str.startsWith("left")||str.startsWith("top")||str.startsWith("right")||str.startsWith("bottom"))}),el.style.cssText=styleTextArr.join(";"),delete _mover.x,delete _mover.y}}},_opts={};try{_opts=JSON.parse(binding.value)}catch(e){}var defaultOpts={boundary:10,viewport:"parent"};_mover.options=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__utils_index__.a)(defaultOpts,_opts),_mover.detachStart=_nativeBind(el,"touchstart",function(e){var evt=e.changedTouches[0];_mover.x1=evt.clientX,_mover.y1=evt.clientY;var container=el.parentNode;if("body"===_mover.options.viewport&&(container=document.body),_mover.viewport=container.getBoundingClientRect(),void 0===_mover.x){var rect=el.getBoundingClientRect();_mover.x=rect.left,_mover.y=rect.top,_mover.width=rect.width,_mover.height=rect.height}_mover.detachMove=_nativeBind(el,"touchmove",function(e){var evt=e.changedTouches[0],dx=evt.clientX-_mover.x1,dy=evt.clientY-_mover.y1;if(e.preventDefault(),!_mover.running){if(Math.sqrt(dx*dx+dy*dy)<5)return;_mover.running=!0}var x=_mover.x+dx,y=_mover.y+dy;x=Math.min(x,_mover.viewport.right-_mover.options.boundary-_mover.width),y=Math.min(y,_mover.viewport.bottom-_mover.options.boundary-_mover.height),x=Math.max(_mover.viewport.left+_mover.options.boundary,x),y=Math.max(_mover.viewport.top+_mover.options.boundary,y),_mover.x2=x,_mover.y2=y,el.style.cssText="top:"+y+"px;left:"+x+"px"}),_mover.detachEnd=_nativeBind(el,"touchend",function(e){_mover.running&&(_mover.x=_mover.x2,_mover.y=_mover.y2,_mover.running=!1),_mover.detachMove(),_mover.detachEnd(),_mover.detachMove=_mover.detachEnd=null}),el.dataset._mover=_mover,el.reposition=_mover.reposition})},componentUpdated:function(el){console.log("dragger update"),el.dataset._mover&&(el.dataset._mover.reposition&&el.dataset._mover.reposition(),el.reposition=el.dataset._mover.reposition)},unbind:function(el){el.dataset._mover.detachMove&&el.dataset._mover.detachMove(),el.dataset._mover.detachEnd&&el.dataset._mover.detachEnd(),el.dataset._mover.detachStart&&el.dataset._mover.detachStart(),el.dataset._mover=null,el.reposition=null}}},,function(module,exports){},,function(module,exports){},,function(module,exports){},function(module,exports){},function(module,exports){},function(module,exports){},function(module,exports){},function(module,exports){},function(module,exports){},function(module,exports){},,function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(265)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_tab_formson_vue__=__webpack_require__(244),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_tab_formson_vue__.a,null,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(270)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_tile_formson_vue__=__webpack_require__(246),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_tile_formson_vue__.a,null,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},function(module,__webpack_exports__,__webpack_require__){"use strict";function injectStyle(ssrContext){__webpack_require__(271),__webpack_require__(272)}var __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_navbar_vue__=__webpack_require__(248),__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_13_7_3_vue_loader_lib_template_compiler_index_id_data_v_4fa30079_hasScoped_false_transformToRequire_video_src_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_template_index_0_navbar_vue__=__webpack_require__(286),normalizeComponent=__webpack_require__(42),__vue_styles__=injectStyle,Component=normalizeComponent(__WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_script_index_0_navbar_vue__.a,__WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_13_7_3_vue_loader_lib_template_compiler_index_id_data_v_4fa30079_hasScoped_false_transformToRequire_video_src_source_src_img_src_image_xlink_href_buble_transforms_node_modules_vue_loader_13_7_3_vue_loader_lib_selector_type_template_index_0_navbar_vue__.a,!1,__vue_styles__,null,null);__webpack_exports__.a=Component.exports},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";var render=function(){var _vm=this,_h=_vm.$createElement;return(_vm._self._c||_h)("div",{staticClass:"custom-widget-wrapper",attrs:{id:_vm.channelId}})},staticRenderFns=[],esExports={render:render,staticRenderFns:staticRenderFns};__webpack_exports__.a=esExports},,function(module,__webpack_exports__,__webpack_require__){"use strict";var render=function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("section",{staticClass:"cap4-navbar",style:{background:_vm.bg,borderBottom:_vm.border}},[_c("div",{staticClass:"swiper-container"},[_c("div",{staticClass:"swiper-wrapper",attrs:{id:"cap4-navbar-wrapper"}},_vm._l(_vm.data,function(item,index){return _c("div",{key:item.rightId,staticClass:"swiper-slide"},[_c("div",{staticClass:"cap4-navbar__item",class:index==_vm.activeIndex?"is-active":"",style:{color:_vm.color},domProps:{textContent:_vm._s(item.name)},on:{tap:function($event){_vm.changeView(item.rightId,index)}}})])}))])])},staticRenderFns=[],esExports={render:render,staticRenderFns:staticRenderFns};__webpack_exports__.a=esExports}]));